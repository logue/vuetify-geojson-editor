import{u as X}from"./index-D4QikbVz.js";import{X as at,b as E,f as W,h as Y,a8 as mt,s as yt,B as Pe,W as vt,a1 as lt,$ as U,_ as J,J as ht,a0 as l,n as r,V as T,O as de,a9 as wt,aa as ke,a3 as pe,v as F,w as ge,u as q,H as ae,F as xt,ab as St}from"./vue-C9g6RwH9.js";import{G as Ue,C as Ct,c as At,V as te,g as Q,T as Te,a as bt,b as Ne,e as kt,i as ue,B as Tt,E as It,d as Et,f as Rt,h as Ot,w as Vt,j as Ft,t as _t,H as Ie,k as Pt,l as Lt,D as Be,m as Mt,n as Gt,s as Ee,Z as jt,r as We,o as Je,p as Dt,q as zt,u as Ut,v as Nt,x as xe,S as O,F as z,y as V,z as Z,I as Le,A as Bt,J as Wt,P as Ze,K as Jt,L as Zt,M as qt,N as Ce,O as Fe,Q as Ht,R as Xt,U as Yt,W as Qt,X as Kt,Y as $t,$ as qe,a0 as eo,a1 as to,a2 as He,a3 as oo,a4 as no,a5 as ro,a6 as ao,a7 as lo,a8 as io,a9 as Me,aa as so,ab as co,ac as uo,ad as Re,ae as po,af as Oe,ag as Xe,ah as fo,ai as go,aj as mo,ak as it,al as yo,am as st}from"./openlayers-CQmS014w.js";import{t as Ye,v as Ge,a as ct,b as vo,c as ho,d as D,e as le,f as wo,r as xo,g as So}from"./misc-0P--jxPj.js";import{t as Co,v as Ao,w as bo,x as re,c as Ae,b as H,a as ko,y as me,z as ye,A as ve,V as R,j as ie,B as _,u as ut,C as je,D as To,E as Qe,F as Io,G as Ke,H as Eo,I as oe,J as ne,K as Ro,L as Oo,M as Vo,N as $e,O as Fo,P as dt,Q as _o,R as Po,S as Lo,T as Mo}from"./vuetify-C-oxdWip.js";import{m as Go,j as jo,a as Do}from"./codemirror-lang-DrUFrkjK.js";import{K as pt}from"./codemirror-enR98YzG.js";const fe={id:void 0,name:void 0,description:void 0,annotation:void 0,annotationStyle:void 0,icon:void 0,color:"light-blue",opacity:void 0,thickness:void 0,level:0},he=at("geojson-editor",()=>{const d=E({type:"FeatureCollection",features:[]}),e=W(()=>Ye({data:d.value})),o=E(!0);function n(f){let v=0;f.forEach(y=>{v++,y.getId()||y.setId(Ge());let p=y.getProperties();p||(p=fe,p.no=v),y.setProperties(p)}),d.value=JSON.parse(new Ue().writeFeatures(f,{dataProjection:"EPSG:4326",featureProjection:"EPSG:3857"}))}function t(){return new Ue().readFeatures(d.value,{dataProjection:"EPSG:4326",featureProjection:"EPSG:3857"})}function s(f="geojson",v=!1,y=!1){d.value.type==="FeatureCollection"&&d.value.features.forEach(S=>(delete S.id,S));let p=ct(d.value);y&&(p=vo(p));const h=JSON.stringify(f==="topojson"?{$schema:"https://raw.githubusercontent.com/Casyfill/TopoJSON_schema/master/topology.json",...Ye({data:p})}:{$schema:"https://json.schemastore.org/geojson.json",...p},null,v?2:0);return new Blob([h],{type:"application/geo+json"})}function c(f){d.value=f}function m(){d.value={type:"FeatureCollection",features:[]},o.value=!0}function i(f=!0){o.value=f}return{geojson:d,topojson:e,requestRefresh:o,exportBlob:s,setGeoJson:c,setFeatures:n,getFeatures:t,clear:m,setRefresh:i}},{persist:{storage:window.localStorage}}),De=at("map-cursor",()=>{const d=E([0,0]),e=E(1),o=E(0);function n(c){d.value=c}function t(c){e.value=c}function s(c){o.value=c}return{level:o,zoom:e,coordinate:d,setCoordinate:n,setZoom:t,setLevel:s}}),zo={image:["Polygon","Circle","LineString","Image","Text"],hybrid:["Polygon","LineString"],vector:[]},et={hybrid:["Image","Text","Default"],vector:["Polygon","Circle","LineString","Image","Text","Default"]};class Uo extends Ct{constructor(e,o){super(e,o),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.renderedLayerRevision_,this.renderedPixelToCoordinateTransform_=null,this.renderedRotation_,this.renderedOpacity_=1,this.tmpTransform_=At(),this.tileClipContexts_=null}drawTile(e,o,n,t,s,c,m,i){this.updateExecutorGroup_(e,o.pixelRatio,o.viewState.projection),this.tileImageNeedsRender_(e)&&this.renderTileImage_(e,o),super.drawTile(e,o,n,t,s,c,m,i)}getTile(e,o,n,t){const s=this.getOrCreateTile(e,o,n,t);if(!s)return null;const m=t.viewState.resolution,i=t.viewHints;return(!(i[te.ANIMATING]||i[te.INTERACTING])||!s.wantedResolution)&&(s.wantedResolution=m),s}prepareFrame(e){const o=this.getLayer().getRevision();return this.renderedLayerRevision_!==o&&(this.renderedLayerRevision_=o,this.renderedTiles.length=0),super.prepareFrame(e)}updateExecutorGroup_(e,o,n){const t=this.getLayer(),s=t.getRevision(),c=t.getRenderOrder()||null,m=e.wantedResolution,i=e.getReplayState(t);if(!i.dirty&&i.renderedResolution===m&&i.renderedRevision==s&&i.renderedRenderOrder==c)return;const f=t.getSource(),v=!!t.getDeclutter(),y=f.getTileGrid(),h=f.getTileGridForProjection(n).getTileCoordExtent(e.wrappedTileCoord),S=f.getSourceTiles(o,n,e),u=Q(t);delete e.hitDetectionImageData[u],e.executorGroups[u]=[],i.dirty=!1;for(let a=0,C=S.length;a<C;++a){const A=S[a];if(A.getState()!=Te.LOADED)continue;const x=A.tileCoord,I=y.getTileCoordExtent(x),b=bt(h,I),k=Ne(b,t.getRenderBuffer()*m,this.tempExtent),g=kt(I,b)?null:k,w=new Tt(0,b,m,o),P=zt(m,o),se=function(B,G){let ee;const ze=B.getStyleFunction()||t.getStyleFunction();if(ze&&(ee=ze(B,m)),ee){const gt=this.renderFeature(B,P,ee,w,v,G);i.dirty=i.dirty||gt}},M=A.getFeatures();c&&c!==i.renderedRenderOrder&&M.sort(c);for(let B=0,G=M.length;B<G;++B){const ee=M[B];(!g||ue(g,ee.getGeometry().getExtent()))&&se.call(this,ee,B)}const j=w.finish(),ce=t.getRenderMode()!=="vector"&&v&&S.length===1?null:b,N=new It(ce,m,o,f.getOverlaps(),j,t.getRenderBuffer(),!0);e.executorGroups[u].push(N)}i.renderedRevision=s,i.renderedRenderOrder=c,i.renderedResolution=m}forEachFeatureAtCoordinate(e,o,n,t,s){const c=o.viewState.resolution,m=o.viewState.rotation;n=n??0;const i=this.getLayer(),v=i.getSource().getTileGridForProjection(o.viewState.projection),y=Et([e]);Ne(y,c*n,y);const p={},h=function(x,I,b){let k=x.getId();k===void 0&&(k=Q(x));const g=p[k];if(g){if(g!==!0&&b<g.distanceSq){if(b===0)return p[k]=!0,s.splice(s.lastIndexOf(g),1),t(x,i,I);g.geometry=I,g.distanceSq=b}}else{if(b===0)return p[k]=!0,t(x,i,I);s.push(p[k]={feature:x,layer:i,geometry:I,distanceSq:b,callback:t})}},S=this.renderedTiles,u=Q(i),a=i.getDeclutter(),C=a?o.declutter?.[a]?.all().map(x=>x.value):null;let A;e:for(let x=0,I=S.length;x<I;++x){const b=S[x],k=v.getTileCoordExtent(b.wrappedTileCoord);if(!ue(k,y))continue;const g=b.executorGroups[u];for(let w=0,P=g.length;w<P;++w)if(A=g[w].forEachFeatureAtCoordinate(e,c,m,n,h,C),A)break e}return A}getFeatures(e){return this.renderedTiles.length===0?Promise.resolve([]):new Promise((o,n)=>{const t=this.getLayer(),s=t.getSource(),c=this.renderedProjection,m=c.getExtent(),i=this.renderedResolution,f=s.getTileGridForProjection(c),v=Rt(this.renderedPixelToCoordinateTransform_,e.slice()),y=f.getTileCoordForCoordAndResolution(v,i).toString(),p=this.renderedTiles.find(x=>x.tileCoord.toString()===y&&x.getState()===Te.LOADED);if(!p||p.loadingSourceTiles>0){o([]);return}s.getWrapX()&&c.canWrapX()&&!Ot(m,f.getTileCoordExtent(p.tileCoord))&&Vt(v,c);const h=Q(t),S=f.getTileCoordExtent(p.wrappedTileCoord),u=Ft(S),a=[(v[0]-u[0])/i,(u[1]-v[1])/i],C=p.getSourceTiles().reduce((x,I)=>x.concat(I.getFeatures()),[]);let A=p.hitDetectionImageData[h];if(!A){const x=_t(f.getTileSize(f.getZForResolution(i,s.zDirection))),I=this.renderedRotation_,b=[this.getRenderTransform(f.getTileCoordCenter(p.wrappedTileCoord),i,0,Ie,x[0]*Ie,x[1]*Ie,0)];A=Pt(x,b,C,t.getStyleFunction(),f.getTileCoordExtent(p.wrappedTileCoord),p.getReplayState(t).renderedResolution,I),p.hitDetectionImageData[h]=A}o(Lt(a,C,A))})}getFeaturesInExtent(e){const o=[],n=this.getTileCache();if(n.getCount()===0)return o;const s=this.getLayer().getSource().getTileGridForProjection(this.frameState.viewState.projection),c=s.getZForResolution(this.renderedResolution),m={};return n.forEach(i=>{if(i.tileCoord[0]!==c||i.getState()!==Te.LOADED)return;const f=i.getSourceTiles();for(let v=0,y=f.length;v<y;++v){const p=f[v],h=p.getKey();if(h in m)continue;m[h]=!0;const S=p.tileCoord;if(ue(e,s.getTileCoordExtent(S))){const u=p.getFeatures();if(u)for(let a=0,C=u.length;a<C;++a){const A=u[a],x=A.getGeometry();ue(e,x.getExtent())&&o.push(A)}}}}),o}handleFontsChanged(){const e=this.getLayer();e.getVisible()&&this.renderedLayerRevision_!==void 0&&e.changed()}handleStyleImageChange_(e){this.renderIfReadyAndVisible()}renderDeclutter(e,o){const n=this.context,t=n.globalAlpha;n.globalAlpha=o.opacity;const s=e.viewHints,c=!(s[te.ANIMATING]||s[te.INTERACTING]),m=[this.context.canvas.width,this.context.canvas.height],i=this.getLayer().getDeclutter(),f=i?e.declutter?.[i]:void 0,v=Q(this.getLayer()),y=this.renderedTiles;for(let p=0,h=y.length;p<h;++p){const S=y[p],u=S.executorGroups[v];if(u)for(let a=u.length-1;a>=0;--a)u[a].execute(this.context,m,this.getTileRenderTransform(S,e),e.viewState.rotation,c,Be,f)}n.globalAlpha=t}renderDeferredInternal(e){const o=this.renderedTiles,n=Q(this.getLayer()),t=o.reduce((i,f,v)=>(f.executorGroups[n].forEach(y=>i.push({executorGroup:y,index:v})),i),[]),s=t.map(({executorGroup:i})=>i.getDeferredZIndexContexts()),c={};for(let i=0,f=t.length;i<f;++i){const v=t[i].executorGroup.getDeferredZIndexContexts();for(const y in v)c[y]=!0}Object.keys(c).map(Number).sort(Mt).forEach(i=>{s.forEach((f,v)=>{f[i]&&(f[i].forEach(y=>{const{executorGroup:p,index:h}=t[v],S=p.getRenderedContext(),u=S.globalAlpha;S.globalAlpha=this.renderedOpacity_;const a=this.tileClipContexts_[h];a&&a.draw(S),y.draw(S),a&&S.restore(),S.globalAlpha=u,y.clear()}),f[i].length=0)})})}getTileRenderTransform(e,o){const n=o.pixelRatio,t=o.viewState,s=t.center,c=t.resolution,m=t.rotation,i=o.size,f=Math.round(i[0]*n),v=Math.round(i[1]*n),p=this.getLayer().getSource().getTileGridForProjection(o.viewState.projection),h=e.tileCoord,S=p.getTileCoordExtent(e.wrappedTileCoord),u=p.getTileCoordExtent(h,this.tempExtent)[0]-S[0];return Gt(Ee(this.inversePixelTransform.slice(),1/n,1/n),this.getRenderTransform(s,c,m,n,f,v,u))}postRender(e,o){const n=o.viewHints,t=!(n[te.ANIMATING]||n[te.INTERACTING]);this.renderedPixelToCoordinateTransform_=o.pixelToCoordinateTransform.slice(),this.renderedRotation_=o.viewState.rotation,this.renderedOpacity_=o.layerStatesArray[o.layerIndex].opacity;const s=this.getLayer(),c=s.getRenderMode(),m=e.globalAlpha;e.globalAlpha=this.renderedOpacity_;const i=s.getDeclutter(),f=i?et[c].filter(b=>!Be.includes(b)):et[c],v=o.viewState,y=v.rotation,p=s.getSource(),S=p.getTileGridForProjection(v.projection).getZForResolution(v.resolution,p.zDirection),u=this.renderedTiles,a=[],C=[],A=[],x=Q(s);let I=!0;for(let b=u.length-1;b>=0;--b){const k=u[b];I=I&&!k.getReplayState(s).dirty;const g=k.executorGroups[x].filter(N=>N.hasExecutors(f));if(g.length===0)continue;const w=this.getTileRenderTransform(k,o),P=k.tileCoord[0];let se=!1;const M=g[0].getClipCoords(w);let j=e,ce;if(M){ce=new jt,j=ce.getContext();for(let N=0,B=a.length;N<B;++N)if(S!==P&&P<C[N]){const G=a[N];ue([M[0],M[3],M[4],M[7]],[G[0],G[3],G[4],G[7]])&&(se||(j.save(),se=!0),j.beginPath(),j.moveTo(M[0],M[1]),j.lineTo(M[2],M[3]),j.lineTo(M[4],M[5]),j.lineTo(M[6],M[7]),j.moveTo(G[6],G[7]),j.lineTo(G[4],G[5]),j.lineTo(G[2],G[3]),j.lineTo(G[0],G[1]),j.clip())}a.push(M),C.push(P)}for(let N=0,B=g.length;N<B;++N)g[N].execute(e,[e.canvas.width,e.canvas.height],w,y,t,f,o.declutter?.[i]);se&&(j===e?j.restore():A[b]=ce)}e.globalAlpha=m,this.ready=I,this.tileClipContexts_=A,o.declutter||this.renderDeferredInternal(o),super.postRender(e,o)}renderFeature(e,o,n,t,s,c){if(!n)return!1;let m=!1;if(Array.isArray(n))for(let i=0,f=n.length;i<f;++i)m=We(t,e,n[i],o,this.boundHandleStyleImageChange_,void 0,s,c)||m;else m=We(t,e,n,o,this.boundHandleStyleImageChange_,void 0,s,c);return m}tileImageNeedsRender_(e){const o=this.getLayer();if(o.getRenderMode()==="vector")return!1;const n=e.getReplayState(o),t=o.getRevision(),s=e.wantedResolution;return n.renderedTileResolution!==s||n.renderedTileRevision!==t}renderTileImage_(e,o){const n=this.getLayer(),t=e.getReplayState(n),s=n.getRevision(),c=e.executorGroups[Q(n)];t.renderedTileRevision=s;const m=e.wrappedTileCoord,i=m[0],f=n.getSource();let v=o.pixelRatio;const p=o.viewState.projection,h=f.getTileGridForProjection(p),S=h.getResolution(e.tileCoord[0]),u=o.pixelRatio/e.wantedResolution*S,a=h.getResolution(i),C=e.getContext();v=Math.round(Math.max(v,u/v));const A=f.getTilePixelSize(i,v,p);C.canvas.width=A[0],C.canvas.height=A[1];const x=v/u;if(x!==1){const g=Je(this.tmpTransform_);Ee(g,x,x),C.setTransform.apply(C,g)}const I=h.getTileCoordExtent(m,this.tempExtent),b=u/a,k=Je(this.tmpTransform_);Ee(k,b,-b),Dt(k,-I[0],-I[3]);for(let g=0,w=c.length;g<w;++g)c[g].execute(C,[C.canvas.width*x,C.canvas.height*x],k,0,!0,zo[n.getRenderMode()],null);t.renderedTileResolution=e.wantedResolution}}class No extends Ut{constructor(e){e=e||{};const o=Object.assign({},e);delete o.preload;const n=e.cacheSize===void 0?0:e.cacheSize;delete e.cacheSize,delete o.useInterimTilesOnError,super(o),this.on,this.once,this.un,this.cacheSize_=n;const t=e.renderMode||"hybrid";Nt(t=="hybrid"||t=="vector","`renderMode` must be `'hybrid'` or `'vector'`"),this.renderMode_=t,this.setPreload(e.preload?e.preload:0),this.setUseInterimTilesOnError(e.useInterimTilesOnError!==void 0?e.useInterimTilesOnError:!0),this.getBackground,this.setBackground}createRenderer(){return new Uo(this,{cacheSize:this.cacheSize_})}getFeatures(e){return super.getFeatures(e)}getFeaturesInExtent(e){return this.getRenderer().getFeaturesInExtent(e)}getRenderMode(){return this.renderMode_}getPreload(){return this.get(xe.PRELOAD)}getUseInterimTilesOnError(){return this.get(xe.USE_INTERIM_TILES_ON_ERROR)}setPreload(e){this.set(xe.PRELOAD,e)}setUseInterimTilesOnError(e){this.set(xe.USE_INTERIM_TILES_ON_ERROR,e)}}const Bo="https://maps.gsi.go.jp/vector/sprite/std.json",Wo="https://maps.gsi.go.jp/vector/sprite/std.png",Jo=[5,5],Zo=new Map([[1401,"都道府県所在地-20"],[1402,"市役所・東京都の区役所-20"],[1403,"町村役場・政令指定都市の区役所-20"],[3201,"官公署"],[3202,"裁判所"],[3205,"市役所・東京都の区役所"],[3206,"町村役場・政令指定都市の区役所"],[3211,"交番"],[3212,"高等学校・中等教育学校"],[3214,"小学校"],[3213,"中学校"],[3215,"老人ホーム"],[3216,"博物館法の登録博物館・博物館相当施設"],[3217,"図書館"],[3218,"郵便局"],[3221,"灯台"],[3231,"神社"],[3232,"寺院"],[3241,"警察署"],[3242,"消防署"],[3243,"病院"],[3244,"保健所"],[4101,"煙突"],[4102,"風車"],[4103,"油井・ガス井"],[4104,"記念碑"],[4105,"自然災害伝承碑"],[6301,"墓地"],[6311,"田"],[6312,"畑"],[6313,"茶畑"],[6314,"果樹園"],[6321,"広葉樹林"],[6322,"針葉樹林"],[6323,"竹林"],[6324,"ヤシ科樹林"],[6325,"ハイマツ地"],[6326,"笹地"],[6327,"荒地"],[6331,"温泉"],[6332,"噴火口・噴気口"],[6341,"史跡・名勝・天然記念物"],[6342,"城跡"],[6351,"採鉱地"],[6361,"港湾"],[6362,"漁港"],[6367,"特定重要港-20"],[6368,"重要港-20"],[6371,"国際空港-20"],[6372,"自衛隊等の飛行場-20"],[6375,"国際空港-20"],[6376,"国際空港以外の拠点空港等-20"],[6381,"自衛隊-20"],[7102,"三角点"],[7103,"水準点"],[7101,"電子基準点"],[8103,"発電所等"],[8105,"電波塔"],[51301,"人口100万人以上-500"],[51302,"人口50万-100万人未満-500"],[51303,"人口50万人未満-500"],[56368,"主要な港-500"],[56376,"主要な空港-500"]]),qo=async d=>{try{const e=await fetch(d);return e.ok?await e.json():null}catch{return null}};let _e=null;(async()=>_e=await qo(Bo))();const Ho=d=>{if(!_e)return null;const e=_e[d];if(e){const o=e.y<770?.5:.3;return{src:Wo,size:[e.width,e.height],offset:[e.x,e.y],scale:o}}else return null},tt=d=>{if(!d)return;const e=+d,o=Zo.get(e)??"指示点",n=Ho(o);if(n)return new Le(n)},K=(d,e)=>d??e,Xo=d=>(d.getProperties()?.rnkWidth?+d.getProperties().rnkWidth:1)+1,Yo=d=>{switch(d.getProperties()?.rdCtg){case 0:return"rgba(255,190,190,1)";case 1:return"rgba(255,211,111,1)";default:return"rgba(210,210,210,1)"}},Qo=d=>{const e=d.getProperties();return e?.alti===void 0||e?.alti===null?.5:+e.alti%50===0?1:.5},Ko=(d,e)=>{const o=[],n=d.getProperties(),t=n?.layer,s=n?.ftCode,c=d.getGeometry()?.getType(),m=n?.alti,i=n?.name,f=n?.knj,v=n?.rdCtg,y=n?.motorway,p=n?.lvOrder,h=n?.railState,S=n?.staCode,u=n?.annoCtg;if(!n)return o;if(t==="waterarea"&&o.push(new O({fill:new z({color:"rgba(220,220,255,1)"})})),(t==="coastline"||t==="river"||t==="lake")&&o.push(new O({stroke:new V({color:"rgba(220,220,255,1)",width:1})})),(t==="building"||t==="structurea")&&(c==="Polygon"||c==="MultiPolygon")&&o.push(new O({fill:new z({color:"rgba(150,150,150,1)"}),zIndex:100})),t==="wstructurea"&&o.push(new O({fill:new z({color:"rgba(255,255,255,1)"}),zIndex:2})),t==="contour"&&(o.push(new O({stroke:new V({color:"rgba(230,230,230,1)",width:Qo(d)}),zIndex:10})),s===7352&&m!==void 0&&m!==null&&o.push(new O({text:new Z({text:String(m),placement:"line",fill:new z({color:"rgba(230,230,230,1)"}),stroke:new V({color:"rgba(255,255,255,1)",width:2})}),zIndex:11}))),t==="boundary"&&(s!==6101?o.push(new O({stroke:new V({color:"rgba(100,0,200,0.3)",width:2,lineDash:[5,3,2,2]}),zIndex:10})):s===6101&&o.push(new O({stroke:new V({color:"rgba(230,230,230,1)",width:1,lineDash:[5,3,2,2]}),zIndex:10}))),t==="road"){const a=Xo(d),C=Yo(d),A=1e3+K(p,0)+10;s!=null&&(s>2710&&s<9999&&y!==1?o.push(new O({stroke:new V({color:C,width:1,lineDash:[2,2]}),zIndex:A-K(v,0)})):s===2701||s===2702?o.push(new O({stroke:new V({color:y===1?"rgba(0,151,0,1)":C,width:a}),zIndex:A-(y===1?0:K(v,0))})):s===2703?o.push(new O({stroke:new V({color:y===1?"rgba(0,151,0,1)":C,width:a}),zIndex:1e4+K(p,0)+1}),new O({stroke:new V({color:"rgba(255,255,255,1)",width:a+2,lineCap:"butt"}),zIndex:1e4+K(p,0)})):s===2704&&o.push(new O({stroke:new V({color:y===1?"rgba(0,151,0,0.5)":C,width:a,lineDash:Jo,lineCap:"butt"}),zIndex:2e4})))}if(t==="railway"){const a="rgba(100,100,100,1)";h&&([1,2,3,5,100,300].includes(h)?h===1?o.push(new O({stroke:new V({color:a,width:1.5}),zIndex:1e4+K(p,0)+1}),new O({stroke:new V({color:"rgba(255,255,255,1)",width:4,lineCap:"butt"}),zIndex:1e4+K(p,0)})):[2,3,100,300].includes(h)&&o.push(new O({stroke:new V({color:a,width:1.5,lineDash:[5,5]}),zIndex:2e4})):o.push(new O({stroke:new V({color:a,width:1.5}),zIndex:1011}))),S&&S!==0&&o.push(new O({stroke:new V({color:a,width:3}),zIndex:2e4}))}if(t==="symbol"){const a=tt(s);s&&![1401,1402,1403,7101,7102,7103].includes(s)&&a&&o.push(new O({image:a,zIndex:100002})),(i||f)&&a&&o.push(new O({text:new Z({text:i??f??"",textAlign:"left",offsetX:8,offsetY:0,fill:new z({color:"rgba(50,50,50,1)"}),stroke:new V({color:"rgba(255,255,255,1)",width:2})}),image:a,zIndex:100004}))}if((t==="symbol"||t==="elevation")&&m){const a=tt(s);a&&o.push(new O({text:new Z({text:String(Math.floor(m*10)/10),textAlign:"left",offsetX:8,offsetY:0,fill:new z({color:"rgba(50,50,50,1)"}),stroke:new V({color:"rgba(255,255,255,1)",width:2})}),image:a,zIndex:100003+(7105-K(s,0))}))}return(t==="label"||t==="symbol")&&f&&o.push(new O({text:new Z({text:f,fill:new z({color:"rgba(0,0,0,1)"}),stroke:new V({color:"rgba(255,255,255,1)",width:2})}),zIndex:1e5})),t==="transp"&&f&&o.push(new O({text:new Z({text:f,fill:new z({color:"rgba(19,97,69,1)"}),stroke:new V({color:"rgba(255,255,255,1)",width:2})}),zIndex:100001})),t==="label"&&f&&u&&[422,421,411,412,413,860,441].includes(u)&&o.push(new O({text:new Z({text:f,fill:new z({color:"rgba(19,97,69,1)"}),stroke:new V({color:"rgba(255,255,255,1)",width:2})}),zIndex:100002})),o};class $o{colorSet;fontFace;pointSize;pointFillColor;pointFillOpacity;pointStrokeColor;pointStrokeOpacity;pointStrokeWidth;fillColor;fillOpacity;strokeColor;strokeOpacity;strokeWidth;textColor;textStyle;textOpacity;textStrokeColor;textStrokeOpacity;textStrokeWidth;iconOpacity;iconTextStyle;gridColor;gridOpacity;gridTextStyle;constructor(e="light-blue",o="'Roboto', 'Noto Sans JP','Noto Color Emoji', sans-serif"){this.colorSet=Co[ho(e)],this.fontFace=o}getStyle(){return new O({fill:new z({color:D(this.fillColor).alpha(this.fillOpacity).css()}),stroke:new V({color:D(this.strokeColor).alpha(this.strokeOpacity).css(),width:this.strokeWidth}),image:new Bt({radius:this.pointSize,stroke:new V({color:D(this.pointStrokeColor).alpha(this.pointStrokeOpacity).css(),width:this.pointStrokeWidth}),fill:new z({color:D(this.pointFillColor).alpha(this.pointFillOpacity).css()})}),text:new Z({font:this.textStyle,fill:new z({color:D(this.textColor).alpha(this.textOpacity).css()}),stroke:new V({color:D(this.textStrokeColor).alpha(this.textStrokeOpacity).css(),width:this.textStrokeWidth}),overflow:!0,text:""})})}getIconStyle(e){return new O({image:new Le({anchor:[.5,.5],anchorXUnits:"fraction",anchorYUnits:"fraction",src:`/vuetify-geojson-editor/img/markers/${e}.png`,scale:.75,opacity:this.iconOpacity}),text:new Z({offsetX:0,offsetY:10,font:this.textStyle,fill:new z({color:D(this.textColor).alpha(this.textOpacity).css()}),stroke:new V({color:D(this.textStrokeColor).alpha(this.textStrokeOpacity).css(),width:this.textStrokeWidth}),overflow:!0,text:""})})}getLabelStyle(e){return new O({text:new Z({font:this.textStyle,fill:new z({color:D(this.textColor).alpha(this.textOpacity).css()}),stroke:new V({color:D(this.textStrokeColor).alpha(this.textStrokeOpacity).css(),width:this.textStrokeWidth}),overflow:!0,offsetY:e,text:""})})}getGridStyle(){return new O({stroke:new V({color:D(this.gridColor).alpha(this.gridOpacity).css()}),text:new Z({font:this.gridTextStyle,fill:new z({color:D(this.colorSet.accent2).css()}),stroke:new V({color:D(this.colorSet.lighten1).alpha(this.textStrokeOpacity).css(),width:1})})})}}class $ extends $o{pointFillColor=this.colorSet.accent1||this.colorSet.lighten4;pointFillOpacity=.35;pointStrokeColor=this.colorSet.accent3||this.colorSet.lighten3;pointStrokeOpacity=1;pointStrokeWidth=1;pointSize=5;pointTextStyle=`400 0.3rem ${this.fontFace}`;fillColor=this.colorSet.accent1||this.colorSet.lighten4;fillOpacity=.25;strokeColor=this.colorSet.accent3||this.colorSet.lighten3;strokeOpacity=.75;strokeWidth=1;textColor=this.colorSet.darken4;textStyle=`600 1rem ${this.fontFace}`;textOpacity=1;textStrokeColor=this.colorSet.lighten5;textStrokeOpacity=.5;textStrokeWidth=2.5;iconOpacity=1;iconTextStyle=`500 0.75rem ${this.fontFace}`;gridColor=this.colorSet.base;gridOpacity=.5;gridTextStyle=`900 1.5rem ${this.fontFace}`}class we extends ${fillOpacity=0;textStrokeOpacity=.75;textStyle=`600 1.5rem ${this.fontFace}`}class en extends we{pointFillColor=this.colorSet.accent4||this.colorSet.base;pointFillOpacity=1;pointStrokeColor=this.colorSet.accent2||this.colorSet.lighten4;pointStrokeOpacity=1;pointStrokeWidth=2;fillColor=this.colorSet.accent1||this.colorSet.lighten5;fillOpacity=.25;strokeWidth=3;textStrokeColor=this.colorSet.lighten5;textStrokeOpacity=1}const L={ACTIVE:"active",INACTIVE:"inactive",HOVER:"hover",SELECTED:"selected"};class Ve extends ${}class tn extends ${pointFillOpacity=.5;pointStrokeOpacity=1;fillOpacity=.5;textOpacity=1;strokeOpacity=1;textStrokeOpacity=1}class ot extends ${pointFillOpacity=.05;pointStrokeOpacity=.25;fillOpacity=.05;strokeOpacity=.25;iconOpacity=.5;textOpacity=.5;textStrokeOpacity=.25}class on extends we{}class nn extends we{textStrokeOpacity=1;textOpacity=1;fillOpacity=.1}class rn extends we{fillOpacity=0;strokeOpacity=.25;textOpacity=.5;textStrokeOpacity=.25}class nt extends ${pointFillColor=this.colorSet.accent4||this.colorSet.base;pointFillOpacity=1;pointStrokeColor=this.colorSet.accent2||this.colorSet.lighten4;pointStrokeOpacity=1;pointStrokeWidth=2;fillColor=this.colorSet.accent1||this.colorSet.lighten5;fillOpacity=.5;strokeWidth=3;textStrokeColor=this.colorSet.lighten5;textStrokeOpacity=1}class Se{static fontFace="'Roboto', 'Noto Sans JP','Noto Color Emoji', sans-serif";static getStyle(e,o=L.ACTIVE){let n;switch(o){case L.INACTIVE:n=new ot(e,this.fontFace);break;case L.SELECTED:n=new nt(e,this.fontFace);break;case L.HOVER:n=new tn(e,this.fontFace);break;case L.ACTIVE:n=new Ve(e,this.fontFace);break;default:n=new $(e,this.fontFace)}return n.getStyle(e)}static getSectionPolygonStyle(e,o=L.ACTIVE){let n;switch(o){case L.INACTIVE:n=new rn(e,this.fontFace);break;case L.SELECTED:n=new en(e,this.fontFace);break;case L.HOVER:n=new nn(e,this.fontFace);break;case L.ACTIVE:n=new on(e,this.fontFace);break;default:n=new we(e,this.fontFace)}return n.getStyle(e)}static getIconStyle(e="pin",o="blue-grey",n=L.ACTIVE){let t;switch(n){case L.INACTIVE:t=new ot(o,this.fontFace);break;case L.SELECTED:t=new nt(o,this.fontFace);break;case L.ACTIVE:t=new Ve(o,this.fontFace);break;default:t=new Ve(o,this.fontFace)}return t.getIconStyle(e)}static getGridStyle(e="light-blue"){return new $(e,this.fontFace).getGridStyle()}}le.defaults.headers.common["X-Requested-With"]="XMLHttpRequest";le.defaults.withCredentials=!0;le.defaults.onUploadProgress=d=>{const e=X();d.progress&&d.total?e.setProgress(Math.round(d.loaded*100/d.total)):e.setProgress(null)};le.defaults.onDownloadProgress=d=>{const e=X();d.progress&&d.total?e.setProgress(Math.round(d.loaded*100/d.total)):e.setProgress(null)};le.interceptors.request.use(d=>(X().setLoading(!0),d));le.interceptors.response.use(d=>(X().setLoading(!1),d),d=>{const e=X();if(e.setLoading(!1),d.response.status>=400)throw e.setMessage("不明なエラーが発生しました。"),new Error(d);return d.response});const an=new O({image:new Le({anchor:[.5,86],anchorXUnits:"fraction",anchorYUnits:"pixels",src:"/vuetify-geojson-editor/img/spotlight-poi2_hdpi.png",crossOrigin:"anonymous",opacity:1,size:[54,86],scale:.5})});function rt(d,e=0,o=0,n=void 0){d&&d.setStyle((t,s)=>{const c=t.getProperties(),m=t.getGeometry(),f=(c.level??0)===e?L.ACTIVE:L.INACTIVE,v=be(t,n??f,d.getProperties().id);return m?.getType()==="Point"&&c.icon&&o!==0&&v.getImage()?.setScale(o/s),v})}function be(d,e=L.ACTIVE,o){const n=d.getProperties();let t;if(n.icon?(t=Se.getIconStyle(n.icon,n.color,e),t.getText()?.setText(n.annotation?.toString())):o==="sectionLayer"&&d.getGeometry()?.getType()==="Polygon"?t=Se.getSectionPolygonStyle(n.color,e):t=Se.getStyle(n.color,e),e!==L.SELECTED){n.thickness&&t.getStroke()?.setWidth(n.thickness);const s=t.getFill();if(n.opacity&&s){const c=n.opacity,m=D(s.getColor());let i=e===L.ACTIVE?c:c/2;e===L.HOVER&&(i=.25),t.getFill()?.setColor(D(m).alpha(i).css())}}return n.annotation&&!n.icon&&(d.getGeometry()?.getType()==="Point"&&typeof n.annotation!="number"&&t.getImage()?.setOpacity(0),t.getText()?.setText(n.annotation.toString()),n.annotationStyle&&t.getText()?.setFont(`${n.annotationStyle} ${Se.fontFace}`)),t}const ln=Y({__name:"MapComponent",props:{zoom:{type:Number,default:8},minZoom:{type:Number,default:4},maxZoom:{type:Number,default:18},extentLimit:{type:Array,default:()=>{}},center:{type:Array,default:()=>[139.766667,35.681111]},contextMenu:{type:Boolean,default:!0},loadingMessage:{type:String,default:"Now Loading..."}},emits:["ready","contextmenu"],setup(d,{expose:e,emit:o}){const n=d,t=o,s=mt(),c=De(),m=E(),i=W({get:()=>c.zoom,set:b=>c.setZoom(b)}),f=W({get:()=>c.coordinate,set:b=>c.setCoordinate(b)}),v=s?.query;v.x&&v.y?f.value=[parseFloat(v.y),parseFloat(v.x)]:n.center&&(f.value=n.center),i.value=v.zoom?parseInt(v.zoom):n.zoom;const y=new Wt({geometry:new Ze(f.value),name:"cursor"}),p=new Jt({center:Zt(f.value,"EPSG:4326","EPSG:3857"),projection:"EPSG:3857",zoom:i.value,minZoom:n.minZoom,maxZoom:n.maxZoom,extent:n.extentLimit}),h=new qt;h.setProjection(p.getProjection()),h.setTracking(!0),h.on("change:position",()=>{const b=h.getPosition();y.setGeometry(b?new Ze(b):void 0)});const S=new Ce({zIndex:999,style:an,visible:!0,source:new Fe({features:[y]}),properties:{id:"cursorLayer"}}),u=new Ht,a=yt(new Xt({controls:[new Yt,new Qt({coordinateFormat:lo(4),projection:"EPSG:4326"}),new Kt,new $t({collapsible:!1}),new qe({label:n.loadingMessage}),new eo({}),new to,u],view:p,layers:wo([new He({zIndex:0,properties:{id:"osm"},source:new oo,visible:!0}),new He({zIndex:1,properties:{id:"gsi"},source:new no({url:"https://cyberjapandata.gsi.go.jp/xyz/std/{z}/{x}/{y}.png",attributions:['<a href="https://maps.gsi.go.jp/development/ichiran.html" target="_blank">国土地理院</a>']}),visible:!1}),new No({zIndex:2,properties:{id:"gsi-vector"},source:new ro({format:new ao,url:"https://cyberjapandata.gsi.go.jp/xyz/experimental_bvmap/{z}/{x}/{y}.pbf",maxZoom:17,minZoom:4,attributions:['<a href="https://maps.gsi.go.jp/vector/" target="_blank">地理院地図Vector</a>']}),renderBuffer:100,style:Ko,visible:!1}),S])}));a.value.getInteractions().getArray().filter(b=>b instanceof io)[0].setActive(!1);const x=new Me({condition:so,layers:[S]});x.on("select",()=>{}),a.value.addInteraction(x),s?.query.x&&s?.query.y&&S.setVisible(!0),a.value.on("moveend",()=>{const b=a.value.getView(),k=b.getCenter()??n.center;f.value=[k[0],k[1]],i.value=b.getZoom()??0});const I=new qe({label:n.loadingMessage,layers:a.value.getAllLayers()});return a.value.addControl(I),Pe(()=>{m.value&&(a.value.setTarget(m.value),t("ready",m.value)),a.value.getViewport().addEventListener("contextmenu",b=>{b.preventDefault(),t("contextmenu",b)})}),vt(()=>a.value.setTarget()),e({map:a,notification:u}),(b,k)=>(U(),lt("div",{ref_key:"ol",ref:m,class:"map-component py-0 px-0"},null,512))}});var ft=xo();const sn=Y({__name:"MapContextMenu",props:{map:{type:Object,default:void 0}},setup(d,{expose:e}){const o=d,n=wt(),t=X(),s=De(),c=E(!1),m=E({x:0,y:0}),i=E([0,0]),f=W(()=>s.zoom),v=async()=>{const S=n.resolve({query:{x:i.value[1].toFixed(6).toString(),y:i.value[0].toFixed(6).toString(),zoom:Math.round(f.value).toString()}});await navigator.clipboard.writeText(location.origin+S.href),t.setMessage("Copied to clipboard this coordinate link url.")},y=async(S=!1)=>{if(!o.map)return;const u=o.map;t.setLoading(!0),u.once("rendercomplete",()=>{const a=u.getSize()??[0,0],C=document.createElement("canvas");C.width=a[0],C.height=a[1];const A=C.getContext("2d");A.fillStyle="#1d3b58",A.fillRect(0,0,C.width,C.height);let x;Array.prototype.forEach.call(document.querySelectorAll(".ol-layer canvas"),b=>{if(b.width<0)return;const k=b.parentNode.style.opacity;A.globalAlpha=k===""?1:Number(k),x=b.style.transform.match(/^matrix\(([^(]*)\)$/)[1].split(",").map(Number),CanvasRenderingContext2D.prototype.setTransform.apply(A,x),A.drawImage(b,0,0)});const I=document.querySelector(".ol-fixedoverlay");I&&A.drawImage(I,0,0),CanvasRenderingContext2D.prototype.setTransform.apply(A,[1,0,0,1,0,0]),C.toBlob(async b=>{if(b)if(S){const k=ft.createWriteStream("map.png",{size:b.size});await new Response(b).body?.pipeTo(k)}else await navigator.clipboard.write([new ClipboardItem({"image/png":Promise.resolve(b)})]),t.setMessage("Copied to clipboard map image.")},"image/png",.9)}),u.renderSync(),t.setLoading(!1)};return e({show:S=>{o.map&&S&&(m.value={x:S.clientX,y:S.clientY},i.value=o.map.getEventCoordinate(S)),c.value=!0},hide:()=>{c.value=!1},position:m,coordinate:i}),(S,u)=>(U(),J(Ao,{modelValue:c.value,"onUpdate:modelValue":u[2]||(u[2]=a=>c.value=a),absolute:"",style:ht(`top: ${m.value.y}px; left: ${m.value.x}px`)},{default:l(()=>[r(ko,{density:"compact"},{default:l(()=>[r(bo,null,{default:l(()=>[r(re,{size:"small"},{default:l(()=>u[3]||(u[3]=[T("mdi-crosshairs")])),_:1,__:[3]}),u[7]||(u[7]=T(" Coordinate ")),r(re,{size:"small"},{default:l(()=>u[4]||(u[4]=[T("mdi-arrow-left-right")])),_:1,__:[4]}),T(" "+de(i.value[0].toFixed(6))+", ",1),r(re,{size:"small"},{default:l(()=>u[5]||(u[5]=[T("mdi-arrow-up-down")])),_:1,__:[5]}),T(" "+de(i.value[1].toFixed(6))+"   ",1),r(re,{size:"small"},{default:l(()=>u[6]||(u[6]=[T("mdi-magnify")])),_:1,__:[6]}),T(" Zoom: "+de(Math.round(f.value)),1)]),_:1,__:[7]}),r(Ae,{"prepend-icon":"mdi-link-variant",title:"Copy link to the clipboard",onClick:v}),r(H),r(Ae,{"prepend-icon":"mdi-image-marker",title:"Copy the map image to the clipboard",onClick:u[0]||(u[0]=a=>y(!1))}),r(Ae,{"prepend-icon":"mdi-file-image-marker",title:"Save map image to file",onClick:u[1]||(u[1]=a=>y(!0))})]),_:1})]),_:1},8,["modelValue","style"]))}}),cn=Y({__name:"ConfirmModal",props:{title:{type:String,required:!0},message:{type:String,default:""},discardable:{type:Boolean,default:!1},danger:{type:Boolean,default:!1}},emits:["submit","cancel","discard"],setup(d,{expose:e,emit:o}){const n=o,t=E(!1),s=E(null),c=v=>{s.value=v,t.value=!0},m=()=>{n("cancel"),s.value=null,t.value=!1},i=()=>{n("discard",s.value),s.value=null,t.value=!1},f=()=>{n("submit",s.value),m()};return e({show:c}),(v,y)=>(U(),J(me,{modelValue:t.value,"onUpdate:modelValue":y[0]||(y[0]=p=>t.value=p),persistent:"","max-width":"640px",onKeydown:ke(m,["esc"])},{default:l(()=>[r(ye,{title:d.title,subtitle:d.message},{append:l(()=>[r(_,{text:"Close"},{activator:l(({props:p})=>[r(R,F(p,{icon:"mdi-close",variant:"plain",onClick:m}),null,16)]),_:1})]),default:l(()=>[r(ve,null,{default:l(()=>[d.discardable?(U(),J(R,{key:0,color:"orange","prepend-icon":"mdi-undo-variant",variant:"plain",onClick:i},{default:l(()=>y[1]||(y[1]=[T(" Discard ")])),_:1,__:[1]})):pe("",!0),r(ie),d.danger?(U(),J(R,{key:1,color:"red","prepend-icon":"mdi-close-octagon",variant:"text",onClick:f},{default:l(()=>y[2]||(y[2]=[T(" OK ")])),_:1,__:[2]})):pe("",!0),r(R,{variant:"text",color:"secondary","prepend-icon":"mdi-cancel",onClick:m},{default:l(()=>y[3]||(y[3]=[T(" Cancel ")])),_:1,__:[3]}),d.danger?pe("",!0):(U(),J(R,{key:2,variant:"text",color:"primary","prepend-icon":"mdi-check",onClick:f},{default:l(()=>y[4]||(y[4]=[T(" OK ")])),_:1,__:[4]}))]),_:1})]),_:1},8,["title","subtitle"])]),_:1},8,["modelValue"]))}}),un=["red","pink","purple","deep-purple","indigo","blue","light-blue","cyan","teal","green","light-green","lime","yellow","amber","orange","deep-orange","brown","blue-grey","grey"],dn=Y({__name:"PropertiesEditorModal",emits:["submit","delete"],setup(d,{expose:e,emit:o}){const n=o,t=ut(),s=E(!1),c=E(fe),m=E(),i=E("basic"),f=E(!0);ge(s,S=>{S||(m.value=void 0,c.value=fe)});const v=S=>{s.value=!0,m.value=S,c.value=S.getProperties(),f.value=S.getGeometry().flatCoordinates.length===2},y=()=>{s.value=!1,c.value=fe},p=()=>{m.value&&(m.value.setProperties(c.value),n("submit",m.value)),s.value=!1},h=()=>{n("delete",m.value),s.value=!1};return ge(s,S=>{S||(i.value="basic",c.value.description="")}),e({show:v}),(S,u)=>(U(),J(me,{modelValue:s.value,"onUpdate:modelValue":u[9]||(u[9]=a=>s.value=a),persistent:"","max-width":"1024px",onKeydown:ke(y,["esc"])},{default:l(()=>[r(ye,{title:"Edit Properties",subtitle:"Edit the properties of the selected feature."},{append:l(()=>[r(_,{text:"Close"},{activator:l(({props:a})=>[r(R,F(a,{icon:"mdi-close",variant:"plain",onClick:y}),null,16)]),_:1})]),default:l(()=>[r(je,null,{default:l(()=>[r(To,{modelValue:i.value,"onUpdate:modelValue":u[0]||(u[0]=a=>i.value=a)},{default:l(()=>[r(Qe,{value:"basic","prepend-icon":"mdi-information"},{default:l(()=>u[10]||(u[10]=[T("Basic")])),_:1,__:[10]}),r(Qe,{value:"description","prepend-icon":"mdi-message-text"},{default:l(()=>u[11]||(u[11]=[T("Description")])),_:1,__:[11]})]),_:1},8,["modelValue"]),r(Io,{modelValue:i.value,"onUpdate:modelValue":u[8]||(u[8]=a=>i.value=a)},{default:l(()=>[r(Ke,{value:"basic"},{default:l(()=>[r(Eo,null,{default:l(()=>[r(oe,{cols:"12",md:"6"},{default:l(()=>[r(ne,{modelValue:c.value.name,"onUpdate:modelValue":u[1]||(u[1]=a=>c.value.name=a),label:"name",hint:"The name that pops up when you click a feature.","prepend-icon":"mdi-map-marker"},null,8,["modelValue"])]),_:1}),r(oe,{cols:"12",md:"6"},{default:l(()=>[r(ne,{modelValue:c.value.annotation,"onUpdate:modelValue":u[2]||(u[2]=a=>c.value.annotation=a),label:"Annotation",hint:"Text to display directly above the feature.","prepend-icon":"mdi-form-textbox"},null,8,["modelValue"])]),_:1}),r(oe,{cols:"12",md:"3"},{default:l(()=>[r(Ro,{modelValue:c.value.color,"onUpdate:modelValue":u[3]||(u[3]=a=>c.value.color=a),items:q(un),label:"Feature Color","prepend-icon":"mdi-palette"},{item:l(({props:a,item:C})=>[r(Ae,F(a,{title:C.title}),{prepend:l(()=>[r(re,{color:C.value},{default:l(()=>[T(" mdi-checkbox-"+de(C.value===c.value.color?"marked":"blank"),1)]),_:2},1032,["color"])]),_:2},1040,["title"])]),selection:l(({item:a})=>[r(re,{color:a.value},{default:l(()=>u[12]||(u[12]=[T("mdi-checkbox-blank")])),_:2,__:[12]},1032,["color"]),T(" "+de(a.title),1)]),_:1},8,["modelValue","items"])]),_:1}),r(oe,{cols:"12",sm:"6",md:"3"},{default:l(()=>[r(ne,{modelValue:c.value.thickness,"onUpdate:modelValue":u[4]||(u[4]=a=>c.value.thickness=a),modelModifiers:{number:!0},label:"Feature line thickness",hint:" If set to 0, only annotations will be displayed.",type:"number",minimum:"0","prepend-icon":"mdi-format-line-weight",suffix:"px"},null,8,["modelValue"])]),_:1}),r(oe,{cols:"12",sm:"6",md:"3"},{default:l(()=>[r(ne,{modelValue:c.value.annotationStyle,"onUpdate:modelValue":u[5]||(u[5]=a=>c.value.annotationStyle=a),label:"Annotation Text style",hint:"Set font weight and font-size. Default is `500 0.75rem`.",placeholder:"500 0.75rem","prepend-icon":"mdi-format-font"},null,8,["modelValue"])]),_:1}),r(oe,{cols:"12",sm:"6",md:"3"},{default:l(()=>[r(ne,{modelValue:c.value.opacity,"onUpdate:modelValue":u[6]||(u[6]=a=>c.value.opacity=a),modelModifiers:{number:!0},label:"Fill Opacity",hint:"Transparency of fills in Point and Polygons (0 to 1)",type:"number",minimum:"0",maximum:"1","prepend-icon":"mdi-opacity",step:"0.1"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),r(Ke,{value:"description"},{default:l(()=>[r(Oo,{hint:"The text to display in the popup. You can use Markdown notation.","persistent-hint":""},{default:l(()=>[r(q(pt),{modelValue:c.value.description,"onUpdate:modelValue":u[7]||(u[7]=a=>c.value.description=a),lang:q(Go)(),dark:q(t).current.value.dark,gutter:"",wrap:"",basic:""},null,8,["modelValue","lang","dark"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),r(ve,null,{default:l(()=>[r(R,{color:"red",variant:"text","prepend-icon":"mdi-delete",onClick:h},{default:l(()=>u[13]||(u[13]=[T("Delate")])),_:1,__:[13]}),r(ie),r(R,{color:"secondary",variant:"text","prepend-icon":"mdi-cancel",onClick:y},{default:l(()=>u[14]||(u[14]=[T(" Cancel ")])),_:1,__:[14]}),r(R,{color:"primary",variant:"text","prepend-icon":"mdi-check",onClick:p},{default:l(()=>u[15]||(u[15]=[T("Save")])),_:1,__:[15]})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}}),pn=Y({__name:"ExportModal",setup(d,{expose:e}){const o=X(),n=he(),t=E(!1),s=E("geojson"),c=E(!1),m=E("export-"+new Date().toLocaleDateString()),i=()=>t.value=!0,f=()=>t.value=!1,v=async()=>{o.setLoading(!0),await ae();const y=n.exportBlob(s.value,c.value),p=ft.createWriteStream(`${m.value}.json`,{size:y.size});await new Response(y).body?.pipeTo(p),o.setLoading(!1),f()};return e({show:i}),(y,p)=>(U(),J(me,{modelValue:t.value,"onUpdate:modelValue":p[3]||(p[3]=h=>t.value=h),"max-width":"480px",onKeydown:ke(f,["esc"])},{default:l(()=>[r(ye,{title:"Export",subtitle:"Import a local GeoJSON / TopoJSON file."},{append:l(()=>[r(_,{text:"Close"},{activator:l(({props:h})=>[r(R,F(h,{icon:"mdi-close",variant:"plain",onClick:f}),null,16)]),_:1})]),default:l(()=>[r(je,null,{default:l(()=>[r(Vo,{modelValue:s.value,"onUpdate:modelValue":p[0]||(p[0]=h=>s.value=h),label:"File Type",inline:""},{default:l(()=>[r($e,{label:"GeoJson",value:"geojson"}),r($e,{label:"TopoJson",value:"topojson"})]),_:1},8,["modelValue"]),r(ne,{modelValue:m.value,"onUpdate:modelValue":p[1]||(p[1]=h=>m.value=h),"prepend-icon":"mdi-file-download-outline",label:"Filename",suffix:`.${s.value}`,"hide-details":""},null,8,["modelValue","suffix"]),r(Fo,{modelValue:c.value,"onUpdate:modelValue":p[2]||(p[2]=h=>c.value=h),label:"Compress"},null,8,["modelValue"])]),_:1}),r(ve,null,{default:l(()=>[r(ie),r(R,{variant:"text",color:"secondary","prepend-icon":"mdi-cancel",onClick:f},{default:l(()=>p[4]||(p[4]=[T(" Cancel ")])),_:1,__:[4]}),r(R,{variant:"text",color:"primary","prepend-icon":"mdi-file-download",onClick:v},{default:l(()=>p[5]||(p[5]=[T(" Save ")])),_:1,__:[5]})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}}),fn=Y({__name:"ImportModal",emits:["loaded"],setup(d,{expose:e,emit:o}){const n=o,t=X(),s=he(),c=W({get:()=>t.loading,set:C=>t.setLoading(C)}),m=W({get:()=>t.progress,set:C=>t.setProgress(C)}),i=E(),f=E(!1),v=E([]),y=E(!1),p=new FileReader;p.onloadstart=C=>{c.value=!0,C.lengthComputable&&(m.value=Math.round(C.loaded/C.total*100))},p.onloadend=()=>{m.value=100,c.value=!1};const h=E(!1),S=()=>h.value=!0,u=()=>h.value=!1,a=async()=>{if(c.value=!0,f.value=!1,!i.value)return;const C=new FileReader;C.readAsText(i.value),C.onload=async()=>{const A=C.result;let x;try{x=JSON.parse(A)}catch{f.value=!0,v.value=["GeoJson parse error."];return}if(x.type==="Topology")try{x=So(x,"data")}catch{f.value=!0,v.value=["Topojson parse error."],c.value=!1;return}y.value&&(x=ct(x)),x.type==="FeatureCollection"&&x.features.forEach(I=>(I.id=Ge(),I)),s.setGeoJson(x),s.setRefresh(!0),f.value=!1,i.value=void 0,c.value=!1,n("loaded"),await ae(),u(),t.setMessage("GeoJson loaded successfully.")}};return e({show:S,hide:u}),(C,A)=>(U(),J(me,{modelValue:h.value,"onUpdate:modelValue":A[2]||(A[2]=x=>h.value=x),"max-width":"480px",onKeydown:ke(u,["esc"])},{default:l(()=>[r(ye,null,{title:l(()=>A[3]||(A[3]=[T("Import")])),append:l(()=>[r(_,{text:"Close"},{activator:l(({props:x})=>[r(R,F(x,{icon:"mdi-close",variant:"plain",onClick:u}),null,16)]),_:1})]),default:l(()=>[r(dt,null,{default:l(()=>A[4]||(A[4]=[T("Import a local GeoJSON / TopoJSON file.")])),_:1,__:[4]}),r(je,null,{default:l(()=>[r(_o,{modelValue:i.value,"onUpdate:modelValue":A[0]||(A[0]=x=>i.value=x),"show-size":"",required:"",placeholder:"Choose a GeoJSON file.",label:"GeoJson","prepend-icon":"mdi-paperclip",accept:"application/geo+json",onEmptied:A[1]||(A[1]=x=>i.value=void 0)},null,8,["modelValue"])]),_:1}),r(ve,null,{default:l(()=>[r(ie),r(R,{color:"secondary","prepend-icon":"mdi-cancel",variant:"text",onClick:u},{default:l(()=>A[5]||(A[5]=[T(" Cancel ")])),_:1,__:[5]}),r(R,{color:"primary","prepend-icon":"mdi-check",variant:"text",onClick:a},{default:l(()=>A[6]||(A[6]=[T("OK")])),_:1,__:[6]})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}}),gn=Y({__name:"SourceModal",emits:{close:()=>!0},setup(d,{expose:e,emit:o}){const n=o,t=he(),s=ut(),c=E(),m=E(),i=E(),f=E(s.current.value.dark),v=E(!1),y=E(""),p=E(0),h=()=>{v.value=!0,y.value=JSON.stringify(t.geojson,null,2)},S=()=>{try{const x=JSON.parse(y.value);t.setGeoJson(x)}catch{return}t.setRefresh(!0),u()},u=()=>{n("close"),v.value=!1},a=()=>m.value?.show(),C=()=>c.value?.show(),A=()=>y.value=JSON.stringify(t.geojson,null,2);return e({show:h}),(x,I)=>(U(),J(me,{modelValue:v.value,"onUpdate:modelValue":I[1]||(I[1]=b=>v.value=b),fullscreen:"",transition:"dialog-bottom-transition"},{default:l(()=>[r(ye,{class:"d-flex flex-column"},{title:l(()=>I[2]||(I[2]=[T("Source")])),append:l(()=>[r(_,{text:"Close"},{activator:l(({props:b})=>[r(R,F(b,{icon:"mdi-close",variant:"plain",onClick:u}),null,16)]),_:1})]),default:l(()=>[r(dt,{class:"flex-grow-0",style:{"flex-basis":"auto"}},{default:l(()=>I[3]||(I[3]=[T("Geojson source")])),_:1,__:[3]}),r(q(pt),{ref_key:"editor",ref:i,modelValue:y.value,"onUpdate:modelValue":I[0]||(I[0]=b=>y.value=b),dark:f.value,lang:q(Do)(),linter:q(jo)(),basic:"",class:"flex-grow-1",gutter:"",style:{"flex-basis":"0","overflow-y":"scroll"},wrap:""},null,8,["modelValue","dark","lang","linter"]),r(ve,{class:"flex-grow-0",style:{"flex-basis":"auto"}},{default:l(()=>[r(R,{color:"orange","prepend-icon":"mdi-upload",variant:"text",onClick:a},{default:l(()=>I[4]||(I[4]=[T(" Import ")])),_:1,__:[4]}),r(R,{disabled:p.value!==0,color:"green","prepend-icon":"mdi-download",variant:"text",onClick:C},{default:l(()=>I[5]||(I[5]=[T(" Export ")])),_:1,__:[5]},8,["disabled"]),r(ie),r(R,{color:"secondary","prepend-icon":"mdi-cancel",variant:"text",onClick:u},{default:l(()=>I[6]||(I[6]=[T(" Cancel ")])),_:1,__:[6]}),r(R,{disabled:i.value?.diagnosticCount!==0,color:"primary","prepend-icon":"mdi-check",variant:"text",onClick:S},{default:l(()=>I[7]||(I[7]=[T(" OK ")])),_:1,__:[7]},8,["disabled"])]),_:1})]),_:1}),r(fn,{ref_key:"importModal",ref:m,onLoaded:A},null,512),r(pn,{ref_key:"exportModal",ref:c},null,512)]),_:1},8,["modelValue"]))}});function mn(d,e,o=2,n){const t=e.getSource();if(t)switch(d){case"translate":return new mo({features:n,hitTolerance:o});case"modify":return new go({source:t});case"delete":return new fo({layers:[e]});case"point":return new Oe({source:t,type:"Point"});case"line":return new Oe({source:t,type:"LineString"});case"square":return new Xe({source:t,sides:4,canRotate:!0});case"circle":return new Xe({source:t,sides:2,canRotate:!1});case"polygon":return new Oe({source:t,type:"Polygon"});case"transform":{Re.prototype.Cursors.rotate="url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABcAAAAXAgMAAACdRDwzAAAAAXNSR0IArs4c6QAAAAlQTFRF////////AAAAjvTD7AAAAAF0Uk5TAEDm2GYAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH2wwSEgUFmXJDjQAAAEZJREFUCNdjYMAOuCCk6goQpbp0GpRSAFKcqdNmQKgIILUoNAxIMUWFhoKosNDQBKDgVAilCqcaQBogFFNoGNjsqSgUTgAAM3ES8k912EAAAAAASUVORK5CYII=') 5 5, auto",Re.prototype.Cursors.rotate0="url('data:image/png;base64,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') 5 5, auto";const s=new Re({enableRotatedTransform:!1,addCondition:po,layers:[e],hitTolerance:o,translateFeature:!0,scale:!0,rotate:!0,keepRectangle:!1,translate:!0,stretch:!0});return s.on(["select"],c=>{}),s}case"fill":return new uo({name:"fill color"},{color:"red"});case"hole":{const s=new co({layers:[e],type:"Polygon"});return t.removeFeature(s.getPolygon()),s}}}const yn=Y({__name:"MapEditorToolbar",props:{map:{type:Object,required:!0},layer:{type:Object,required:!0}},setup(d){const e=d,o=he(),n=E(),t=E(),s=E(),c=E("default"),m=E(2),i=E(!1),f=W({get:()=>o.requestRefresh,set:k=>o.setRefresh(k)}),v=W({get:()=>o.getFeatures(),set:k=>o.setFeatures(k)}),y=new Me({condition:k=>k.type===it.SINGLECLICK,layers:[e.layer],hitTolerance:m.value,style:k=>be(k,L.SELECTED),multi:!1});y.on("select",async k=>{if(c.value!=="edit")return;const g=k.selected[0].getId(),w=e.layer.getSource();if(!g||!w)return;const P=w.getFeatureById(g);P&&s.value?.show(P)});const p=new yo({source:e.layer.getSource()});let h;const S=new st;ge(c,k=>{const g=e.map;y.getFeatures().clear(),!(h&&(g.removeInteraction(h),k==="default"))&&(i.value?g.removeInteraction(p):g.addInteraction(p),h=mn(k,e.layer,m.value,y.getFeatures()),h&&(h.on("drawend",w=>{const P=fe;return w.feature.setId(Ge()),w.feature.setProperties(P),c.value="translate",w}),h.on("change",w=>{}),h.on("error",w=>{}),h.on("propertychange",w=>{}),g.addInteraction(h)))});const u=()=>y.getFeatures().clear(),a=async k=>{const g=k.getId(),w=e.layer.getSource();if(!g||!w)return;const P=w.getFeatureById(g);P&&(P.setProperties(k.getProperties()),await ae(),v.value=w.getFeatures(),f.value=!0,u())},C=async k=>{const g=k.getId(),w=e.layer.getSource();if(!g||!w)return;const P=w.getFeatureById(g);P&&(w.removeFeature(P),u(),v.value=w.getFeatures(),f.value=!0,await ae())},A=()=>{v.value=e.layer.getSource().getFeatures(),n.value?.show()},x=async()=>{const k=e.layer.getSource();k.clear(),k.addFeatures(v.value),e.layer.setSource(k),await ae()},I=()=>{o.clear(),x()},b=()=>{const k=e.map;i.value?k.removeInteraction(p):k.addInteraction(p),i.value=!i.value};return Pe(()=>{const k=e?.map;k&&(h&&k.addInteraction(h),k.addInteraction(S),k.addInteraction(y))}),(k,g)=>(U(),lt(xt,null,[r(Lo,{color:"primary",dense:"",elevation:"2"},{default:l(()=>[r(Po,{modelValue:c.value,"onUpdate:modelValue":g[0]||(g[0]=w=>c.value=w),class:"px-0",variant:"text",theme:"dark"},{default:l(()=>[r(_,{location:"bottom"},{activator:l(({props:w})=>[r(R,F({icon:"mdi-cursor-default",tile:"",value:"default"},w),null,16)]),default:l(()=>[g[4]||(g[4]=T(" Default "))]),_:1,__:[4]}),r(H,{vertical:""}),r(_,{location:"bottom"},{activator:l(({props:w})=>[r(R,F({icon:"mdi-arrow-all",tile:"",value:"translate"},w),null,16)]),default:l(()=>[g[5]||(g[5]=T(" Translate "))]),_:1,__:[5]}),r(_,{location:"bottom"},{activator:l(({props:w})=>[r(R,F({icon:"mdi-vector-point-select",tile:"",value:"edit"},w),null,16)]),default:l(()=>[g[6]||(g[6]=T(" Edit Properties "))]),_:1,__:[6]}),r(H,{vertical:""}),r(_,{location:"bottom"},{activator:l(({props:w})=>[r(R,F({icon:"mdi-vector-polyline-edit",tile:"",value:"modify"},w),null,16)]),default:l(()=>[g[7]||(g[7]=T(" Modify (Alt + Click to delete point.) "))]),_:1,__:[7]}),r(_,{location:"bottom"},{activator:l(({props:w})=>[r(R,F({icon:"mdi-vector-square-edit",tile:"",value:"transform"},w),null,16)]),default:l(()=>[g[8]||(g[8]=T(" Rotate / Scale / Move "))]),_:1,__:[8]}),r(_,{location:"bottom"},{activator:l(({props:w})=>[r(R,F({icon:"mdi-vector-square-remove",tile:"",value:"delete"},w),null,16)]),default:l(()=>[g[9]||(g[9]=T(" Delete "))]),_:1,__:[9]}),r(H,{vertical:""}),r(_,{location:"bottom"},{activator:l(({props:w})=>[r(R,F({icon:"mdi-vector-point-plus",tile:"",value:"point"},w),null,16)]),default:l(()=>[g[10]||(g[10]=T(" Point "))]),_:1,__:[10]}),r(_,{location:"bottom"},{activator:l(({props:w})=>[r(R,F({icon:"mdi-vector-line",tile:"",value:"line"},w),null,16)]),default:l(()=>[g[11]||(g[11]=T(" Line "))]),_:1,__:[11]}),r(_,{location:"bottom"},{activator:l(({props:w})=>[r(R,F({icon:"mdi-vector-polygon",tile:"",value:"polygon"},w),null,16)]),default:l(()=>[g[12]||(g[12]=T(" Polygon "))]),_:1,__:[12]}),r(_,{location:"bottom"},{activator:l(({props:w})=>[r(R,F({icon:"mdi-vector-difference",tile:"",value:"hole"},w),null,16)]),default:l(()=>[g[13]||(g[13]=T(" Draw Hole "))]),_:1,__:[13]}),r(_,{location:"bottom"},{activator:l(({props:w})=>[r(R,F({icon:"mdi-vector-square",tile:"",value:"square"},w),null,16)]),default:l(()=>[g[14]||(g[14]=T(" Square "))]),_:1,__:[14]}),r(_,{location:"bottom"},{activator:l(({props:w})=>[r(R,F({icon:"mdi-vector-circle",tile:"",value:"circle"},w),null,16)]),default:l(()=>[g[15]||(g[15]=T(" Circle "))]),_:1,__:[15]}),r(H,{vertical:""}),r(_,{location:"bottom"},{activator:l(({props:w})=>[r(R,F({icon:"mdi-format-color-fill",tile:"",value:"fill"},w),null,16)]),default:l(()=>[g[16]||(g[16]=T(" Fill "))]),_:1,__:[16]})]),_:1},8,["modelValue"]),r(H,{vertical:""}),r(_,{location:"bottom"},{activator:l(({props:w})=>[r(R,F({icon:`mdi-grid${i.value?"":"-off"}`,tile:""},w,{onClick:b}),null,16,["icon"])]),default:l(()=>[g[17]||(g[17]=T(" Snap "))]),_:1,__:[17]}),r(H,{vertical:""}),r(ie),r(_,{location:"bottom"},{activator:l(({props:w})=>[r(R,F({icon:"mdi-undo",tile:""},w,{onClick:g[1]||(g[1]=P=>q(S).undo())}),null,16)]),default:l(()=>[g[18]||(g[18]=T(" Undo "))]),_:1,__:[18]}),r(_,{location:"bottom"},{activator:l(({props:w})=>[r(R,F({icon:"mdi-redo",tile:""},w,{onClick:g[2]||(g[2]=P=>q(S).redo())}),null,16)]),default:l(()=>[g[19]||(g[19]=T(" Redo "))]),_:1,__:[19]}),r(H,{vertical:""}),r(_,{location:"bottom"},{activator:l(({props:w})=>[r(R,F({icon:"mdi-delete",tile:""},w,{onClick:g[3]||(g[3]=P=>t.value?.show())}),null,16)]),default:l(()=>[g[20]||(g[20]=T(" Clear "))]),_:1,__:[20]}),r(H,{vertical:""}),r(_,{location:"bottom"},{activator:l(({props:w})=>[r(R,F({icon:"mdi-code-json",tile:""},w,{onClick:A}),null,16)]),default:l(()=>[g[21]||(g[21]=T(" Geojson Source "))]),_:1,__:[21]})]),_:1}),r(cn,{ref_key:"confirmModal",ref:t,danger:"",message:"Are you sure you want to remove all features?",title:"Clear",onSubmit:I},null,512),r(dn,{ref_key:"propertiesModal",ref:s,onCancel:u,onDelete:C,onSubmit:a},null,512),r(gn,{ref_key:"codeModal",ref:n,onClose:x},null,512)],64))}}),bn=Y({__name:"HomeView",setup(d){const e=X(),o=De(),n=he(),t=E(),s=E(),c=E(),m=E(!1),i=W({get:()=>e.message,set:a=>e.setMessage(a)}),f=W({get:()=>e.loading,set:a=>e.setLoading(a)}),v=W({get:()=>o.level,set:a=>o.setLevel(a)}),y=W({get:()=>n.getFeatures(),set:a=>n.setFeatures(a)}),p=new Ce({properties:{id:"locationLayer"},zIndex:5}),h=new Ce({source:new Fe({features:y.value}),style:a=>be(a),zIndex:10,properties:{id:"editorLayer"}}),S=new Me({condition:a=>a.type===it.SINGLECLICK,layers:[h],hitTolerance:2,style:a=>be(a,L.SELECTED),multi:!1});ge(()=>v.value,a=>{const C=t.value?.map;if(!C)return;const A=C.getLayers();A.forEach(x=>(x instanceof Ce&&rt(x,a),x)),C.setLayers(A)}),ge(()=>i.value,a=>t.value?.notification.show(a)),Pe(async()=>{const a=t.value?.map;a&&(f.value=!0,p.setSource(new Fe({features:y.value})),rt(p,v.value),a.addLayer(p),a.addLayer(h),a.addInteraction(new st),a.addInteraction(S),f.value=!1)});const u=a=>{s.value?.show(a)};return St(async(a,C,A)=>{a.params.region!==C.params.region&&(m.value=!1),A(),await ae(),a.params.region!==C.params.region&&(m.value=!0)}),(a,C)=>(U(),J(Mo,{fluid:"",class:"px-0 py-0 d-flex flex-column h-100"},{default:l(()=>[t.value?(U(),J(yn,{key:0,ref_key:"mapToolbar",ref:c,map:t.value.map,layer:q(h)},null,8,["map","layer"])):pe("",!0),r(ln,{ref_key:"mapComponent",ref:t,onContextmenu:u},null,512),t.value?(U(),J(sn,{key:1,ref_key:"mapContextMenu",ref:s,map:t.value.map},null,8,["map"])):pe("",!0)]),_:1}))}});export{bn as default};
