import{B as Ee,M as Ce,C as Y,u as R,i as Me,V as re,a as Te,T as he,I as Pe,H as xe,L as ce,g as ve,t as K,S as ae,b as q,D as Ie,c as U,d as ue,P as O,e as X,f as G,F as H,h as fe,j as pe,k as z,l as ie,m as Q,n as x,o as I,p as se,q as Fe,r as Ne,R as j,s as me,v as ee,w as B,x as te,y as Ve,z as de,A as _e}from"./ol-DQrXnsrk.js";var De=class extends Ee{constructor(e){e=e||{},super();var t=this.input=e.input;t||(t=this.input=document.createElement("input"),e.type&&t.setAttribute("type",e.type),e.min!==void 0&&t.setAttribute("min",e.min),e.max!==void 0&&t.setAttribute("max",e.max),e.step!==void 0&&t.setAttribute("step",e.step),e.parent&&e.parent.appendChild(t)),e.disabled&&(t.disabled=!0),e.checked!==void 0&&(t.checked=!!e.checked),e.val!==void 0&&(t.value=e.val),e.hidden&&t.classList.add("ol-input-hidden"),t.addEventListener("focus",function(){this.element&&this.element.classList.add("ol-focus")}.bind(this));var i;t.addEventListener("focusout",function(){this.element&&(i&&clearTimeout(i),i=setTimeout(function(){this.element.classList.remove("ol-focus")}.bind(this),0))}.bind(this))}_listenDrag(e,t){var i=function(s){this.moving=!0,this.element.classList.add("ol-moving");var r=function(n){n.type==="pointerup"&&(document.removeEventListener("pointermove",r),document.removeEventListener("pointerup",r),document.removeEventListener("pointercancel",r),setTimeout(function(){this.moving=!1,this.element.classList.remove("ol-moving")}.bind(this))),n.target===e&&t(n),n.stopPropagation(),n.preventDefault()}.bind(this);document.addEventListener("pointermove",r,!1),document.addEventListener("pointerup",r,!1),document.addEventListener("pointercancel",r,!1),s.stopPropagation(),s.preventDefault()}.bind(this);e.addEventListener("mousedown",i,!1),e.addEventListener("touchstart",i,!1)}setValue(e){e!==void 0&&(this.input.value=e),this.input.dispatchEvent(new Event("change"))}getValue(){return this.input.value}getInputElement(){return this.input}},ne=class extends De{constructor(e){e=e||{},super(e);var t=this.element=document.createElement("label");e.html instanceof Element?t.appendChild(e.html):e.html!==void 0&&(t.innerHTML=e.html),t.className=("ol-ext-check ol-ext-checkbox "+(e.className||"")).trim(),this.input.parentNode&&this.input.parentNode.insertBefore(t,this.input),t.appendChild(this.input),t.appendChild(document.createElement("span")),e.after&&t.appendChild(document.createTextNode(e.after)),this.input.addEventListener("change",function(){this.dispatchEvent({type:"check",checked:this.input.checked,value:this.input.value})}.bind(this))}isChecked(){return this.input.checked}},Ae=class extends ne{constructor(e){e=e||{},super(e),this.element.className=("ol-ext-toggle-switch "+(e.className||"")).trim()}},Re=class extends ne{constructor(e){e=e||{},super(e),this.element.className=("ol-ext-check ol-ext-radio "+(e.className||"")).trim()}},o={};o.create=function(a,e){e=e||{};var t;if(a==="TEXT")t=document.createTextNode(e.html||""),e.parent&&e.parent.appendChild(t);else{t=document.createElement(a.toLowerCase()),/button/i.test(a)&&t.setAttribute("type","button");for(var i in e)switch(i){case"className":{e.className&&e.className.trim&&t.setAttribute("class",e.className.trim());break}case"text":{t.innerText=e.text;break}case"html":{e.html instanceof Element?t.appendChild(e.html):e.html!==void 0&&(t.innerHTML=e.html);break}case"parent":{e.parent&&e.parent.appendChild(t);break}case"options":{if(/select/i.test(a))for(var s in e.options)o.create("OPTION",{html:s,value:e.options[s],parent:t});break}case"style":{o.setStyle(t,e.style);break}case"change":case"click":{o.addListener(t,i,e[i]);break}case"on":{for(var r in e.on)o.addListener(t,r,e.on[r]);break}case"checked":{t.checked=!!e.checked;break}default:{t.setAttribute(i,e[i]);break}}}return t};o.createSwitch=function(a){var e=o.create("INPUT",{type:"checkbox",on:a.on,click:a.click,change:a.change,parent:a.parent}),t=Object.assign({input:e},a||{});return new Ae(t),e};o.createCheck=function(a){var e=o.create("INPUT",{name:a.name,type:a.type==="radio"?"radio":"checkbox",on:a.on,parent:a.parent}),t=Object.assign({input:e},a||{});return a.type==="radio"?new Re(t):new ne(t),e};o.setHTML=function(a,e){e instanceof Element?a.appendChild(e):e!==void 0&&(a.innerHTML=e)};o.appendText=function(a,e){a.appendChild(document.createTextNode(e||""))};o.addListener=function(a,e,t,i){typeof e=="string"&&(e=e.split(" ")),e.forEach(function(s){a.addEventListener(s,t,i)})};o.removeListener=function(a,e,t){typeof e=="string"&&(e=e.split(" ")),e.forEach(function(i){a.removeEventListener(i,t)})};o.show=function(a){a.style.display=""};o.hide=function(a){a.style.display="none"};o.hidden=function(a){return o.getStyle(a,"display")==="none"};o.toggle=function(a){a.style.display=a.style.display==="none"?"":"none"};o.setStyle=function(a,e){for(var t in e)switch(t){case"top":case"left":case"bottom":case"right":case"minWidth":case"maxWidth":case"width":case"height":{typeof e[t]=="number"?a.style[t]=e[t]+"px":a.style[t]=e[t];break}default:a.style[t]=e[t]}};o.getStyle=function(a,e){var t,i=(a.ownerDocument||document).defaultView;if(i&&i.getComputedStyle)e=e.replace(/([A-Z])/g,"-$1").toLowerCase(),t=i.getComputedStyle(a,null).getPropertyValue(e);else if(a.currentStyle&&(e=e.replace(/-(\w)/g,function(s,r){return r.toUpperCase()}),t=a.currentStyle[e],/^\d+(em|pt|%|ex)?$/i.test(t)))return(function(s){var r=a.style.left,n=a.runtimeStyle.left;return a.runtimeStyle.left=a.currentStyle.left,a.style.left=s||0,s=a.style.pixelLeft+"px",a.style.left=r,a.runtimeStyle.left=n,s})(t);return/px$/.test(t)?parseInt(t):t};o.outerHeight=function(a){return a.offsetHeight+o.getStyle(a,"marginBottom")};o.outerWidth=function(a){return a.offsetWidth+o.getStyle(a,"marginLeft")};o.offsetRect=function(a){var e=a.getBoundingClientRect();return{top:e.top+(window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0),left:e.left+(window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft||0),height:e.height||e.bottom-e.top,width:e.width||e.right-e.left}};o.getFixedOffset=function(a){var e={left:0,top:0},t=function(i){if(!i)return e;if(o.getStyle(i,"position")==="absolute"&&o.getStyle(i,"transform")!=="none"){var s=i.getBoundingClientRect();return e.left+=s.left,e.top+=s.top,e}return t(i.offsetParent)};return t(a.offsetParent)};o.positionRect=function(a,e){var t=0,i=0,s=function(r){if(r)return t+=r.offsetLeft,i+=r.offsetTop,s(r.offsetParent);var n={top:a.offsetTop+i,left:a.offsetLeft+t};return e&&(n.top-=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0,n.left-=window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft||0),n.bottom=n.top+a.offsetHeight,n.right=n.top+a.offsetWidth,n};return s(a.offsetParent)};o.scrollDiv=function(a,e){e=e||{};var t=!1,i=0,s,r=0,n=typeof e.onmove=="function"?e.onmove:function(){},h=e.vertical?"screenY":"screenX",c=e.vertical?"scrollTop":"scrollLeft",u=!1,g,l,f=0,m=function(){S&&(f++,setTimeout(d))},d=function(){if(S){if(f--,f)return;var _=a.clientHeight,k=a.scrollHeight;g=_/k,S.style.height=g*100+"%",S.style.top=a.scrollTop/k*100+"%",L.style.height=_+"px",_>k-.5?L.classList.add("ol-100pc"):L.classList.remove("ol-100pc")}},y=function(_){_.target.classList.contains("ol-noscroll")||(u=!1,t=_[h],r=new Date,a.classList.add("ol-move"),_.preventDefault(),window.addEventListener("pointermove",w),o.addListener(window,["pointerup","pointercancel"],M))},w=function(_){if(t!==!1){var k=(l?-1/g:1)*(t-_[h]);u=u||Math.round(k),a[c]+=k,s=new Date,s-r&&(i=(i+k/(s-r))/2),t=_[h],r=s,k&&n(!0)}else u=!0},E=function(_){var k=_>0?Math.min(100,_/2):Math.max(-100,_/2);_-=k,a[c]+=k,-1<_&&_<1?(u?setTimeout(function(){a.classList.remove("ol-move")}):a.classList.remove("ol-move"),u=!1,n(!1)):setTimeout(function(){E(_)},40)},L,S;if(e.vertical&&e.minibar){var C=function(_){a.removeEventListener("pointermove",C),a.parentNode.classList.add("ol-miniscroll"),S=o.create("DIV"),L=o.create("DIV",{className:"ol-scroll",html:S}),a.parentNode.insertBefore(L,a),S.addEventListener("pointerdown",function(k){l=!0,y(k)}),e.mousewheel&&(o.addListener(L,["mousewheel","DOMMouseScroll","onmousewheel"],function(k){v(k)}),o.addListener(S,["mousewheel","DOMMouseScroll","onmousewheel"],function(k){v(k)})),a.parentNode.addEventListener("pointerenter",m),window.addEventListener("resize",m),_!==!1&&m()};a.parentNode?C(!1):a.addEventListener("pointermove",C),a.addEventListener("scroll",function(){m()})}a.style["touch-action"]="none",a.style.overflow="hidden",a.classList.add("ol-scrolldiv"),o.addListener(a,["pointerdown"],function(_){l=!1,y(_)}),a.addEventListener("click",function(_){a.classList.contains("ol-move")&&(_.preventDefault(),_.stopPropagation())},!0);var M=function(_){r=new Date-r,r>100||l?i=0:r>0&&(i=((i||0)+(t-_[h])/r)/2),E(e.animate===!1?0:i*200),t=!1,i=0,r=0,a.classList.contains("ol-move")?a.classList.remove("ol-hasClick"):(a.classList.add("ol-hasClick"),setTimeout(function(){a.classList.remove("ol-hasClick")},500)),l=!1,window.removeEventListener("pointermove",w),o.removeListener(window,["pointerup","pointercancel"],M)},v=function(_){var k=Math.max(-1,Math.min(1,_.wheelDelta||-_.detail));return a.classList.add("ol-move"),a[c]-=k*30,a.classList.remove("ol-move"),!1};return e.mousewheel&&o.addListener(a,["mousewheel","DOMMouseScroll","onmousewheel"],v),{refresh:m}};o.dispatchEvent=function(a,e){var t;try{t=new CustomEvent(a)}catch{t=document.createEvent("CustomEvent"),t.initCustomEvent(a,!0,!0,{})}e.dispatchEvent(t)};o.setCursor=function(a,e){a instanceof Ce&&(a=a.getTargetElement()),!("ontouchstart"in window)&&a instanceof Element&&(a.style.cursor=e)};var ye=class extends Y{constructor(e){e=e||{};var t=o.create("DIV",{className:e.switcherClass||"ol-layerswitcher"});super({element:t,target:e.target});var i=this;this.dcount=0,this.show_progress=e.show_progress,this.oninfo=typeof e.oninfo=="function"?e.oninfo:null,this.onextent=typeof e.onextent=="function"?e.onextent:null,this.hasextent=e.extent||e.onextent,this.hastrash=e.trash,this.reordering=e.reordering!==!1,this._layers=[],this._layerGroup=e.layerGroup&&e.layerGroup.getLayers?e.layerGroup:null,this.onchangeCheck=typeof e.onchangeCheck=="function"?e.onchangeCheck:null,typeof e.displayInLayerSwitcher=="function"&&(this.displayInLayerSwitcher=e.displayInLayerSwitcher),e.target||(t.classList.add("ol-unselectable"),t.classList.add("ol-control"),t.classList.add(e.collapsed!==!1?"ol-collapsed":"ol-forceopen"),e.counter&&t.classList.add("ol-counter"),this.counter=o.create("SPAN",{class:"ol-counter",text:0,parent:t}),this.button=o.create("BUTTON",{type:"button",parent:t}),this.button.addEventListener("touchstart",function(s){t.classList.toggle("ol-forceopen"),t.classList.add("ol-collapsed"),i.dispatchEvent({type:"toggle",collapsed:t.classList.contains("ol-collapsed")}),s.preventDefault(),i.overflow()}),this.button.addEventListener("click",function(){t.classList.toggle("ol-forceopen"),t.classList.add("ol-collapsed"),i.dispatchEvent({type:"toggle",collapsed:!t.classList.contains("ol-forceopen")}),i.overflow()}),e.mouseover&&(t.addEventListener("mouseleave",function(){t.classList.add("ol-collapsed"),i.dispatchEvent({type:"toggle",collapsed:!0})}),t.addEventListener("mouseover",function(){t.classList.remove("ol-collapsed"),i.dispatchEvent({type:"toggle",collapsed:!1})})),e.minibar&&(e.noScroll=!0),e.noScroll||(this.topv=o.create("DIV",{className:"ol-switchertopdiv",parent:t,click:function(){i.overflow("+50%")}}),this.botv=o.create("DIV",{className:"ol-switcherbottomdiv",parent:t,click:function(){i.overflow("-50%")}})),this._noScroll=e.noScroll),this.panel_=o.create("UL",{className:"panel"}),this.panelContainer_=o.create("DIV",{className:"panel-container",html:this.panel_,parent:t}),!e.target&&!e.noScroll&&o.addListener(this.panel_,"mousewheel DOMMouseScroll onmousewheel",function(s){i.overflow(Math.max(-1,Math.min(1,s.wheelDelta||-s.detail)))&&(s.stopPropagation(),s.preventDefault())}),this.header_=o.create("LI",{className:"ol-header",parent:this.panel_}),this.set("drawDelay",e.drawDelay||0),this.set("selection",e.selection),e.minibar&&setTimeout(function(){var s=o.scrollDiv(this.panelContainer_,{mousewheel:!0,vertical:!0,minibar:!0});this.on(["drawlist","toggle"],function(){s.refresh()})}.bind(this))}displayInLayerSwitcher(e){return e.get("displayInLayerSwitcher")!==!1}setMap(e){if(super.setMap(e),this.drawPanel(),this._listener)for(var t in this._listener)R(this._listener[t]);this._listener=null,e&&(this._listener={moveend:e.on("moveend",this.viewChange.bind(this)),size:e.on("change:size",this.overflow.bind(this))},this._layerGroup?this._listener.change=this._layerGroup.getLayers().on("change:length",this.drawPanel.bind(this)):this._listener.change=e.getLayerGroup().getLayers().on("change:length",this.drawPanel.bind(this)))}show(){this.element.classList.add("ol-forceopen"),this.overflow(),this.dispatchEvent({type:"toggle",collapsed:!1})}hide(){this.element.classList.remove("ol-forceopen"),this.overflow(),this.dispatchEvent({type:"toggle",collapsed:!0})}toggle(){this.element.classList.toggle("ol-forceopen"),this.overflow(),this.dispatchEvent({type:"toggle",collapsed:!this.isOpen()})}isOpen(){return this.element.classList.contains("ol-forceopen")}setHeader(e){o.setHTML(this.header_,e)}overflow(e){if(this.button&&!this._noScroll){if(o.hidden(this.panel_)){o.setStyle(this.element,{height:"auto"});return}var t=o.outerHeight(this.element),i=o.outerHeight(this.panel_),s=this.button.offsetTop+o.outerHeight(this.button),r=this.panel_.offsetTop-s;if(i>t-s){o.setStyle(this.element,{height:"100%"});var n=this.panel_.querySelectorAll("li.ol-visible .li-content")[0],h=n?2*o.getStyle(n,"height"):0;switch(e){case 1:r+=h;break;case-1:r-=h;break;case"+50%":r+=Math.round(t/2);break;case"-50%":r-=Math.round(t/2);break}return r+i<=t-3*s/2?(r=t-3*s/2-i,o.hide(this.botv)):o.show(this.botv),r>=0?(r=0,o.hide(this.topv)):o.show(this.topv),o.setStyle(this.panel_,{top:r+"px"}),!0}else return o.setStyle(this.element,{height:"auto"}),o.setStyle(this.panel_,{top:0}),o.hide(this.botv),o.hide(this.topv),!1}else return!1}_setLayerForLI(e,t){var i=[];t.getLayers&&i.push(t.getLayers().on("change:length",this.drawPanel.bind(this))),e&&(i.push(t.on("change:opacity",(function(){this.setLayerOpacity(t,e)}).bind(this))),i.push(t.on("change:visible",(function(){this.setLayerVisibility(t,e)}).bind(this)))),i.push(t.on("propertychange",(function(s){(s.key==="displayInLayerSwitcher"||s.key==="openInLayerSwitcher"||s.key==="title"||s.key==="name")&&this.drawPanel(s)}).bind(this))),this._layers.push({li:e,layer:t,listeners:i})}setLayerOpacity(e,t){var i=t.querySelector(".layerswitcher-opacity-cursor");i&&(i.style.left=e.getOpacity()*100+"%"),this.dispatchEvent({type:"layer:opacity",layer:e})}setLayerVisibility(e,t){var i=t.querySelector(".ol-visibility");i&&(i.checked=e.getVisible()),e.getVisible()?t.classList.add("ol-visible"):t.classList.remove("ol-visible"),this.dispatchEvent({type:"layer:visible",layer:e})}_clearLayerForLI(){this._layers.forEach(function(e){e.listeners.forEach(function(t){R(t)})}),this._layers=[]}_getLayerForLI(e){for(var t=0,i;i=this._layers[t];t++)if(i.li===e)return i.layer;return null}viewChange(){this.panel_.querySelectorAll("li").forEach(function(e){var t=this._getLayerForLI(e);t&&(this.testLayerVisibility(t)?e.classList.remove("ol-layer-hidden"):e.classList.add("ol-layer-hidden"))}.bind(this))}getPanel(){return this.panelContainer_}drawPanel(){if(this.getMap()){var e=this;this.dcount++,setTimeout(function(){e.drawPanel_()},this.get("drawDelay")||0)}}drawPanel_(){if(!(--this.dcount||this.dragging_)){var e=this.panelContainer_.scrollTop;this._clearLayerForLI(),this.panel_.querySelectorAll("li").forEach(function(t){t.classList.contains("ol-header")||t.remove()}.bind(this)),this._layerGroup?this.drawList(this.panel_,this._layerGroup.getLayers()):this.getMap()&&this.drawList(this.panel_,this.getMap().getLayers()),this.panelContainer_.scrollTop=e,this.counter.innerHTML=this.panel_.parentNode.querySelectorAll("ul.panel > li:not(.ol-header)").length}}switchLayerVisibility(e,t){e.get("baseLayer")?(e.getVisible()||e.setVisible(!0),t.forEach(function(i){e!==i&&i.get("baseLayer")&&i.getVisible()&&i.setVisible(!1)})):e.setVisible(!e.getVisible())}testLayerVisibility(e){if(!this.getMap())return!0;var t=this.getMap().getView().getResolution(),i=this.getMap().getView().getZoom();if(e.getMaxResolution()<=t||e.getMinResolution()>=t)return!1;if(e.getMinZoom&&(e.getMinZoom()>=i||e.getMaxZoom()<i))return!1;var s=e.getExtent();if(s){var r=this.getMap().getView().calculateExtent(this.getMap().getSize());return Me(r,s)}return!0}dragOrdering_(e){e.stopPropagation(),e.preventDefault();var t=this,i=e.currentTarget.parentNode.parentNode,s=!0,r=this.panel_,n,h=e.pageY||e.touches&&e.touches.length&&e.touches[0].pageY||e.changedTouches&&e.changedTouches.length&&e.changedTouches[0].pageY,c,u,g,l;i.parentNode.classList.add("drag");function f(){if(c){var d=g,y=t.getSelection()===d;if(d&&c){var w;l?w=l.getLayers():w=t._layerGroup?t._layerGroup.getLayers():t.getMap().getLayers();for(var E=w.getArray(),L=0;L<E.length;L++)if(E[L]==d){w.removeAt(L);break}for(var S=0;S<E.length;S++)if(E[S]===c){L>S?w.insertAt(S,d):w.insertAt(S+1,d);break}}y&&t.selectLayer(d),t.dispatchEvent({type:"reorder-end",layer:d,group:l})}i.parentNode.querySelectorAll("li").forEach(function(C){C.classList.remove("dropover"),C.classList.remove("dropover-after"),C.classList.remove("dropover-before")}),i.classList.remove("drag"),i.parentNode.classList.remove("drag"),t.element.classList.remove("drag"),u&&u.remove(),o.removeListener(document,"mousemove touchmove",m),o.removeListener(document,"mouseup touchend touchcancel",f)}function m(d){if(n=d.pageY||d.touches&&d.touches.length&&d.touches[0].pageY||d.changedTouches&&d.changedTouches.length&&d.changedTouches[0].pageY,s&&Math.abs(h-n)>2&&(s=!1,i.classList.add("drag"),g=t._getLayerForLI(i),c=!1,l=t._getLayerForLI(i.parentNode.parentNode),u=o.create("LI",{className:"ol-dragover",html:i.innerHTML,style:{position:"absolute","z-index":1e4,left:i.offsetLeft,opacity:.5,width:o.outerWidth(i),height:o.getStyle(i,"height")},parent:r}),t.element.classList.add("drag"),t.dispatchEvent({type:"reorder-start",layer:g,group:l})),!s){d.preventDefault(),d.stopPropagation(),o.setStyle(u,{top:n-o.offsetRect(r).top+r.scrollTop+5});var y;if(!d.touches)y=d.target,d.target.shadowRoot&&(y=d.composedPath()[0]);else for(y=document.elementFromPoint(d.touches[0].clientX,d.touches[0].clientY);y.shadowRoot;)y=y.shadowRoot.elementFromPoint(d.touches[0].clientX,d.touches[0].clientY);for(y.classList.contains("ol-switcherbottomdiv")?t.overflow(-1):y.classList.contains("ol-switchertopdiv")&&t.overflow(1);y&&y.tagName!=="LI";)y=y.parentNode;(!y||!y.classList.contains("dropover"))&&i.parentNode.querySelectorAll("li").forEach(function(w){w.classList.remove("dropover"),w.classList.remove("dropover-after"),w.classList.remove("dropover-before")}),y&&y.parentNode.classList.contains("drag")&&y!==i?(c=t._getLayerForLI(y),c&&!c.get("allwaysOnTop")==!g.get("allwaysOnTop")?(y.classList.add("dropover"),y.classList.add(i.offsetTop<y.offsetTop?"dropover-after":"dropover-before")):c=!1,o.show(u)):(c=!1,y===i?o.hide(u):o.show(u)),c?u.classList.remove("forbidden"):u.classList.add("forbidden")}}o.addListener(document,"mousemove touchmove",m),o.addListener(document,"mouseup touchend touchcancel",f)}dragOpacity_(e){e.stopPropagation(),e.preventDefault();var t=this,i=e.target,s=this._getLayerForLI(i.parentNode.parentNode.parentNode);if(!s)return;var r=e.pageX||e.touches&&e.touches.length&&e.touches[0].pageX||e.changedTouches&&e.changedTouches.length&&e.changedTouches[0].pageX,n=o.getStyle(i,"left")-r;t.dragging_=!0;function h(){o.removeListener(document,"mouseup touchend touchcancel",h),o.removeListener(document,"mousemove touchmove",c),t.dragging_=!1}function c(u){var g=u.pageX||u.touches&&u.touches.length&&u.touches[0].pageX||u.changedTouches&&u.changedTouches.length&&u.changedTouches[0].pageX,l=(n+g)/o.getStyle(i.parentNode,"width"),f=Math.max(0,Math.min(1,l));o.setStyle(i,{left:f*100+"%"}),i.parentNode.nextElementSibling.innerHTML=Math.round(f*100),s.setOpacity(f)}o.addListener(document,"mouseup touchend touchcancel",h),o.addListener(document,"mousemove touchmove",c)}drawList(e,t){var i=this,s=t.getArray(),r=function(l){l.stopPropagation(),l.preventDefault();var f=i._getLayerForLI(this.parentNode.parentNode);i.switchLayerVisibility(f,t),i.get("selection")&&f.getVisible()&&i.selectLayer(f),i.onchangeCheck&&i.onchangeCheck(f)};function n(l){l.stopPropagation(),l.preventDefault();var f=i._getLayerForLI(this.parentNode.parentNode);i.oninfo(f),i.dispatchEvent({type:"info",layer:f})}function h(l){l.stopPropagation(),l.preventDefault();var f=i._getLayerForLI(this.parentNode.parentNode);i.onextent?i.onextent(f):i.getMap().getView().fit(f.getExtent(),i.getMap().getSize()),i.dispatchEvent({type:"extent",layer:f})}function c(l){l.stopPropagation(),l.preventDefault();var f=this.parentNode.parentNode.parentNode.parentNode,m,d=i._getLayerForLI(f);d?(m=i._getLayerForLI(this.parentNode.parentNode),d.getLayers().remove(m),d.getLayers().getLength()==0&&!d.get("noSwitcherDelete")&&c.call(f.querySelectorAll(".layerTrash")[0],l)):(f=this.parentNode.parentNode,i.getMap().removeLayer(i._getLayerForLI(f)))}function u(l){if(!this.displayInLayerSwitcher(l)){this._setLayerForLI(null,l);return}var f=o.create("LI",{className:(l.getVisible()?"ol-visible ":" ")+(l.get("baseLayer")?"baselayer":""),parent:e});this._setLayerForLI(f,l),this._selectedLayer===l&&f.classList.add("ol-layer-select");var m=o.create("DIV",{className:"ol-layerswitcher-buttons",parent:f}),d=o.create("DIV",{className:"li-content",parent:f}),y=o.create("INPUT",{type:l.get("baseLayer")?"radio":"checkbox",className:"ol-visibility",checked:l.getVisible(),click:function(v){r.bind(this)(v),setTimeout(function(){v.target.checked=l.getVisible()})},on:{keydown:function(v){switch(v.key){case"ArrowLeft":case"ArrowRight":{v.preventDefault(),v.stopPropagation();var _=v.key==="ArrowLeft"?-.1:.1,k=Math.min(1,Math.max(0,l.getOpacity()+_));l.setOpacity(k);break}case"Enter":{i.get("selection")&&(v.preventDefault(),v.stopPropagation(),i.selectLayer(l));break}case"-":case"+":l.getLayers&&(this._focus=l,l.set("openInLayerSwitcher",!l.get("openInLayerSwitcher")));case"ArrowUp":case"ArrowDown":{if(v.ctrlKey&&this.reordering){v.preventDefault(),v.stopPropagation();var b=t.getArray().indexOf(l);b>-1&&(v.key==="ArrowDown"?b>0&&(t.remove(l),t.insertAt(b-1,l),i._focus=l,i.dispatchEvent({type:"reorder-end",layer:l})):b<t.getLength()-1&&(t.remove(l),t.insertAt(b+1,l),i._focus=l,i.dispatchEvent({type:"reorder-end",layer:l})))}break}default:{var p=this._getLayerForLI(e.parentNode);this.dispatchEvent({type:"layer:keydown",key:v.key,group:p,li:f,layer:l,originalEvent:v})}}}.bind(this)},parent:d});l===i._focus&&(y.focus(),i.overflow());var w=o.create("LABEL",{title:l.get("title")||l.get("name"),click:r,style:{userSelect:"none"},parent:d});if(w.addEventListener("selectstart",function(){return!1}),o.create("SPAN",{html:l.get("title")||l.get("name"),click:function(v){this.get("selection")&&(v.stopPropagation(),this.selectLayer(l))}.bind(this),parent:w}),this.reordering&&(g<s.length-1&&(l.get("allwaysOnTop")||!s[g+1].get("allwaysOnTop"))||g>0&&(!l.get("allwaysOnTop")||s[g-1].get("allwaysOnTop")))&&o.create("DIV",{className:"layerup ol-noscroll",title:this.tip.up,on:{"mousedown touchstart":function(v){i.dragOrdering_(v)}},parent:m}),l.getLayers){var E=0;l.getLayers().forEach(function(v){i.displayInLayerSwitcher(v)&&E++}),E&&o.create("DIV",{className:l.get("openInLayerSwitcher")?"collapse-layers":"expend-layers",title:this.tip.plus,click:function(){var v=i._getLayerForLI(this.parentNode.parentNode);v.set("openInLayerSwitcher",!v.get("openInLayerSwitcher"))},parent:m})}if(this.oninfo&&o.create("DIV",{className:"layerInfo",title:this.tip.info,click:n,parent:m}),this.hastrash&&!l.get("noSwitcherDelete")&&o.create("DIV",{className:"layerTrash",title:this.tip.trash,click:c,parent:m}),this.hasextent&&s[g].getExtent()){var L=s[g].getExtent();L.length==4&&L[0]<L[2]&&L[1]<L[3]&&o.create("DIV",{className:"layerExtent",title:this.tip.extent,click:h,parent:m})}if(this.show_progress&&l instanceof he){var S=o.create("DIV",{className:"layerswitcher-progress",parent:d});this.setprogress_(l),l.layerswitcher_progress=o.create("DIV",{parent:S})}var C=o.create("DIV",{className:"layerswitcher-opacity",click:function(v){if(v.target===this){v.stopPropagation(),v.preventDefault();var _=Math.max(0,Math.min(1,v.offsetX/o.getStyle(this,"width")));i._getLayerForLI(this.parentNode.parentNode).setOpacity(_),this.parentNode.querySelectorAll(".layerswitcher-opacity-label")[0].innerHTML=Math.round(_*100)}},parent:d});if(o.create("DIV",{className:"layerswitcher-opacity-cursor ol-noscroll",style:{left:l.getOpacity()*100+"%"},on:{"mousedown touchstart":function(v){i.dragOpacity_(v)}},parent:C}),o.create("DIV",{className:"layerswitcher-opacity-label",html:Math.round(l.getOpacity()*100),parent:d}),l.getLayers&&(f.classList.add("ol-layer-group"),l.get("openInLayerSwitcher")===!0)){var M=o.create("UL",{parent:f});this.drawList(M,l.getLayers())}f.classList.add(this.getLayerClass(l)),this.dispatchEvent({type:"drawlist",layer:l,li:f})}for(var g=s.length-1;g>=0;g--)u.call(this,s[g]);this.viewChange(),e===this.panel_&&(this.overflow(""),this._focus=null)}getLayerClass(e){return e?e.getLayers?"ol-layer-group":e instanceof re?"ol-layer-vector":e instanceof Te?"ol-layer-vectortile":e instanceof he?"ol-layer-tile":e instanceof Pe?"ol-layer-image":e instanceof xe?"ol-layer-heatmap":e.getFeatures?"ol-layer-vectorimage":"unknown":"none"}selectLayer(e,t){if(!e){if(!this.getMap())return;e=this.getMap().getLayers().item(this.getMap().getLayers().getLength()-1)}this._selectedLayer=e,this.element.querySelector("input.ol-visibility:focus")&&(this._focus=e),this.drawPanel(),t||this.dispatchEvent({type:"select",layer:e})}getSelection(){return this._selectedLayer}setprogress_(e){if(!e.layerswitcher_progress){var t=0,i=0,s=function(){i===t?(i=t=0,o.setStyle(e.layerswitcher_progress,{width:0})):o.setStyle(e.layerswitcher_progress,{width:(t/i*100).toFixed(1)+"%"})};e.getSource().on("tileloadstart",function(){i++,s()}),e.getSource().on("tileloadend",function(){t++,s()}),e.getSource().on("tileloaderror",function(){t++,s()})}}};ye.prototype.tip={up:"up/down",down:"down",info:"informations...",extent:"zoom to extent",trash:"remove layer",plus:"expand/shrink"};var Ze=class extends ye{constructor(e){e=e||{},e.switcherClass="ol-layerswitcher-popup"+(e.switcherClass?" "+e.switcherClass:""),e.mouseover!==!1&&(e.mouseover=!0),super(e)}overflow(){}drawList(e,t){var i=this,s=function(r){r.preventDefault();var n=i._getLayerForLI(this);i.switchLayerVisibility(n,t),r.type==="touchstart"&&i.element.classList.add("ol-collapsed")};t.forEach(function(r){if(i.displayInLayerSwitcher(r)){var n=o.create("LI",{html:r.get("title")||r.get("name"),on:{"click touchstart":s},parent:e});i._setLayerForLI(n,r),i.testLayerVisibility(r)&&n.classList.add("ol-layer-hidden"),r.getVisible()&&n.classList.add("ol-visible")}})}},$e=class extends Y{constructor(e){e=e||{};var t=document.createElement("div");super({element:t,target:e.target}),this.contentElement=o.create("DIV",{click:function(){this.get("hideOnClick")&&this.hide()}.bind(this),parent:t});var i=(e.className||"")+" ol-notification";e.target||(i+=" ol-unselectable ol-control ol-collapsed"),t.setAttribute("class",i),this.set("closeBox",e.closeBox),this.set("hideOnClick",e.hideOnClick)}show(e,t){var i=this,s=this.element;e&&(e instanceof Node?(this.contentElement.innerHTML="",this.contentElement.appendChild(e)):this.contentElement.innerHTML=e,this.get("closeBox")?(this.contentElement.classList.add("ol-close"),o.create("SPAN",{className:"closeBox",click:function(){this.hide()}.bind(this),parent:this.contentElement})):this.contentElement.classList.remove("ol-close")),this._listener&&(clearTimeout(this._listener),this._listener=null),s.classList.add("ol-collapsed"),this._listener=setTimeout(function(){s.classList.remove("ol-collapsed"),!t||t>=0?i._listener=setTimeout(function(){s.classList.add("ol-collapsed"),i._listener=null},t||3e3):i._listener=null},100)}hide(){this._listener&&(clearTimeout(this._listener),this._listener=null),this.element.classList.add("ol-collapsed")}toggle(e){this.element.classList.contains("ol-collapsed")?this.show(null,e):this.hide()}},Qe=class extends Y{constructor(e){e=e||{};var t=o.create("DIV",{className:((e.className||"")+" ol-progress-bar ol-unselectable ol-control").trim()});super({element:t,target:e.target}),this._waiting=o.create("DIV",{html:e.label||"",className:"ol-waiting",parent:t}),this._bar=o.create("DIV",{className:"ol-bar",parent:t}),this._layerlistener=[],this.setLayers(e.layers)}setPercent(e){this._bar.style.width=(Number(e)||0)*100+"%",e===void 0?o.hide(this.element):o.show(this.element)}setLabel(e){this._waiting.innerHTML=e}setLayers(e){this._layerlistener.forEach(function(r){R(r)}),this._layerlistener=[],this.setPercent();var t=0,i=0;if(e instanceof ce&&(e=[e]),!(!e||!e.forEach)){var s;e.forEach(function(r){r instanceof ce&&(this._layerlistener.push(r.getSource().on("tileloadstart",function(){t++,this.setPercent(i/t),clearTimeout(s)}.bind(this))),this._layerlistener.push(r.getSource().on(["tileloadend","tileloaderror"],function(){i++,i===t?(t=i=0,this.setPercent(1),s=setTimeout(this.setPercent.bind(this),300)):this.setPercent(i/t)}.bind(this))))}.bind(this))}}},Oe=function(a,e){var t=a.getView(),i=t.getProjection(),s=t.getCenter(),r=a.getPixelFromCoordinate(s);r[1]+=1;var n=a.getCoordinateFromPixel(r),h=ve(K(s,i,"EPSG:4326"),K(n,i,"EPSG:4326"));return h*=(e||96)/.0254,h},Ge=function(a,e,t){if(a&&e){var i=e;if(typeof e=="string"&&(e=e.replace(":","/").split("/"),i=e[1],i||(i=e[0]||""),i=i.replace(/[^\d]/g,""),i=parseInt(i),e[1])){var s=parseInt(e[0]);s&&(i/=s)}if(!i)return;var r=a.getView(),n=r.getProjection(),h=r.getCenter(),c=a.getPixelFromCoordinate(h);c[1]+=1;var u=a.getCoordinateFromPixel(c),g=ve(K(h,n,"EPSG:4326"),K(u,n,"EPSG:4326"));return g*=(t||96)/.0254,r.setResolution(r.getResolution()*i/g),i}},et=class extends Y{constructor(e){e=e||{},e.typing===void 0&&(e.typing=300);var t=document.createElement("DIV"),i=(e.className||"")+" ol-scale";e.target||(i+=" ol-unselectable ol-control"),super({element:t,target:e.target}),this._input=document.createElement("INPUT"),this._input.value="-",t.setAttribute("class",i),e.editable===!1&&(this._input.readOnly=!0),t.appendChild(this._input),this._input.addEventListener("change",this.setScale.bind(this)),this.set("ppi",e.ppi||96)}setMap(e){this._listener&&R(this._listener),this._listener=null,super.setMap(e),e&&(this._listener=e.on("moveend",this.getScale.bind(this)))}getScale(){var e=this.getMap();if(e){var t=Oe(e,this.get("ppi"));return this._input.value=this.formatScale(t),t}}formatScale(e){return e>100?e=Math.round(e/100)*100:e=Math.round(e),"1 / "+e.toLocaleString()}setScale(e){var t=this.getMap();t&&e&&(e.target&&(e=e.target.value),Ge(t,e,this.get("ppi"))),this.getScale()}},it=class extends ae{constructor(e){super(e),this.on("select",function(t){this.getFeatures().clear(),this.delete(t.selected)}.bind(this))}_getSources(e){if(!this.getMap())return[];e||(e=this.getMap().getLayers());var t=[];return e.forEach(function(i){i.getLayers?t=t.concat(this._getSources(i.getLayers())):i.getSource&&i.getSource()instanceof q&&t.push(i.getSource())}.bind(this)),t}delete(e){if(e&&(e.length||e.getLength())){this.dispatchEvent({type:"deletestart",features:e});var t=[];this._getSources().forEach(function(i){try{e.forEach(function(s){i.removeFeature(s),t.push(s)})}catch{}}),this.dispatchEvent({type:"deleteend",features:t})}}},rt=class extends Ie{constructor(e){e=e||{};var t=function(r,n){var h=r[0].pop();return(!this.getPolygon()||this.getPolygon().intersectsCoordinate(h))&&(this.lastOKCoord=[h[0],h[1]]),r[0].push([this.lastOKCoord[0],this.lastOKCoord[1]]),n?n.setCoordinates([r[0].concat([r[0][0]])]):n=new O(r),n},i=e.geometryFunction;if(i?e.geometryFunction=function(r,n,h){return n=t.bind(this)(r,n),i.bind(this)(r,n,h)}:e.geometryFunction=t,e.type="Polygon",super(e),this._select=new ae({style:e.style}),this._select.setActive(!1),e.layers&&(typeof e.layers=="function"?this.layers_=e.layers:e.layers.indexOf&&(this.layers_=function(r){return e.layers.indexOf(r)>=0})),typeof e.featureFilter=="function")this._features=e.featureFilter;else if(e.featureFilter){var s=e.featureFilter;this._features=function(r){return s.indexOf?!!s[s.indexOf(r)]:!!s.item(s.getArray().indexOf(r))}}else this._features=function(){return!0};this.on("drawstart",this._startDrawing.bind(this)),this.on("drawend",this._finishDrawing.bind(this))}setMap(e){this.getMap()&&this.getMap().removeInteraction(this._select),e&&e.addInteraction(this._select),super.setMap.call(this,e)}setActive(e){this._select&&this._select.getFeatures().clear(),super.setActive.call(this,e)}removeLastPoint(){this._feature&&this._feature.getGeometry().getCoordinates()[0].length>2&&super.removeLastPoint.call(this)}getPolygon(){return this._polygon}_startDrawing(e){var t=this.getMap();this._feature=e.feature;var i=e.feature.getGeometry().getCoordinates()[0][0];this._current=null,t.forEachFeatureAtPixel(t.getPixelFromCoordinate(i),function(s,r){if(!this._current&&this._features(s,r)){var n=s.getGeometry();if(n.getType()==="Polygon"&&n.intersectsCoordinate(i))this._polygonIndex=!1,this._polygon=n,this._current=s;else if(n.getType()==="MultiPolygon"&&n.intersectsCoordinate(i)){for(var h=0,c;c=n.getPolygon(h);h++)if(c.intersectsCoordinate(i)){this._polygonIndex=h,this._polygon=c,this._current=s;break}}}}.bind(this),{layerFilter:this.layers_}),this._select.getFeatures().clear(),this._current?this._select.getFeatures().push(this._current):(this.setActive(!1),this.setActive(!0))}_finishDrawing(e){e.hole=e.feature,e.feature=this._select.getFeatures().item(0),this.dispatchEvent({type:"modifystart",features:[this._current]});var t=e.hole.getGeometry().getCoordinates()[0];if(t.length>3)if(this._polygonIndex!==!1){for(var i=e.feature.getGeometry(),s=new U([]),r=0,n;n=i.getPolygon(r);r++)r===this._polygonIndex&&n.appendLinearRing(new ue(t)),s.appendPolygon(n);e.feature.setGeometry(s)}else this.getPolygon().appendLinearRing(new ue(t));this.dispatchEvent({type:"modifyend",features:[this._current]}),this._feature=null,this._select.getFeatures().clear()}_geometryFn(e,t){var i=e[0].pop();return(!this.getPolygon()||this.getPolygon().intersectsCoordinate(i))&&(this.lastOKCoord=[i[0],i[1]]),e[0].push([this.lastOKCoord[0],this.lastOKCoord[1]]),t?t.setCoordinates([e[0].concat([e[0][0]])]):t=new O(e),t}},Le;(function(){var a=[255,255,255,1],e=[0,153,255,1],t=3,i=[new X({stroke:new G({color:a,width:t+2})}),new X({image:new fe({radius:t*2,fill:new H({color:e}),stroke:new G({color:a,width:t/2})}),stroke:new G({color:e,width:t}),fill:new H({color:[255,255,255,.5]})})];Le=function(s){if(s===!0)return i;s=s||{};var r=new H({color:s.fillColor||"rgba(255,255,255,0.4)"}),n=new G({color:s.color||"#3399CC",width:1.25}),h=new X({image:new fe({fill:r,stroke:n,radius:5}),fill:r,stroke:n});return[h]}})();var qe=class extends pe{constructor(e){e=e||{},super({handleEvent:function(s){return t.handleEvent_(s)}});var t=this;this.squaredClickTolerance_=e.clickTolerance?e.clickTolerance*e.clickTolerance:36,this.maxCircleCoordinates_=e.maxCircleCoordinates||100,this.features_=e.features,this.source_=e.source,this.conditionFn_=e.condition,this.squareFn_=e.squareCondition,this.centeredFn_=e.centerCondition,this.canRotate_=e.canRotate!==!1,this.geometryName_=e.geometryName||"geometry",this.setSides(e.sides);var i=Le(!0);this.sketch_=new z,this.overlayLayer_=new re({source:new q({features:this.sketch_,useSpatialIndex:!1}),name:"DrawRegular overlay",displayInLayerSwitcher:!1,style:e.style||i})}setMap(e){this.getMap()&&this.getMap().removeLayer(this.overlayLayer_),super.setMap(e),this.overlayLayer_.setMap(e)}setActive(e){this.reset(),super.setActive(e)}reset(){this.overlayLayer_&&this.overlayLayer_.getSource().clear(),this.started_=!1}setSides(e){e=parseInt(e),this.sides_=e>2?e:0}canRotate(e){return(e===!0||e===!1)&&(this.canRotate_=e),this.canRotate_}getSides(){return this.sides_}getGeom_(){if(this.overlayLayer_.getSource().clear(),!this.center_)return!1;var e;if(this.coord_){var t=this.center_,i=this.coord_,s,r,n,h,c;if(!this.sides_&&this.square_&&!this.centered_)return t=[(i[0]+t[0])/2,(i[1]+t[1])/2],s=[i[0]-t[0],i[1]-t[1]],n=Math.sqrt(s[0]*s[0]+s[1]*s[1]),h=new ie(t,n,"XY"),c=this.getMap().getPixelFromCoordinate(t),r=Math.max(100,Math.abs(c[0]-this.coordPx_[0]),Math.abs(c[1]-this.coordPx_[1])),r=Math.min(this.maxCircleCoordinates_,Math.round(r/3)),Q(h,r,0);var u=this.canRotate_&&this.centered_&&this.square_;if(s=[i[0]-t[0],i[1]-t[1]],this.square_&&!u){var g=Math.max(Math.abs(s[0]),Math.abs(s[1]));i=[t[0]+(s[0]>0?g:-g),t[1]+(s[1]>0?g:-g)]}if(n=Math.sqrt(s[0]*s[0]+s[1]*s[1]),n>0){h=new ie(t,n,"XY");var l;if(u?l=Math.atan2(s[1],s[0]):l=this.startAngle[this.sides_]||this.startAngle.default,this.sides_?e=Q(h,this.sides_,l):(c=this.getMap().getPixelFromCoordinate(this.center_),r=Math.max(100,Math.abs(c[0]-this.coordPx_[0]),Math.abs(c[1]-this.coordPx_[1])),r=Math.min(this.maxCircleCoordinates_,Math.round(r/(this.centered_?3:5))),e=Q(h,r,0)),u)return e;var f=e.getExtent();this.centered_?t=[2*this.center_[0]-this.coord_[0],2*this.center_[1]-this.coord_[1]]:t=this.center_;var m=(t[0]-i[0])/(f[0]-f[2]),d=(t[1]-i[1])/(f[1]-f[3]);if(this.square_){var y=Math.min(Math.abs(m),Math.abs(d));m=Math.sign(m)*y,d=Math.sign(d)*y}var w=[t[0]-f[0]*m,t[1]-f[1]*d];return e.applyTransform(function(E,L,S){for(var C=0;C<E.length;C+=S)L[C]=E[C]*m+w[0],L[C+1]=E[C+1]*d+w[1];return L}),e}}return new x(this.center_)}drawSketch_(e){if(this.overlayLayer_.getSource().clear(),e){this.square_=this.squareFn_?this.squareFn_(e):e.originalEvent.shiftKey,this.centered_=this.centeredFn_?this.centeredFn_(e):e.originalEvent.metaKey||e.originalEvent.ctrlKey;var t=this.getGeom_();if(t){var i=this.feature_;return t.getType()==="Polygon"&&i.getGeometry().setCoordinates(t.getCoordinates()),this.overlayLayer_.getSource().addFeature(i),this.coord_&&this.square_&&(this.canRotate_&&this.centered_&&this.coord_||!this.sides_&&!this.centered_)&&this.overlayLayer_.getSource().addFeature(new I(new se([this.center_,this.coord_]))),i}}}drawPoint_(e,t){t||this.overlayLayer_.getSource().clear(),this.overlayLayer_.getSource().addFeature(new I(new x(e)))}handleEvent_(e){var t,i;switch(this._eventTime=new Date,e.type){case"pointerdown":{if(this.conditionFn_&&!this.conditionFn_(e))break;this.downPx_=e.pixel,this.start_(e);var s=500;this._longTouch=!1,setTimeout(function(){this._longTouch=new Date-this._eventTime>.9*s,this._longTouch&&this.handleMoveEvent_(e)}.bind(this),s),this.lastEvent=e.type;break}case"pointerup":{this.started_&&this.coord_&&(t=this.downPx_[0]-e.pixel[0],i=this.downPx_[1]-e.pixel[1],t*t+i*i<=this.squaredClickTolerance_&&(this.lastEvent=="pointerdown"||this.lastEvent=="pointermove"||this.lastEvent=="keydown"?this.end_(e):(t=this.upPx_[0]-e.pixel[0],i=this.upPx_[1]-e.pixel[1],t*t+i*i<=this.squaredClickTolerance_?this.end_(e):(this.handleMoveEvent_(e),this.drawPoint_(e.coordinate,!0))))),this.upPx_=e.pixel;break}case"pointerdrag":{if(this.started_){var r=this.getMap().getPixelFromCoordinate(this.center_);t=r[0]-e.pixel[0],i=r[1]-e.pixel[1],t*t+i*i<=this.squaredClickTolerance_&&this.reset()}return!this._longTouch}case"pointermove":{this.started_?(t=this.downPx_[0]-e.pixel[0],i=this.downPx_[1]-e.pixel[1],t*t+i*i>this.squaredClickTolerance_&&(this.handleMoveEvent_(e),this.lastEvent=e.type)):this.drawPoint_(e.coordinate);break}default:{if(this.started_&&(e.type==="click"||e.type==="singleclick"||e.type==="dblclick"))return!1;this.lastEvent=e.type;break}}return!0}finishDrawing(){this.started_&&this.coord_&&this.end_({pixel:this.upPx_,coordinate:this.coord_})}handleMoveEvent_(e){if(this.started_){this.coord_=e.coordinate,this.coordPx_=e.pixel;var t=this.drawSketch_(e);this.dispatchEvent({type:"drawing",feature:t,pixel:e.pixel,startCoordinate:this.center_,coordinate:e.coordinate,square:this.square_,centered:this.centered_})}else this.drawPoint_(e.coordinate)}start_(e){if(this.started_)this.coord_=e.coordinate;else{this.started_=!0,this.center_=e.coordinate,this.coord_=null;var t=this.feature_=new I({});t.setGeometryName(this.geometryName_||"geometry"),t.setGeometry(new O([[e.coordinate,e.coordinate,e.coordinate]])),this.drawSketch_(e),this.dispatchEvent({type:"drawstart",feature:t,pixel:e.pixel,coordinate:e.coordinate})}}end_(e){if(this.coord_=e.coordinate,this.started_=!1,this.coord_&&(this.center_[0]!==this.coord_[0]||this.center_[1]!==this.coord_[1])){var t=this.feature_;t.setGeometry(this.getGeom_()),this.source_?this.source_.addFeature(t):this.features_&&this.features_.push(t),this.dispatchEvent({type:"drawend",feature:t,pixel:e.pixel,coordinate:e.coordinate,square:this.square_,centered:this.centered_})}else this.dispatchEvent({type:"drawcancel",feature:null,pixel:e.pixel,coordinate:e.coordinate,square:this.square_,centered:this.centered_});this.center_=this.coord_=null,this.drawSketch_()}};qe.prototype.startAngle={default:Math.PI/2,3:-Math.PI/2,4:Math.PI/4};var ot=class extends ae{constructor(e,t){if(e=e||{},e.condition||(e.condition=Fe),super(e),this.setActive(e.active!==!1),this.set("name",e.name),this._attributes=t,this.on("select",function(r){this.getFeatures().clear(),this.fill(r.selected,this._attributes)}.bind(this)),e.cursor===void 0){var i=document.createElement("canvas");i.width=i.height=32;var s=i.getContext("2d");s.beginPath(),s.moveTo(9,3),s.lineTo(2,9),s.lineTo(10,17),s.lineTo(17,11),s.closePath(),s.fillStyle="#fff",s.fill(),s.stroke(),s.beginPath(),s.moveTo(6,4),s.lineTo(0,8),s.lineTo(0,13),s.lineTo(3,17),s.lineTo(3,8),s.closePath(),s.fillStyle="#000",s.fill(),s.stroke(),s.moveTo(8,8),s.lineTo(10,0),s.lineTo(11,0),s.lineTo(13,3),s.lineTo(13,7),s.stroke(),this._cursor="url("+i.toDataURL()+") 0 13, auto"}e.cursor&&(this._cursor=e.cursor)}setCursor(e){this._cursor=e}getCursor(){return this._cursor}setActive(e){e!==this.getActive()&&(super.setActive(e),this.getMap()&&this._cursor&&(e?(this._previousCursor=this.getMap().getTargetElement().style.cursor,o.setCursor(this.getMap(),this._cursor)):(o.setCursor(this.getMap(),this._previousCursor),this._previousCursor=void 0)))}setAttributes(e){this._attributes=e}setAttribute(e,t){this._attributes[e]=t}getAttributes(){return this._attributes}getAttribute(e){return this._attributes[e]}fill(e,t){if(e.length&&t){for(var i=!1,s=0,r;r=e[s];s++){for(var n in t)r.get(n)!==t[n]&&(i=!0);if(i)break}i&&(this.dispatchEvent({type:"setattributestart",features:e,properties:t}),e.forEach(function(h){for(var c in t)h.set(c,t[c])}),this.dispatchEvent({type:"setattributeend",features:e,properties:t}))}}},He=class extends Ne{constructor(e){e=e||{},super({handleDownEvent:function(i){return t.handleDownEvent_(i)},handleDragEvent:function(i){return this.handleDragEvent_(i)},handleMoveEvent:function(i){return this.handleMoveEvent_(i)},handleUpEvent:function(i){return this.handleUpEvent_(i)}});var t=this;this.selection_=new z,this.handles_=new z,this.overlayLayer_=new re({source:new q({features:this.handles_,useSpatialIndex:!1,wrapX:!1}),name:"Transform overlay",displayInLayerSwitcher:!1,style:function(i){return t.style[(i.get("handle")||"default")+(i.get("constraint")||"")+(i.get("option")||"")]},updateWhileAnimating:!0,updateWhileInteracting:!0}),this.features_=e.features,typeof e.filter=="function"&&(this._filter=e.filter),this.layers_=e.layers?e.layers instanceof Array?e.layers:[e.layers]:null,this._handleEvent=e.condition||function(){return!0},this.addFn_=e.addCondition||function(){return!1},this.setPointRadius(e.pointRadius),this.set("translateFeature",e.translateFeature!==!1),this.set("translate",e.translate!==!1),this.set("translateBBox",e.translateBBox===!0),this.set("stretch",e.stretch!==!1),this.set("scale",e.scale!==!1),this.set("rotate",e.rotate!==!1),this.set("keepAspectRatio",e.keepAspectRatio||function(i){return i.originalEvent.shiftKey}),this.set("modifyCenter",e.modifyCenter||function(i){return i.originalEvent.metaKey||i.originalEvent.ctrlKey}),this.set("noFlip",e.noFlip||!1),this.set("selection",e.selection!==!1),this.set("hitTolerance",e.hitTolerance||0),this.set("enableRotatedTransform",e.enableRotatedTransform||!1),this.set("keepRectangle",e.keepRectangle||!1),this.set("buffer",e.buffer||0),this.on("propertychange",function(){this.drawSketch_()}),this.setDefaultStyle(),e.select?this.on("change:active",function(i){this.getActive()?this.setSelection(e.select.getFeatures().getArray()):(e.select.getFeatures().extend(this.selection_),this.selection_.forEach(function(s){e.select.getFeatures().push(s)}),this.select(null))}.bind(this)):this.on("change:active",function(i){this.select(null)}.bind(this))}setMap(e){var t=this.getMap();t&&(t.removeLayer(this.overlayLayer_),this.previousCursor_&&o.setCursor(t,this.previousCursor_),this.previousCursor_=void 0),super.setMap(e),this.overlayLayer_.setMap(e),e===null&&this.select(null),e!==null&&(this.isTouch=/touch/.test(e.getViewport().className),this.setDefaultStyle())}setActive(e){this.overlayLayer_&&this.overlayLayer_.setVisible(e),super.setActive(e)}setDefaultStyle(e){e=e||{};var t=e.pointStroke||new G({color:[255,0,0,1],width:1}),i=e.stroke||new G({color:[255,0,0,1],width:1,lineDash:[4,4]}),s=e.fill||new H({color:[255,0,0,.01]}),r=e.pointFill||new H({color:[255,255,255,.8]}),n=new j({fill:r,stroke:t,radius:this.isTouch?12:6,displacement:this.isTouch?[24,-24]:[12,-12],points:15});n.setDisplacement||(n.getAnchor()[0]=this.isTouch?-10:-5);var h=new j({fill:r,stroke:t,radius:this.isTouch?16:8,points:4,angle:Math.PI/4}),c=new j({fill:r,stroke:t,radius:this.isTouch?12:6,points:4,angle:Math.PI/4});function u(g,l,f){return[new X({image:g,stroke:l,fill:f})]}this.style={default:u(h,i,s),translate:u(h,t,r),rotate:u(n,t,r),rotate0:u(h,t,r),scale:u(h,t,r),scale1:u(h,t,r),scale2:u(h,t,r),scale3:u(h,t,r),scalev:u(c,t,r),scaleh1:u(c,t,r),scalev2:u(c,t,r),scaleh3:u(c,t,r)},this.drawSketch_()}setStyle(e,t){if(t){t instanceof Array?this.style[e]=t:this.style[e]=[t];for(var i=0;i<this.style[e].length;i++){var s=this.style[e][i].getImage();s&&(e=="rotate"&&(s.getAnchor()[0]=-5),this.isTouch&&s.setScale(1.8));var r=this.style[e][i].getText();r&&(e=="rotate"&&r.setOffsetX(this.isTouch?14:7),this.isTouch&&r.setScale(1.8))}this.drawSketch_()}}getFeatureAtPixel_(e){var t=this;return this.getMap().forEachFeatureAtPixel(e,function(i,s){var r=!1;if(!s){if(i===t.bbox_)return t.get("translateBBox")?{feature:i,handle:"translate",constraint:"",option:""}:!1;if(t.handles_.forEach(function(h){h===i&&(r=!0)}),r)return{feature:i,handle:i.get("handle"),constraint:i.get("constraint"),option:i.get("option")}}if(!t.get("selection"))return t.selection_.getArray().some(function(h){return i===h})?{feature:i}:null;if(t._filter)return t._filter(i,s)?{feature:i}:null;if(t.layers_){for(var n=0;n<t.layers_.length;n++)if(t.layers_[n]===s)return{feature:i};return null}else return t.features_?(t.features_.forEach(function(h){h===i&&(r=!0)}),r?{feature:i}:null):{feature:i}},{hitTolerance:this.get("hitTolerance")})||{}}getGeometryRotateToZero_(e,t){var i=e.getGeometry(),s=this.getMap().getView().getRotation();if(s===0||!this.get("enableRotatedTransform"))return t?i.clone():i;var r=i.clone();return r.rotate(s*-1,this.getMap().getView().getCenter()),r}_isRectangle(e){if(this.get("keepRectangle")&&e.getType()==="Polygon"){var t=e.getCoordinates()[0];return t.length===5}return!1}drawSketch_(e){var t,i,s,r=this.selection_.item(0)&&this._isRectangle(this.selection_.item(0).getGeometry());if(this.overlayLayer_.getSource().clear(),!!this.selection_.getLength()){var n=this.getMap().getView().getRotation(),h=this.getGeometryRotateToZero_(this.selection_.item(0)).getExtent(),c;r&&(c=this.getGeometryRotateToZero_(this.selection_.item(0)).getCoordinates()[0].slice(0,4),c.unshift(c[3])),h=me(h,this.get("buffer")),this.selection_.forEach(function(y){var w=this.getGeometryRotateToZero_(y).getExtent();ee(h,w)}.bind(this));var u=this.selection_.getLength()===1?this._pointRadius(this.selection_.item(0)):0;if(u&&!(u instanceof Array)&&(u=[u,u]),e===!0)this.ispt_||(this.overlayLayer_.getSource().addFeature(new I({geometry:new x(this.center_),handle:"rotate0"})),s=B(h),this.get("enableRotatedTransform")&&n!==0&&s.rotate(n,this.getMap().getView().getCenter()),i=this.bbox_=new I(s),this.overlayLayer_.getSource().addFeature(i));else{if(this.ispt_){var g=this.getMap().getPixelFromCoordinate(te(h));if(g){var l=u&&u[0]||10,f=u&&u[1]||10;h=Ve([this.getMap().getCoordinateFromPixel([g[0]-l,g[1]-f]),this.getMap().getCoordinateFromPixel([g[0]+l,g[1]+f])])}}s=r?new O([c]):B(h),this.get("enableRotatedTransform")&&n!==0&&s.rotate(n,this.getMap().getView().getCenter()),i=this.bbox_=new I(s);var m=[],d=s.getCoordinates()[0];if(!this.ispt_||u){if(m.push(i),!this.iscircle_&&!this.ispt_&&this.get("stretch")&&this.get("scale"))for(t=0;t<d.length-1;t++)i=new I({geometry:new x([(d[t][0]+d[t+1][0])/2,(d[t][1]+d[t+1][1])/2]),handle:"scale",constraint:t%2?"h":"v",option:t}),m.push(i);if(this.get("scale"))for(t=0;t<d.length-1;t++)i=new I({geometry:new x(d[t]),handle:"scale",option:t}),m.push(i);this.get("translate")&&!this.get("translateFeature")&&(i=new I({geometry:new x([(d[0][0]+d[2][0])/2,(d[0][1]+d[2][1])/2]),handle:"translate"}),m.push(i))}!this.iscircle_&&this.get("rotate")&&(i=new I({geometry:new x(d[3]),handle:"rotate"}),m.push(i)),this.overlayLayer_.getSource().addFeatures(m)}}}select(e,t){if(!e){this.selection_&&(this.selection_.clear(),this.drawSketch_());return}if(!(!e.getGeometry||!e.getGeometry())){if(t)this.selection_.push(e);else{var i=this.selection_.getArray().indexOf(e);this.selection_.removeAt(i)}this.ispt_=this.selection_.getLength()===1?this.selection_.item(0).getGeometry().getType()=="Point":!1,this.iscircle_=this.selection_.getLength()===1?this.selection_.item(0).getGeometry().getType()=="Circle":!1,this.drawSketch_(),this.watchFeatures_(),this.dispatchEvent({type:"select",feature:e,features:this.selection_})}}setSelection(e){this.selection_.clear(),e.forEach(function(t){this.selection_.push(t)}.bind(this)),this.ispt_=this.selection_.getLength()===1?this.selection_.item(0).getGeometry().getType()=="Point":!1,this.iscircle_=this.selection_.getLength()===1?this.selection_.item(0).getGeometry().getType()=="Circle":!1,this.drawSketch_(),this.watchFeatures_(),this.dispatchEvent({type:"select",features:this.selection_})}watchFeatures_(){this._featureListeners&&this._featureListeners.forEach(function(e){R(e)}),this._featureListeners=[],this.selection_.forEach(function(e){this._featureListeners.push(e.on("change",function(){this.isUpdating_||this.drawSketch_()}.bind(this)))}.bind(this))}handleDownEvent_(e){if(this._handleEvent(e,this.selection_)){var t=this.getFeatureAtPixel_(e.pixel),i=t.feature;if(this.selection_.getLength()&&this.selection_.getArray().indexOf(i)>=0&&(this.ispt_&&this.get("translate")||this.get("translateFeature"))&&(t.handle="translate"),t.handle){this.mode_=t.handle,this.opt_=t.option,this.constraint_=t.constraint;var s=this.getMap().getView().getRotation();this.coordinate_=i.get("handle")?i.getGeometry().getCoordinates():e.coordinate,this.pixel_=this.getMap().getCoordinateFromPixel(this.coordinate_),this.geoms_=[],this.rotatedGeoms_=[];var r=de(),n=de();this.hasChanged_=!1;for(var h=0,c;c=this.selection_.item(h);h++)if(this.geoms_.push(c.getGeometry().clone()),r=ee(r,c.getGeometry().getExtent()),this.get("enableRotatedTransform")&&s!==0){var u=this.getGeometryRotateToZero_(c,!0);this.rotatedGeoms_.push(u),n=ee(n,u.getExtent())}if(this.extent_=B(r).getCoordinates()[0],this.get("enableRotatedTransform")&&s!==0&&(this.rotatedExtent_=B(n).getCoordinates()[0]),this.mode_==="rotate"){this.center_=this.getCenter()||te(r);var g=e.map.getTargetElement();o.setCursor(g,this.Cursors.rotate0),this.previousCursor_=g.style.cursor}else this.center_=te(r);return this.angle_=Math.atan2(this.center_[1]-e.coordinate[1],this.center_[0]-e.coordinate[0]),this.dispatchEvent({type:this.mode_+"start",feature:this.selection_.item(0),features:this.selection_,pixel:e.pixel,coordinate:e.coordinate}),!0}else if(this.get("selection")){if(i){this.addFn_(e)||this.selection_.clear();var l=this.selection_.getArray().indexOf(i);l<0?this.selection_.push(i):this.selection_.removeAt(l)}else this.selection_.clear();return this.ispt_=this.selection_.getLength()===1?this.selection_.item(0).getGeometry().getType()=="Point":!1,this.iscircle_=this.selection_.getLength()===1?this.selection_.item(0).getGeometry().getType()=="Circle":!1,this.drawSketch_(),this.watchFeatures_(),this.dispatchEvent({type:"select",feature:i,features:this.selection_,pixel:e.pixel,coordinate:e.coordinate}),!1}}}getCenter(){return this.get("center")}setCenter(e){return this.set("center",e)}handleDragEvent_(e){if(this._handleEvent(e,this.features_)){var t=this.getMap().getView().getRotation(),i,s,r,n,h=[this.coordinate_[0],this.coordinate_[1]],c=[e.coordinate[0],e.coordinate[1]];switch(this.isUpdating_=!0,this.hasChanged_=!0,this.mode_){case"rotate":{var u=Math.atan2(this.center_[1]-c[1],this.center_[0]-c[0]);if(!this.ispt)for(i=0,r;r=this.selection_.item(i);i++)n=this.geoms_[i].clone(),n.rotate(u-this.angle_,this.center_),n.getType()=="Circle"&&n.setCenterAndRadius(n.getCenter(),n.getRadius()),r.setGeometry(n);this.drawSketch_(!0),this.dispatchEvent({type:"rotating",feature:this.selection_.item(0),features:this.selection_,angle:u-this.angle_,pixel:e.pixel,coordinate:e.coordinate});break}case"translate":{var g=c[0]-h[0],l=c[1]-h[1];for(i=0,r;r=this.selection_.item(i);i++)r.getGeometry().translate(g,l);this.handles_.forEach(function(b){b.getGeometry().translate(g,l)}),this.coordinate_=e.coordinate,this.dispatchEvent({type:"translating",feature:this.selection_.item(0),features:this.selection_,delta:[g,l],pixel:e.pixel,coordinate:e.coordinate});break}case"scale":{var f=this.center_;if(this.get("modifyCenter")(e)){var m=this.extent_;this.get("enableRotatedTransform")&&t!==0&&(m=this.rotatedExtent_),f=m[(Number(this.opt_)+2)%4]}var d=this.geoms_.length==1&&this._isRectangle(this.geoms_[0]),y=this.constraint_,w=this.opt_,E=this.coordinate_,L=e.coordinate;if(this.get("enableRotatedTransform")&&t!==0){var S=new x(this.coordinate_);S.rotate(t*-1,f),E=S.getCoordinates();var C=new x(e.coordinate);C.rotate(t*-1,f),L=C.getCoordinates()}var M=(L[0]-f[0])/(E[0]-f[0]),v=(L[1]-f[1])/(E[1]-f[1]),_=[L[0]-E[0],L[1]-E[1]];if(this.get("enableRotatedTransform")&&t!==0){var k=new x(f);k.rotate(t*-1,this.getMap().getView().getCenter()),f=k.getCoordinates()}for(this.get("noFlip")&&(M<0&&(M=-M),v<0&&(v=-v)),this.constraint_?this.constraint_=="h"?M=1:v=1:this.get("keepAspectRatio")(e)&&(M=v=Math.min(M,v)),i=0,r;r=this.selection_.item(i);i++)n=t===0||!this.get("enableRotatedTransform")?this.geoms_[i].clone():this.rotatedGeoms_[i].clone(),n.applyTransform(function(b,p,W){if(W<2)return p;if(d){var $=[[6],[0,8],[2],[4]],P=[b[0],b[1]],F=[b[2],b[3]],A=[b[4],b[5]],N=[b[6],b[7]],J=[b[8],b[9]];if(y){var ke=w%2===0?this._countVector(P,F):this._countVector(N,P),oe=this._projectVectorOnVector(_,ke),Se=w+1<$.length?w+1:0,le=[...$[w],...$[Se]];for(s=0;s<b.length;s+=W)p[s]=le.includes(s)?b[s]+oe[0]:b[s],p[s+1]=le.includes(s)?b[s+1]+oe[1]:b[s+1]}else{var V,D;switch(w){case 0:_=this._countVector(N,L),V=this._projectVectorOnVector(_,this._countVector(A,N)),D=this._projectVectorOnVector(_,this._countVector(P,N)),[p[0],p[1]]=this._movePoint(P,V),[p[4],p[5]]=this._movePoint(A,D),[p[6],p[7]]=this._movePoint(N,_),[p[8],p[9]]=this._movePoint(J,V);break;case 1:_=this._countVector(P,L),V=this._projectVectorOnVector(_,this._countVector(N,P)),D=this._projectVectorOnVector(_,this._countVector(F,P)),[p[0],p[1]]=this._movePoint(P,_),[p[2],p[3]]=this._movePoint(F,V),[p[6],p[7]]=this._movePoint(N,D),[p[8],p[9]]=this._movePoint(J,_);break;case 2:_=this._countVector(F,L),V=this._projectVectorOnVector(_,this._countVector(P,F)),D=this._projectVectorOnVector(_,this._countVector(A,F)),[p[0],p[1]]=this._movePoint(P,D),[p[2],p[3]]=this._movePoint(F,_),[p[4],p[5]]=this._movePoint(A,V),[p[8],p[9]]=this._movePoint(J,D);break;case 3:_=this._countVector(A,L),V=this._projectVectorOnVector(_,this._countVector(F,A)),D=this._projectVectorOnVector(_,this._countVector(N,A)),[p[2],p[3]]=this._movePoint(F,D),[p[4],p[5]]=this._movePoint(A,_),[p[6],p[7]]=this._movePoint(N,V);break}}}else for(s=0;s<b.length;s+=W)M!=1&&(p[s]=f[0]+(b[s]-f[0])*M),v!=1&&(p[s+1]=f[1]+(b[s+1]-f[1])*v);return n.getType()=="Circle"&&n.setCenterAndRadius(n.getCenter(),n.getRadius()),p}.bind(this)),this.get("enableRotatedTransform")&&t!==0&&n.rotate(t,this.getMap().getView().getCenter()),r.setGeometry(n);this.drawSketch_(),this.dispatchEvent({type:"scaling",feature:this.selection_.item(0),features:this.selection_,scale:[M,v],pixel:e.pixel,coordinate:e.coordinate});break}}this.isUpdating_=!1}}handleMoveEvent_(e){if(this._handleEvent(e,this.features_)&&!this.mode_){var t=this.getFeatureAtPixel_(e.pixel),i=e.map.getTargetElement();if(t.feature){var s=t.handle?this.Cursors[(t.handle||"default")+(t.constraint||"")+(t.option||"")]:this.Cursors.select;this.previousCursor_===void 0&&(this.previousCursor_=i.style.cursor),o.setCursor(i,s)}else this.previousCursor_!==void 0&&o.setCursor(i,this.previousCursor_),this.previousCursor_=void 0}}handleUpEvent_(e){if(this.mode_==="rotate"){var t=e.map.getTargetElement();o.setCursor(t,this.Cursors.default),this.previousCursor_=void 0}return this.dispatchEvent({type:this.mode_+"end",feature:this.selection_.item(0),features:this.selection_,oldgeom:this.geoms_[0],oldgeoms:this.geoms_,transformed:this.hasChanged_}),this.drawSketch_(),this.hasChanged_=!1,this.mode_=null,!1}setPointRadius(e){typeof e=="function"?this._pointRadius=e:this._pointRadius=function(){return e}}getFeatures(){return this.selection_}_projectVectorOnVector(e,t){var i=(e[0]*t[0]+e[1]*t[1])/(t[0]*t[0]+t[1]*t[1]);return[t[0]*i,t[1]*i]}_countVector(e,t){return[t[0]-e[0],t[1]-e[1]]}_movePoint(e,t){return[e[0]+t[0],e[1]+t[1]]}};He.prototype.Cursors={default:"auto",select:"pointer",translate:"move",rotate:"move",rotate0:"move",scale:"nesw-resize",scale1:"nwse-resize",scale2:"nesw-resize",scale3:"nwse-resize",scalev:"ew-resize",scaleh1:"ns-resize",scalev2:"ew-resize",scaleh3:"ns-resize"};var we=function(a,e){var t=a[0]-e[0],i=a[1]-e[1];return Math.sqrt(t*t+i*i)},ge=function(a,e){return a[0]==e[0]&&a[1]==e[1]},be;(function(){function a(t,i){var s;for(let r=t.length-1;r>0;r--)(t[r][0]>i&&t[r-1][0]<i||t[r][0]<i&&t[r-1][0]>i)&&(s=[i,(i-t[r][0])/(t[r-1][0]-t[r][0])*(t[r-1][1]-t[r][1])+t[r][1]],t.splice(r,0,s))}function e(t,i){var s;for(let r=t.length-1;r>0;r--)(t[r][1]>i&&t[r-1][1]<i||t[r][1]<i&&t[r-1][1]>i)&&(s=[(i-t[r][1])/(t[r-1][1]-t[r][1])*(t[r-1][0]-t[r][0])+t[r][0],i],t.splice(r,0,s))}be=function(t,i){var s=i.getType()==="Polygon";if(!s&&i.getType()!=="MultiPolygon")return null;var r=i.getCoordinates();return s&&(r=[r]),r.forEach(function(n){n.forEach(function(h){a(h,t[0]),a(h,t[2]),e(h,t[1]),e(h,t[3])})}),r.forEach(function(n){n.forEach(function(h){h.forEach(function(c){c[0]<t[0]?c[0]=t[0]:c[0]>t[2]&&(c[0]=t[2]),c[1]<t[1]?c[1]=t[1]:c[1]>t[3]&&(c[1]=t[3])})})}),s?new O(r[0]):new U(r)}})();var Z=function(a,e,t,i){var s=[];i!==!1&&s.push(a);var r=we(a,e);if(r){var n=Math.round(r/t);if(n>1)for(var h=(e[0]-a[0])/n,c=(e[1]-a[1])/n,u=1;u<n;u++)s.push([a[0]+h*u,a[1]+c*u])}return s.push(e),s};se.prototype.sampleAt=function(a){for(var e=this.getCoordinates(),t=[],i=1;i<e.length;i++)t=t.concat(Z(e[i-1],e[i],a,i===1));return new se(t)};_e.prototype.sampleAt=function(a){var e=this.getCoordinates(),t=[];return e.forEach(function(i){for(var s=[],r=1;r<i.length;r++)s=s.concat(Z(i[r-1],i[r],a,r===1));t.push(s)}),new _e(t)};O.prototype.sampleAt=function(a){var e=this.getCoordinates(),t=[];return e.forEach(function(i){for(var s=[],r=1;r<i.length;r++)s=s.concat(Z(i[r-1],i[r],a,r===1));t.push(s)}),new O(t)};U.prototype.sampleAt=function(a){var e=this.getCoordinates(),t=[];return e.forEach(function(i){var s=[];t.push(s),i.forEach(function(r){for(var n=[],h=1;h<r.length;h++)n=n.concat(Z(r[h-1],r[h],a,h===1));s.push(n)})}),new U(t)};ie.prototype.intersection=function(a,e){if(a.sampleAt){var t=me(this.getCenter().concat(this.getCenter()),this.getRadius());a=be(t,a),a=a.simplify(e);var i=this.getCenter(),s=this.getRadius(),r=a.sampleAt(e).getCoordinates();switch(a.getType()){case"Polygon":r=[r];case"MultiPolygon":{var n=!1,h=[];return r.forEach(function(c){var u=[];h.push(u),c.forEach(function(g){var l=[];u.push(l),g.forEach(function(f){var m=we(i,f);m>s?(n=!0,l.push([i[0]+s/m*(f[0]-i[0]),i[1]+s/m*(f[1]-i[1])])):l.push(f)})})}),n?a.getType()==="Polygon"?new O(h[0]):new U(h):a}}}return a};(function(){var a=q.prototype.clear;q.prototype.clear=function(e){this.dispatchEvent({type:"clearstart"}),a.call(this,e),this.dispatchEvent({type:"clearend"})}})();var T=class extends pe{constructor(e){e=e||{},super({handleEvent:function(){return!0}}),this._layers=e.layers,this._undoStack=new z,this._redoStack=new z,this._undo=[],this._redo=[],this._undoStack.on("add",function(t){t.element.level===void 0?(t.element.level=this._level,t.element.level||(t.element.view={center:this.getMap().getView().getCenter(),zoom:this.getMap().getView().getZoom()},this._undo.push(t.element))):t.element.level||this._undo.push(this._redo.shift()),t.element.level||this.dispatchEvent({type:"stack:add",action:t.element}),this._reduce()}.bind(this)),this._undoStack.on("remove",function(t){t.element.level||(this._doShift?this._undo.shift():this._abort?this._undo.pop():this._undo.length&&this._redo.push(this._undo.pop()),this._doClear||this.dispatchEvent({type:"stack:remove",action:t.element,shift:this._doShift,abort:this._abort}))}.bind(this)),this._block=0,this._level=0,this._doShift=!1,this._record=!0,this._defs={}}define(e,t,i){this._defs[e]={undo:t,redo:i}}length(e){return e==="redo"?this._redo.length:this._undo.length}setMaxLength(e){e=parseInt(e),e&&e<0&&(e=0),this.set("maxLength",e),this._reduce()}size(e){return e==="redo"?this._redoStack.getLength():this._undoStack.getLength()}setMaxSize(e){e=parseInt(e),e&&e<0&&(e=0),this.set("maxSize",e),this._reduce()}_reduce(){if(this.get("maxLength"))for(;this.length()>this.get("maxLength");)this.shift();if(this.get("maxSize"))for(;this.length()>1&&this.size()>this.get("maxSize");)this.shift()}getStack(e){return e==="redo"?this._redo:this._undo}push(e,t,i){return this._defs[e]?(this._undoStack.push({type:e,name:i,custom:!0,prop:t}),!0):!1}shift(){this._doShift=!0;var e=this._undoStack.removeAt(0);if(this._doShift=!1,e.type==="blockstart")for(e=this._undoStack.item(0);this._undoStack.getLength()&&e.level>0;)this._undoStack.removeAt(0),e=this._undoStack.item(0)}setActive(e){super.setActive(e),this._record=e}setMap(e){this._mapListener&&this._mapListener.forEach(function(t){R(t)}),this._mapListener=[],super.setMap(e),e&&(this._mapListener.push(e.on("undoblockstart",this.blockStart.bind(this))),this._mapListener.push(e.on("undoblockend",this.blockEnd.bind(this)))),this._watchSources(),this._watchInteractions()}_watchSources(){var e=this.getMap();this._sourceListener&&this._sourceListener.forEach(function(r){R(r)}),this._sourceListener=[];var t=this;function i(r,n){return n||(n=[]),r.forEach(function(h){h.getSource&&h.getSource()instanceof q?(!t._layers||t._layers.indexOf(h)>=0)&&n.push(h):h.getLayers&&i(h.getLayers(),n)}),n}if(e){var s=i(e.getLayers());s.forEach((function(r){var n=r.getSource();this._sourceListener.push(n.on(["addfeature","removefeature"],this._onAddRemove.bind(this))),this._sourceListener.push(n.on("clearstart",function(){this.blockStart("clear")}.bind(this))),this._sourceListener.push(n.on("clearend",this.blockEnd.bind(this)))}).bind(this)),this._sourceListener.push(e.getLayers().on(["add","remove"],this._watchSources.bind(this)))}}_watchInteractions(){var e=this.getMap();this._interactionListener&&this._interactionListener.forEach(function(t){R(t)}),this._interactionListener=[],e&&(e.getInteractions().forEach((function(t){this._interactionListener.push(t.on(["setattributestart","modifystart","modifyend","rotatestart","rotateend","translatestart","translateend","scalestart","scaleend","deletestart","deleteend","beforesplit","aftersplit"],this._onInteraction.bind(this)))}).bind(this)),this._interactionListener.push(e.getInteractions().on(["add","remove"],this._watchInteractions.bind(this))))}_onAddRemove(e){this._record&&(this._redoStack.clear(),this._redo.length=0,this._undoStack.push({type:e.type,source:e.target,feature:e.feature}))}_onInteraction(e){var t=this._onInteraction[e.type];t&&t.call(this,e)}blockStart(e){this._redoStack.clear(),this._redo.length=0,this._undoStack.push({type:"blockstart",name:e}),this._level++}blockEnd(){this._undoStack.push({type:"blockend"}),this._level--}_handleDo(e,t){if(this.getActive()){if(this._record=!1,e.custom)this._defs[e.type]&&(t?this._defs[e.type].undo(e.prop):this._defs[e.type].redo(e.prop));else switch(e.type){case"addfeature":{t?e.source.removeFeature(e.feature):e.source.addFeature(e.feature);break}case"removefeature":{t?e.source.addFeature(e.feature):e.source.removeFeature(e.feature);break}case"changegeometry":{var i=e.feature.getGeometry();e.feature.setGeometry(e.oldGeom),e.oldGeom=i;break}case"changeattribute":{var s=e.newProperties,r=e.oldProperties;for(var n in r)r===void 0?e.feature.unset(n):e.feature.set(n,r[n]);e.oldProperties=s,e.newProperties=r;break}case"blockstart":{this._block+=t?-1:1;break}case"blockend":{this._block+=t?1:-1;break}default:}this._block<0&&(this._block=0),this._block&&(t?this.undo():this.redo()),this._record=!0,this.dispatchEvent({type:t?"undo":"redo",action:e})}}undo(){var e=this._undoStack.item(this._undoStack.getLength()-1);e&&(this._redoStack.push(e),this._undoStack.pop(),this._handleDo(e,!0))}abort(){var e=this._undoStack.item(this._undoStack.getLength()-1);if(e){this._abort=!0;for(var t=this._undoStack.pop();t.level!==0;)t=this._undoStack.pop();this._abort=!1}}redo(){var e=this._redoStack.item(this._redoStack.getLength()-1);e&&(this._undoStack.push(e),this._redoStack.pop(),this._handleDo(e,!1))}clear(){this._doClear=!0,this._undo.length=this._redo.length=0,this._undoStack.clear(),this._redoStack.clear(),this._doClear=!1,this.dispatchEvent({type:"stack:clear"})}hasUndo(){return this._undoStack.getLength()}hasRedo(){return this._redoStack.getLength()}};T.prototype._onInteraction.setattributestart=function(a){this.blockStart(a.target.get("name")||"setattribute");var e=Object.assign({},a.properties);a.features.forEach(function(t){var i={};for(var s in e)i[s]=t.get(s);this._undoStack.push({type:"changeattribute",feature:t,newProperties:e,oldProperties:i})}.bind(this)),this.blockEnd()};T.prototype._onInteraction.rotatestart=T.prototype._onInteraction.translatestart=T.prototype._onInteraction.scalestart=T.prototype._onInteraction.modifystart=function(a){this._modify={coordinate:a.coordinate,blockStart:a.type.replace(/start$/,""),modify:[]},a.features.forEach(function(e){this._modify.modify.push({type:"changegeometry",feature:e,oldGeom:e.getGeometry().clone()})}.bind(this))};T.prototype._onInteraction.translateend=T.prototype._onInteraction.rotateend=T.prototype._onInteraction.scaleend=T.prototype._onInteraction.modifyend=function(a){this._modify&&(a.type==="modifyend"&&(a.transformed=!a.coordinate||!ge(this._modify.coordinate,a.coordinate),a.transformed||this._modify.modify.forEach(function(e){e.feature.getGeometry().getFlatCoordinates().length!==e.oldGeom.getFlatCoordinates().length&&(a.transformed=!0)})),a.type==="translateend"&&a.coordinate&&(a.transformed=!ge(this._modify.coordinate,a.coordinate)),a.transformed&&(this.blockStart(this._modify.blockStart),this._modify.modify.forEach(function(e){this._undoStack.push(e)}.bind(this)),this.blockEnd()),this._modify=null)};T.prototype._onInteraction.beforesplit=function(){var a=this._undoStack.getLength();a>2&&this._undoStack.item(a-1).type==="blockend"&&this._undoStack.item(a-2).type==="changegeometry"?this._undoStack.pop():this.blockStart("split")};T.prototype._onInteraction.deletestart=function(){this.blockStart("delete")};T.prototype._onInteraction.aftersplit=T.prototype._onInteraction.deleteend=T.prototype.blockEnd;export{Qe as a,et as b,Ze as c,T as d,rt as e,ot as f,He as g,qe as h,it as i,$e as o};
