import{B as ve,M as me,C as K,u as A,i as ye,V as ee,a as Le,T as ae,I as we,H as be,L as ne,g as ue,t as B,S as te,b as G,D as ke,c as Se,d as oe,P as X,e as z,f as O,F as q,h as le,j as fe,k as H,l as he,m as $,n as x,o as P,p as Ee,q as Me,r as Te,R as J,s as Ce,v as Q,w as U,x as j,y as xe,z as ce}from"./ol-B4BODsuJ.js";var Pe=class extends ve{constructor(e){e=e||{},super();var t=this.input=e.input;t||(t=this.input=document.createElement("input"),e.type&&t.setAttribute("type",e.type),e.min!==void 0&&t.setAttribute("min",e.min),e.max!==void 0&&t.setAttribute("max",e.max),e.step!==void 0&&t.setAttribute("step",e.step),e.parent&&e.parent.appendChild(t)),e.disabled&&(t.disabled=!0),e.checked!==void 0&&(t.checked=!!e.checked),e.val!==void 0&&(t.value=e.val),e.hidden&&t.classList.add("ol-input-hidden"),t.addEventListener("focus",function(){this.element&&this.element.classList.add("ol-focus")}.bind(this));var s;t.addEventListener("focusout",function(){this.element&&(s&&clearTimeout(s),s=setTimeout(function(){this.element.classList.remove("ol-focus")}.bind(this),0))}.bind(this))}_listenDrag(e,t){var s=function(i){this.moving=!0,this.element.classList.add("ol-moving");var r=function(n){n.type==="pointerup"&&(document.removeEventListener("pointermove",r),document.removeEventListener("pointerup",r),document.removeEventListener("pointercancel",r),setTimeout(function(){this.moving=!1,this.element.classList.remove("ol-moving")}.bind(this))),n.target===e&&t(n),n.stopPropagation(),n.preventDefault()}.bind(this);document.addEventListener("pointermove",r,!1),document.addEventListener("pointerup",r,!1),document.addEventListener("pointercancel",r,!1),i.stopPropagation(),i.preventDefault()}.bind(this);e.addEventListener("mousedown",s,!1),e.addEventListener("touchstart",s,!1)}setValue(e){e!==void 0&&(this.input.value=e),this.input.dispatchEvent(new Event("change"))}getValue(){return this.input.value}getInputElement(){return this.input}},se=class extends Pe{constructor(e){e=e||{},super(e);var t=this.element=document.createElement("label");e.html instanceof Element?t.appendChild(e.html):e.html!==void 0&&(t.innerHTML=e.html),t.className=("ol-ext-check ol-ext-checkbox "+(e.className||"")).trim(),this.input.parentNode&&this.input.parentNode.insertBefore(t,this.input),t.appendChild(this.input),t.appendChild(document.createElement("span")),e.after&&t.appendChild(document.createTextNode(e.after)),this.input.addEventListener("change",function(){this.dispatchEvent({type:"check",checked:this.input.checked,value:this.input.value})}.bind(this))}isChecked(){return this.input.checked}},Ie=class extends se{constructor(e){e=e||{},super(e),this.element.className=("ol-ext-toggle-switch "+(e.className||"")).trim()}},Fe=class extends se{constructor(e){e=e||{},super(e),this.element.className=("ol-ext-check ol-ext-radio "+(e.className||"")).trim()}},o={};o.create=function(a,e){e=e||{};var t;if(a==="TEXT")t=document.createTextNode(e.html||""),e.parent&&e.parent.appendChild(t);else{t=document.createElement(a.toLowerCase()),/button/i.test(a)&&t.setAttribute("type","button");for(var s in e)switch(s){case"className":{e.className&&e.className.trim&&t.setAttribute("class",e.className.trim());break}case"text":{t.innerText=e.text;break}case"html":{e.html instanceof Element?t.appendChild(e.html):e.html!==void 0&&(t.innerHTML=e.html);break}case"parent":{e.parent&&e.parent.appendChild(t);break}case"options":{if(/select/i.test(a))for(var i in e.options)o.create("OPTION",{html:i,value:e.options[i],parent:t});break}case"style":{o.setStyle(t,e.style);break}case"change":case"click":{o.addListener(t,s,e[s]);break}case"on":{for(var r in e.on)o.addListener(t,r,e.on[r]);break}case"checked":{t.checked=!!e.checked;break}default:{t.setAttribute(s,e[s]);break}}}return t};o.createSwitch=function(a){var e=o.create("INPUT",{type:"checkbox",on:a.on,click:a.click,change:a.change,parent:a.parent}),t=Object.assign({input:e},a||{});return new Ie(t),e};o.createCheck=function(a){var e=o.create("INPUT",{name:a.name,type:a.type==="radio"?"radio":"checkbox",on:a.on,parent:a.parent}),t=Object.assign({input:e},a||{});return a.type==="radio"?new Fe(t):new se(t),e};o.setHTML=function(a,e){e instanceof Element?a.appendChild(e):e!==void 0&&(a.innerHTML=e)};o.appendText=function(a,e){a.appendChild(document.createTextNode(e||""))};o.addListener=function(a,e,t,s){typeof e=="string"&&(e=e.split(" ")),e.forEach(function(i){a.addEventListener(i,t,s)})};o.removeListener=function(a,e,t){typeof e=="string"&&(e=e.split(" ")),e.forEach(function(s){a.removeEventListener(s,t)})};o.show=function(a){a.style.display=""};o.hide=function(a){a.style.display="none"};o.hidden=function(a){return o.getStyle(a,"display")==="none"};o.toggle=function(a){a.style.display=a.style.display==="none"?"":"none"};o.setStyle=function(a,e){for(var t in e)switch(t){case"top":case"left":case"bottom":case"right":case"minWidth":case"maxWidth":case"width":case"height":{typeof e[t]=="number"?a.style[t]=e[t]+"px":a.style[t]=e[t];break}default:a.style[t]=e[t]}};o.getStyle=function(a,e){var t,s=(a.ownerDocument||document).defaultView;if(s&&s.getComputedStyle)e=e.replace(/([A-Z])/g,"-$1").toLowerCase(),t=s.getComputedStyle(a,null).getPropertyValue(e);else if(a.currentStyle&&(e=e.replace(/-(\w)/g,function(i,r){return r.toUpperCase()}),t=a.currentStyle[e],/^\d+(em|pt|%|ex)?$/i.test(t)))return function(i){var r=a.style.left,n=a.runtimeStyle.left;return a.runtimeStyle.left=a.currentStyle.left,a.style.left=i||0,i=a.style.pixelLeft+"px",a.style.left=r,a.runtimeStyle.left=n,i}(t);return/px$/.test(t)?parseInt(t):t};o.outerHeight=function(a){return a.offsetHeight+o.getStyle(a,"marginBottom")};o.outerWidth=function(a){return a.offsetWidth+o.getStyle(a,"marginLeft")};o.offsetRect=function(a){var e=a.getBoundingClientRect();return{top:e.top+(window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0),left:e.left+(window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft||0),height:e.height||e.bottom-e.top,width:e.width||e.right-e.left}};o.getFixedOffset=function(a){var e={left:0,top:0},t=function(s){if(!s)return e;if(o.getStyle(s,"position")==="absolute"&&o.getStyle(s,"transform")!=="none"){var i=s.getBoundingClientRect();return e.left+=i.left,e.top+=i.top,e}return t(s.offsetParent)};return t(a.offsetParent)};o.positionRect=function(a,e){var t=0,s=0,i=function(r){if(r)return t+=r.offsetLeft,s+=r.offsetTop,i(r.offsetParent);var n={top:a.offsetTop+s,left:a.offsetLeft+t};return e&&(n.top-=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0,n.left-=window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft||0),n.bottom=n.top+a.offsetHeight,n.right=n.top+a.offsetWidth,n};return i(a.offsetParent)};o.scrollDiv=function(a,e){e=e||{};var t=!1,s=0,i,r=0,n=typeof e.onmove=="function"?e.onmove:function(){},h=e.vertical?"screenY":"screenX",d=e.vertical?"scrollTop":"scrollLeft",u=!1,p,l,c=0,y=function(){S&&(c++,setTimeout(f))},f=function(){if(S){if(c--,c)return;var _=a.clientHeight,k=a.scrollHeight;p=_/k,S.style.height=p*100+"%",S.style.top=a.scrollTop/k*100+"%",L.style.height=_+"px",_>k-.5?L.classList.add("ol-100pc"):L.classList.remove("ol-100pc")}},m=function(_){_.target.classList.contains("ol-noscroll")||(u=!1,t=_[h],r=new Date,a.classList.add("ol-move"),_.preventDefault(),window.addEventListener("pointermove",w),o.addListener(window,["pointerup","pointercancel"],T))},w=function(_){if(t!==!1){var k=(l?-1/p:1)*(t-_[h]);u=u||Math.round(k),a[d]+=k,i=new Date,i-r&&(s=(s+k/(i-r))/2),t=_[h],r=i,k&&n(!0)}else u=!0},E=function(_){var k=_>0?Math.min(100,_/2):Math.max(-100,_/2);_-=k,a[d]+=k,-1<_&&_<1?(u?setTimeout(function(){a.classList.remove("ol-move")}):a.classList.remove("ol-move"),u=!1,n(!1)):setTimeout(function(){E(_)},40)},L,S;if(e.vertical&&e.minibar){var M=function(_){a.removeEventListener("pointermove",M),a.parentNode.classList.add("ol-miniscroll"),S=o.create("DIV"),L=o.create("DIV",{className:"ol-scroll",html:S}),a.parentNode.insertBefore(L,a),S.addEventListener("pointerdown",function(k){l=!0,m(k)}),e.mousewheel&&(o.addListener(L,["mousewheel","DOMMouseScroll","onmousewheel"],function(k){g(k)}),o.addListener(S,["mousewheel","DOMMouseScroll","onmousewheel"],function(k){g(k)})),a.parentNode.addEventListener("pointerenter",y),window.addEventListener("resize",y),_!==!1&&y()};a.parentNode?M(!1):a.addEventListener("pointermove",M),a.addEventListener("scroll",function(){y()})}a.style["touch-action"]="none",a.style.overflow="hidden",a.classList.add("ol-scrolldiv"),o.addListener(a,["pointerdown"],function(_){l=!1,m(_)}),a.addEventListener("click",function(_){a.classList.contains("ol-move")&&(_.preventDefault(),_.stopPropagation())},!0);var T=function(_){r=new Date-r,r>100||l?s=0:r>0&&(s=((s||0)+(t-_[h])/r)/2),E(e.animate===!1?0:s*200),t=!1,s=0,r=0,a.classList.contains("ol-move")?a.classList.remove("ol-hasClick"):(a.classList.add("ol-hasClick"),setTimeout(function(){a.classList.remove("ol-hasClick")},500)),l=!1,window.removeEventListener("pointermove",w),o.removeListener(window,["pointerup","pointercancel"],T)},g=function(_){var k=Math.max(-1,Math.min(1,_.wheelDelta||-_.detail));return a.classList.add("ol-move"),a[d]-=k*30,a.classList.remove("ol-move"),!1};return e.mousewheel&&o.addListener(a,["mousewheel","DOMMouseScroll","onmousewheel"],g),{refresh:y}};o.dispatchEvent=function(a,e){var t;try{t=new CustomEvent(a)}catch{t=document.createEvent("CustomEvent"),t.initCustomEvent(a,!0,!0,{})}e.dispatchEvent(t)};o.setCursor=function(a,e){a instanceof me&&(a=a.getTargetElement()),!("ontouchstart"in window)&&a instanceof Element&&(a.style.cursor=e)};var de=class extends K{constructor(e){e=e||{};var t=o.create("DIV",{className:e.switcherClass||"ol-layerswitcher"});super({element:t,target:e.target});var s=this;this.dcount=0,this.show_progress=e.show_progress,this.oninfo=typeof e.oninfo=="function"?e.oninfo:null,this.onextent=typeof e.onextent=="function"?e.onextent:null,this.hasextent=e.extent||e.onextent,this.hastrash=e.trash,this.reordering=e.reordering!==!1,this._layers=[],this._layerGroup=e.layerGroup&&e.layerGroup.getLayers?e.layerGroup:null,this.onchangeCheck=typeof e.onchangeCheck=="function"?e.onchangeCheck:null,typeof e.displayInLayerSwitcher=="function"&&(this.displayInLayerSwitcher=e.displayInLayerSwitcher),e.target||(t.classList.add("ol-unselectable"),t.classList.add("ol-control"),t.classList.add(e.collapsed!==!1?"ol-collapsed":"ol-forceopen"),this.button=o.create("BUTTON",{type:"button",parent:t}),this.button.addEventListener("touchstart",function(i){t.classList.toggle("ol-forceopen"),t.classList.add("ol-collapsed"),s.dispatchEvent({type:"toggle",collapsed:t.classList.contains("ol-collapsed")}),i.preventDefault(),s.overflow()}),this.button.addEventListener("click",function(){t.classList.toggle("ol-forceopen"),t.classList.add("ol-collapsed"),s.dispatchEvent({type:"toggle",collapsed:!t.classList.contains("ol-forceopen")}),s.overflow()}),e.mouseover&&(t.addEventListener("mouseleave",function(){t.classList.add("ol-collapsed"),s.dispatchEvent({type:"toggle",collapsed:!0})}),t.addEventListener("mouseover",function(){t.classList.remove("ol-collapsed"),s.dispatchEvent({type:"toggle",collapsed:!1})})),e.minibar&&(e.noScroll=!0),e.noScroll||(this.topv=o.create("DIV",{className:"ol-switchertopdiv",parent:t,click:function(){s.overflow("+50%")}}),this.botv=o.create("DIV",{className:"ol-switcherbottomdiv",parent:t,click:function(){s.overflow("-50%")}})),this._noScroll=e.noScroll),this.panel_=o.create("UL",{className:"panel"}),this.panelContainer_=o.create("DIV",{className:"panel-container",html:this.panel_,parent:t}),!e.target&&!e.noScroll&&o.addListener(this.panel_,"mousewheel DOMMouseScroll onmousewheel",function(i){s.overflow(Math.max(-1,Math.min(1,i.wheelDelta||-i.detail)))&&(i.stopPropagation(),i.preventDefault())}),this.header_=o.create("LI",{className:"ol-header",parent:this.panel_}),this.set("drawDelay",e.drawDelay||0),this.set("selection",e.selection),e.minibar&&setTimeout(function(){var i=o.scrollDiv(this.panelContainer_,{mousewheel:!0,vertical:!0,minibar:!0});this.on(["drawlist","toggle"],function(){i.refresh()})}.bind(this))}displayInLayerSwitcher(e){return e.get("displayInLayerSwitcher")!==!1}setMap(e){if(super.setMap(e),this.drawPanel(),this._listener)for(var t in this._listener)A(this._listener[t]);this._listener=null,e&&(this._listener={moveend:e.on("moveend",this.viewChange.bind(this)),size:e.on("change:size",this.overflow.bind(this))},this._layerGroup?this._listener.change=this._layerGroup.getLayers().on("change:length",this.drawPanel.bind(this)):this._listener.change=e.getLayerGroup().getLayers().on("change:length",this.drawPanel.bind(this)))}show(){this.element.classList.add("ol-forceopen"),this.overflow(),this.dispatchEvent({type:"toggle",collapsed:!1})}hide(){this.element.classList.remove("ol-forceopen"),this.overflow(),this.dispatchEvent({type:"toggle",collapsed:!0})}toggle(){this.element.classList.toggle("ol-forceopen"),this.overflow(),this.dispatchEvent({type:"toggle",collapsed:!this.isOpen()})}isOpen(){return this.element.classList.contains("ol-forceopen")}setHeader(e){o.setHTML(this.header_,e)}overflow(e){if(this.button&&!this._noScroll){if(o.hidden(this.panel_)){o.setStyle(this.element,{height:"auto"});return}var t=o.outerHeight(this.element),s=o.outerHeight(this.panel_),i=this.button.offsetTop+o.outerHeight(this.button),r=this.panel_.offsetTop-i;if(s>t-i){o.setStyle(this.element,{height:"100%"});var n=this.panel_.querySelectorAll("li.ol-visible .li-content")[0],h=n?2*o.getStyle(n,"height"):0;switch(e){case 1:r+=h;break;case-1:r-=h;break;case"+50%":r+=Math.round(t/2);break;case"-50%":r-=Math.round(t/2);break}return r+s<=t-3*i/2?(r=t-3*i/2-s,o.hide(this.botv)):o.show(this.botv),r>=0?(r=0,o.hide(this.topv)):o.show(this.topv),o.setStyle(this.panel_,{top:r+"px"}),!0}else return o.setStyle(this.element,{height:"auto"}),o.setStyle(this.panel_,{top:0}),o.hide(this.botv),o.hide(this.topv),!1}else return!1}_setLayerForLI(e,t){var s=[];t.getLayers&&s.push(t.getLayers().on("change:length",this.drawPanel.bind(this))),e&&(s.push(t.on("change:opacity",function(){this.setLayerOpacity(t,e)}.bind(this))),s.push(t.on("change:visible",function(){this.setLayerVisibility(t,e)}.bind(this)))),s.push(t.on("propertychange",function(i){(i.key==="displayInLayerSwitcher"||i.key==="openInLayerSwitcher"||i.key==="title"||i.key==="name")&&this.drawPanel(i)}.bind(this))),this._layers.push({li:e,layer:t,listeners:s})}setLayerOpacity(e,t){var s=t.querySelector(".layerswitcher-opacity-cursor");s&&(s.style.left=e.getOpacity()*100+"%"),this.dispatchEvent({type:"layer:opacity",layer:e})}setLayerVisibility(e,t){var s=t.querySelector(".ol-visibility");s&&(s.checked=e.getVisible()),e.getVisible()?t.classList.add("ol-visible"):t.classList.remove("ol-visible"),this.dispatchEvent({type:"layer:visible",layer:e})}_clearLayerForLI(){this._layers.forEach(function(e){e.listeners.forEach(function(t){A(t)})}),this._layers=[]}_getLayerForLI(e){for(var t=0,s;s=this._layers[t];t++)if(s.li===e)return s.layer;return null}viewChange(){this.panel_.querySelectorAll("li").forEach(function(e){var t=this._getLayerForLI(e);t&&(this.testLayerVisibility(t)?e.classList.remove("ol-layer-hidden"):e.classList.add("ol-layer-hidden"))}.bind(this))}getPanel(){return this.panelContainer_}drawPanel(){if(this.getMap()){var e=this;this.dcount++,setTimeout(function(){e.drawPanel_()},this.get("drawDelay")||0)}}drawPanel_(){if(!(--this.dcount||this.dragging_)){var e=this.panelContainer_.scrollTop;this._clearLayerForLI(),this.panel_.querySelectorAll("li").forEach(function(t){t.classList.contains("ol-header")||t.remove()}.bind(this)),this._layerGroup?this.drawList(this.panel_,this._layerGroup.getLayers()):this.getMap()&&this.drawList(this.panel_,this.getMap().getLayers()),this.panelContainer_.scrollTop=e}}switchLayerVisibility(e,t){e.get("baseLayer")?(e.getVisible()||e.setVisible(!0),t.forEach(function(s){e!==s&&s.get("baseLayer")&&s.getVisible()&&s.setVisible(!1)})):e.setVisible(!e.getVisible())}testLayerVisibility(e){if(!this.getMap())return!0;var t=this.getMap().getView().getResolution(),s=this.getMap().getView().getZoom();if(e.getMaxResolution()<=t||e.getMinResolution()>=t)return!1;if(e.getMinZoom&&(e.getMinZoom()>=s||e.getMaxZoom()<s))return!1;var i=e.getExtent();if(i){var r=this.getMap().getView().calculateExtent(this.getMap().getSize());return ye(r,i)}return!0}dragOrdering_(e){e.stopPropagation(),e.preventDefault();var t=this,s=e.currentTarget.parentNode.parentNode,i=!0,r=this.panel_,n,h=e.pageY||e.touches&&e.touches.length&&e.touches[0].pageY||e.changedTouches&&e.changedTouches.length&&e.changedTouches[0].pageY,d,u,p,l;s.parentNode.classList.add("drag");function c(){if(d){var f=p,m=t.getSelection()===f;if(f&&d){var w;l?w=l.getLayers():w=t._layerGroup?t._layerGroup.getLayers():t.getMap().getLayers();for(var E=w.getArray(),L=0;L<E.length;L++)if(E[L]==f){w.removeAt(L);break}for(var S=0;S<E.length;S++)if(E[S]===d){L>S?w.insertAt(S,f):w.insertAt(S+1,f);break}}m&&t.selectLayer(f),t.dispatchEvent({type:"reorder-end",layer:f,group:l})}s.parentNode.querySelectorAll("li").forEach(function(M){M.classList.remove("dropover"),M.classList.remove("dropover-after"),M.classList.remove("dropover-before")}),s.classList.remove("drag"),s.parentNode.classList.remove("drag"),t.element.classList.remove("drag"),u&&u.remove(),o.removeListener(document,"mousemove touchmove",y),o.removeListener(document,"mouseup touchend touchcancel",c)}function y(f){if(n=f.pageY||f.touches&&f.touches.length&&f.touches[0].pageY||f.changedTouches&&f.changedTouches.length&&f.changedTouches[0].pageY,i&&Math.abs(h-n)>2&&(i=!1,s.classList.add("drag"),p=t._getLayerForLI(s),d=!1,l=t._getLayerForLI(s.parentNode.parentNode),u=o.create("LI",{className:"ol-dragover",html:s.innerHTML,style:{position:"absolute","z-index":1e4,left:s.offsetLeft,opacity:.5,width:o.outerWidth(s),height:o.getStyle(s,"height")},parent:r}),t.element.classList.add("drag"),t.dispatchEvent({type:"reorder-start",layer:p,group:l})),!i){f.preventDefault(),f.stopPropagation(),o.setStyle(u,{top:n-o.offsetRect(r).top+r.scrollTop+5});var m;if(!f.touches)m=f.target,f.target.shadowRoot&&(m=f.composedPath()[0]);else for(m=document.elementFromPoint(f.touches[0].clientX,f.touches[0].clientY);m.shadowRoot;)m=m.shadowRoot.elementFromPoint(f.touches[0].clientX,f.touches[0].clientY);for(m.classList.contains("ol-switcherbottomdiv")?t.overflow(-1):m.classList.contains("ol-switchertopdiv")&&t.overflow(1);m&&m.tagName!=="LI";)m=m.parentNode;(!m||!m.classList.contains("dropover"))&&s.parentNode.querySelectorAll("li").forEach(function(w){w.classList.remove("dropover"),w.classList.remove("dropover-after"),w.classList.remove("dropover-before")}),m&&m.parentNode.classList.contains("drag")&&m!==s?(d=t._getLayerForLI(m),d&&!d.get("allwaysOnTop")==!p.get("allwaysOnTop")?(m.classList.add("dropover"),m.classList.add(s.offsetTop<m.offsetTop?"dropover-after":"dropover-before")):d=!1,o.show(u)):(d=!1,m===s?o.hide(u):o.show(u)),d?u.classList.remove("forbidden"):u.classList.add("forbidden")}}o.addListener(document,"mousemove touchmove",y),o.addListener(document,"mouseup touchend touchcancel",c)}dragOpacity_(e){e.stopPropagation(),e.preventDefault();var t=this,s=e.target,i=this._getLayerForLI(s.parentNode.parentNode.parentNode);if(!i)return;var r=e.pageX||e.touches&&e.touches.length&&e.touches[0].pageX||e.changedTouches&&e.changedTouches.length&&e.changedTouches[0].pageX,n=o.getStyle(s,"left")-r;t.dragging_=!0;function h(){o.removeListener(document,"mouseup touchend touchcancel",h),o.removeListener(document,"mousemove touchmove",d),t.dragging_=!1}function d(u){var p=u.pageX||u.touches&&u.touches.length&&u.touches[0].pageX||u.changedTouches&&u.changedTouches.length&&u.changedTouches[0].pageX,l=(n+p)/o.getStyle(s.parentNode,"width"),c=Math.max(0,Math.min(1,l));o.setStyle(s,{left:c*100+"%"}),s.parentNode.nextElementSibling.innerHTML=Math.round(c*100),i.setOpacity(c)}o.addListener(document,"mouseup touchend touchcancel",h),o.addListener(document,"mousemove touchmove",d)}drawList(e,t){var s=this,i=t.getArray(),r=function(l){l.stopPropagation(),l.preventDefault();var c=s._getLayerForLI(this.parentNode.parentNode);s.switchLayerVisibility(c,t),s.get("selection")&&c.getVisible()&&s.selectLayer(c),s.onchangeCheck&&s.onchangeCheck(c)};function n(l){l.stopPropagation(),l.preventDefault();var c=s._getLayerForLI(this.parentNode.parentNode);s.oninfo(c),s.dispatchEvent({type:"info",layer:c})}function h(l){l.stopPropagation(),l.preventDefault();var c=s._getLayerForLI(this.parentNode.parentNode);s.onextent?s.onextent(c):s.getMap().getView().fit(c.getExtent(),s.getMap().getSize()),s.dispatchEvent({type:"extent",layer:c})}function d(l){l.stopPropagation(),l.preventDefault();var c=this.parentNode.parentNode.parentNode.parentNode,y,f=s._getLayerForLI(c);f?(y=s._getLayerForLI(this.parentNode.parentNode),f.getLayers().remove(y),f.getLayers().getLength()==0&&!f.get("noSwitcherDelete")&&d.call(c.querySelectorAll(".layerTrash")[0],l)):(c=this.parentNode.parentNode,s.getMap().removeLayer(s._getLayerForLI(c)))}function u(l){if(!this.displayInLayerSwitcher(l)){this._setLayerForLI(null,l);return}var c=o.create("LI",{className:(l.getVisible()?"ol-visible ":" ")+(l.get("baseLayer")?"baselayer":""),parent:e});this._setLayerForLI(c,l),this._selectedLayer===l&&c.classList.add("ol-layer-select");var y=o.create("DIV",{className:"ol-layerswitcher-buttons",parent:c}),f=o.create("DIV",{className:"li-content",parent:c}),m=o.create("INPUT",{type:l.get("baseLayer")?"radio":"checkbox",className:"ol-visibility",checked:l.getVisible(),click:function(g){r.bind(this)(g),setTimeout(function(){g.target.checked=l.getVisible()})},on:{keydown:function(g){switch(g.key){case"ArrowLeft":case"ArrowRight":{g.preventDefault(),g.stopPropagation();var _=g.key==="ArrowLeft"?-.1:.1,k=Math.min(1,Math.max(0,l.getOpacity()+_));l.setOpacity(k);break}case"Enter":{s.get("selection")&&(g.preventDefault(),g.stopPropagation(),s.selectLayer(l));break}case"-":case"+":l.getLayers&&(this._focus=l,l.set("openInLayerSwitcher",!l.get("openInLayerSwitcher")));case"ArrowUp":case"ArrowDown":{if(g.ctrlKey&&this.reordering){g.preventDefault(),g.stopPropagation();var b=t.getArray().indexOf(l);b>-1&&(g.key==="ArrowDown"?b>0&&(t.remove(l),t.insertAt(b-1,l),s._focus=l,s.dispatchEvent({type:"reorder-end",layer:l})):b<t.getLength()-1&&(t.remove(l),t.insertAt(b+1,l),s._focus=l,s.dispatchEvent({type:"reorder-end",layer:l})))}break}default:{var v=this._getLayerForLI(e.parentNode);this.dispatchEvent({type:"layer:keydown",key:g.key,group:v,li:c,layer:l,originalEvent:g})}}}.bind(this)},parent:f});l===s._focus&&(m.focus(),s.overflow());var w=o.create("LABEL",{title:l.get("title")||l.get("name"),click:r,style:{userSelect:"none"},parent:f});if(w.addEventListener("selectstart",function(){return!1}),o.create("SPAN",{html:l.get("title")||l.get("name"),click:function(g){this.get("selection")&&(g.stopPropagation(),this.selectLayer(l))}.bind(this),parent:w}),this.reordering&&(p<i.length-1&&(l.get("allwaysOnTop")||!i[p+1].get("allwaysOnTop"))||p>0&&(!l.get("allwaysOnTop")||i[p-1].get("allwaysOnTop")))&&o.create("DIV",{className:"layerup ol-noscroll",title:this.tip.up,on:{"mousedown touchstart":function(g){s.dragOrdering_(g)}},parent:y}),l.getLayers){var E=0;l.getLayers().forEach(function(g){s.displayInLayerSwitcher(g)&&E++}),E&&o.create("DIV",{className:l.get("openInLayerSwitcher")?"collapse-layers":"expend-layers",title:this.tip.plus,click:function(){var g=s._getLayerForLI(this.parentNode.parentNode);g.set("openInLayerSwitcher",!g.get("openInLayerSwitcher"))},parent:y})}if(this.oninfo&&o.create("DIV",{className:"layerInfo",title:this.tip.info,click:n,parent:y}),this.hastrash&&!l.get("noSwitcherDelete")&&o.create("DIV",{className:"layerTrash",title:this.tip.trash,click:d,parent:y}),this.hasextent&&i[p].getExtent()){var L=i[p].getExtent();L.length==4&&L[0]<L[2]&&L[1]<L[3]&&o.create("DIV",{className:"layerExtent",title:this.tip.extent,click:h,parent:y})}if(this.show_progress&&l instanceof ae){var S=o.create("DIV",{className:"layerswitcher-progress",parent:f});this.setprogress_(l),l.layerswitcher_progress=o.create("DIV",{parent:S})}var M=o.create("DIV",{className:"layerswitcher-opacity",click:function(g){if(g.target===this){g.stopPropagation(),g.preventDefault();var _=Math.max(0,Math.min(1,g.offsetX/o.getStyle(this,"width")));s._getLayerForLI(this.parentNode.parentNode).setOpacity(_),this.parentNode.querySelectorAll(".layerswitcher-opacity-label")[0].innerHTML=Math.round(_*100)}},parent:f});if(o.create("DIV",{className:"layerswitcher-opacity-cursor ol-noscroll",style:{left:l.getOpacity()*100+"%"},on:{"mousedown touchstart":function(g){s.dragOpacity_(g)}},parent:M}),o.create("DIV",{className:"layerswitcher-opacity-label",html:Math.round(l.getOpacity()*100),parent:f}),l.getLayers&&(c.classList.add("ol-layer-group"),l.get("openInLayerSwitcher")===!0)){var T=o.create("UL",{parent:c});this.drawList(T,l.getLayers())}c.classList.add(this.getLayerClass(l)),this.dispatchEvent({type:"drawlist",layer:l,li:c})}for(var p=i.length-1;p>=0;p--)u.call(this,i[p]);this.viewChange(),e===this.panel_&&(this.overflow(""),this._focus=null)}getLayerClass(e){return e?e.getLayers?"ol-layer-group":e instanceof ee?"ol-layer-vector":e instanceof Le?"ol-layer-vectortile":e instanceof ae?"ol-layer-tile":e instanceof we?"ol-layer-image":e instanceof be?"ol-layer-heatmap":e.getFeatures?"ol-layer-vectorimage":"unknown":"none"}selectLayer(e,t){if(!e){if(!this.getMap())return;e=this.getMap().getLayers().item(this.getMap().getLayers().getLength()-1)}this._selectedLayer=e,this.element.querySelector("input.ol-visibility:focus")&&(this._focus=e),this.drawPanel(),t||this.dispatchEvent({type:"select",layer:e})}getSelection(){return this._selectedLayer}setprogress_(e){if(!e.layerswitcher_progress){var t=0,s=0,i=function(){s===t?(s=t=0,o.setStyle(e.layerswitcher_progress,{width:0})):o.setStyle(e.layerswitcher_progress,{width:(t/s*100).toFixed(1)+"%"})};e.getSource().on("tileloadstart",function(){s++,i()}),e.getSource().on("tileloadend",function(){t++,i()}),e.getSource().on("tileloaderror",function(){t++,i()})}}};de.prototype.tip={up:"up/down",down:"down",info:"informations...",extent:"zoom to extent",trash:"remove layer",plus:"expand/shrink"};var ze=class extends de{constructor(e){e=e||{},e.switcherClass="ol-layerswitcher-popup"+(e.switcherClass?" "+e.switcherClass:""),e.mouseover!==!1&&(e.mouseover=!0),super(e)}overflow(){}drawList(e,t){var s=this,i=function(r){r.preventDefault();var n=s._getLayerForLI(this);s.switchLayerVisibility(n,t),r.type==="touchstart"&&s.element.classList.add("ol-collapsed")};t.forEach(function(r){if(s.displayInLayerSwitcher(r)){var n=o.create("LI",{html:r.get("title")||r.get("name"),on:{"click touchstart":i},parent:e});s._setLayerForLI(n,r),s.testLayerVisibility(r)&&n.classList.add("ol-layer-hidden"),r.getVisible()&&n.classList.add("ol-visible")}})}},Xe=class extends K{constructor(e){e=e||{};var t=document.createElement("div");super({element:t,target:e.target}),this.contentElement=o.create("DIV",{click:function(){this.get("hideOnClick")&&this.hide()}.bind(this),parent:t});var s=(e.className||"")+" ol-notification";e.target||(s+=" ol-unselectable ol-control ol-collapsed"),t.setAttribute("class",s),this.set("closeBox",e.closeBox),this.set("hideOnClick",e.hideOnClick)}show(e,t){var s=this,i=this.element;e&&(e instanceof Node?(this.contentElement.innerHTML="",this.contentElement.appendChild(e)):this.contentElement.innerHTML=e,this.get("closeBox")?(this.contentElement.classList.add("ol-close"),o.create("SPAN",{className:"closeBox",click:function(){this.hide()}.bind(this),parent:this.contentElement})):this.contentElement.classList.remove("ol-close")),this._listener&&(clearTimeout(this._listener),this._listener=null),i.classList.add("ol-collapsed"),this._listener=setTimeout(function(){i.classList.remove("ol-collapsed"),!t||t>=0?s._listener=setTimeout(function(){i.classList.add("ol-collapsed"),s._listener=null},t||3e3):s._listener=null},100)}hide(){this._listener&&(clearTimeout(this._listener),this._listener=null),this.element.classList.add("ol-collapsed")}toggle(e){this.element.classList.contains("ol-collapsed")?this.show(null,e):this.hide()}},Ye=class extends K{constructor(e){e=e||{};var t=o.create("DIV",{className:((e.className||"")+" ol-progress-bar ol-unselectable ol-control").trim()});super({element:t,target:e.target}),this._waiting=o.create("DIV",{html:e.label||"",className:"ol-waiting",parent:t}),this._bar=o.create("DIV",{className:"ol-bar",parent:t}),this._layerlistener=[],this.setLayers(e.layers)}setPercent(e){this._bar.style.width=(Number(e)||0)*100+"%",e===void 0?o.hide(this.element):o.show(this.element)}setLabel(e){this._waiting.innerHTML=e}setLayers(e){this._layerlistener.forEach(function(r){A(r)}),this._layerlistener=[],this.setPercent();var t=0,s=0;if(e instanceof ne&&(e=[e]),!(!e||!e.forEach)){var i;e.forEach(function(r){r instanceof ne&&(this._layerlistener.push(r.getSource().on("tileloadstart",function(){t++,this.setPercent(s/t),clearTimeout(i)}.bind(this))),this._layerlistener.push(r.getSource().on(["tileloadend","tileloaderror"],function(){s++,s===t?(t=s=0,this.setPercent(1),i=setTimeout(this.setPercent.bind(this),300)):this.setPercent(s/t)}.bind(this))))}.bind(this))}}},Ne=function(a,e){var t=a.getView(),s=t.getProjection(),i=t.getCenter(),r=a.getPixelFromCoordinate(i);r[1]+=1;var n=a.getCoordinateFromPixel(r),h=ue(B(i,s,"EPSG:4326"),B(n,s,"EPSG:4326"));return h*=(e||96)/.0254,h},Ve=function(a,e,t){if(a&&e){var s=e;if(typeof e=="string"&&(e=e.replace(":","/").split("/"),s=e[1],s||(s=e[0]||""),s=s.replace(/[^\d]/g,""),s=parseInt(s),e[1])){var i=parseInt(e[0]);i&&(s/=i)}if(!s)return;var r=a.getView(),n=r.getProjection(),h=r.getCenter(),d=a.getPixelFromCoordinate(h);d[1]+=1;var u=a.getCoordinateFromPixel(d),p=ue(B(h,n,"EPSG:4326"),B(u,n,"EPSG:4326"));return p*=(t||96)/.0254,r.setResolution(r.getResolution()*s/p),s}},We=class extends K{constructor(e){e=e||{},e.typing===void 0&&(e.typing=300);var t=document.createElement("DIV"),s=(e.className||"")+" ol-scale";e.target||(s+=" ol-unselectable ol-control"),super({element:t,target:e.target}),this._input=document.createElement("INPUT"),this._input.value="-",t.setAttribute("class",s),e.editable===!1&&(this._input.readOnly=!0),t.appendChild(this._input),this._input.addEventListener("change",this.setScale.bind(this)),this.set("ppi",e.ppi||96)}setMap(e){this._listener&&A(this._listener),this._listener=null,super.setMap(e),e&&(this._listener=e.on("moveend",this.getScale.bind(this)))}getScale(){var e=this.getMap();if(e){var t=Ne(e,this.get("ppi"));return this._input.value=this.formatScale(t),t}}formatScale(e){return e>100?e=Math.round(e/100)*100:e=Math.round(e),"1 / "+e.toLocaleString()}setScale(e){var t=this.getMap();t&&e&&(e.target&&(e=e.target.value),Ve(t,e,this.get("ppi"))),this.getScale()}},Je=class extends te{constructor(e){super(e),this.on("select",function(t){this.getFeatures().clear(),this.delete(t.selected)}.bind(this))}_getSources(e){if(!this.getMap())return[];e||(e=this.getMap().getLayers());var t=[];return e.forEach(function(s){s.getLayers?t=t.concat(this._getSources(s.getLayers())):s.getSource&&s.getSource()instanceof G&&t.push(s.getSource())}.bind(this)),t}delete(e){if(e&&(e.length||e.getLength())){this.dispatchEvent({type:"deletestart",features:e});var t=[];this._getSources().forEach(function(s){try{e.forEach(function(i){s.removeFeature(i),t.push(i)})}catch{}}),this.dispatchEvent({type:"deleteend",features:t})}}},je=class extends ke{constructor(e){e=e||{};var t=function(r,n){var h=r[0].pop();return(!this.getPolygon()||this.getPolygon().intersectsCoordinate(h))&&(this.lastOKCoord=[h[0],h[1]]),r[0].push([this.lastOKCoord[0],this.lastOKCoord[1]]),n?n.setCoordinates([r[0].concat([r[0][0]])]):n=new X(r),n},s=e.geometryFunction;if(s?e.geometryFunction=function(r,n,h){return n=t.bind(this)(r,n),s.bind(this)(r,n,h)}:e.geometryFunction=t,e.type="Polygon",super(e),this._select=new te({style:e.style}),this._select.setActive(!1),e.layers&&(typeof e.layers=="function"?this.layers_=e.layers:e.layers.indexOf&&(this.layers_=function(r){return e.layers.indexOf(r)>=0})),typeof e.featureFilter=="function")this._features=e.featureFilter;else if(e.featureFilter){var i=e.featureFilter;this._features=function(r){return i.indexOf?!!i[i.indexOf(r)]:!!i.item(i.getArray().indexOf(r))}}else this._features=function(){return!0};this.on("drawstart",this._startDrawing.bind(this)),this.on("drawend",this._finishDrawing.bind(this))}setMap(e){this.getMap()&&this.getMap().removeInteraction(this._select),e&&e.addInteraction(this._select),super.setMap.call(this,e)}setActive(e){this._select&&this._select.getFeatures().clear(),super.setActive.call(this,e)}removeLastPoint(){this._feature&&this._feature.getGeometry().getCoordinates()[0].length>2&&super.removeLastPoint.call(this)}getPolygon(){return this._polygon}_startDrawing(e){var t=this.getMap();this._feature=e.feature;var s=e.feature.getGeometry().getCoordinates()[0][0];this._current=null,t.forEachFeatureAtPixel(t.getPixelFromCoordinate(s),function(i,r){if(!this._current&&this._features(i,r)){var n=i.getGeometry();if(n.getType()==="Polygon"&&n.intersectsCoordinate(s))this._polygonIndex=!1,this._polygon=n,this._current=i;else if(n.getType()==="MultiPolygon"&&n.intersectsCoordinate(s)){for(var h=0,d;d=n.getPolygon(h);h++)if(d.intersectsCoordinate(s)){this._polygonIndex=h,this._polygon=d,this._current=i;break}}}}.bind(this),{layerFilter:this.layers_}),this._select.getFeatures().clear(),this._current?this._select.getFeatures().push(this._current):(this.setActive(!1),this.setActive(!0))}_finishDrawing(e){e.hole=e.feature,e.feature=this._select.getFeatures().item(0),this.dispatchEvent({type:"modifystart",features:[this._current]});var t=e.hole.getGeometry().getCoordinates()[0];if(t.length>3)if(this._polygonIndex!==!1){for(var s=e.feature.getGeometry(),i=new Se([]),r=0,n;n=s.getPolygon(r);r++)r===this._polygonIndex&&n.appendLinearRing(new oe(t)),i.appendPolygon(n);e.feature.setGeometry(i)}else this.getPolygon().appendLinearRing(new oe(t));this.dispatchEvent({type:"modifyend",features:[this._current]}),this._feature=null,this._select.getFeatures().clear()}_geometryFn(e,t){var s=e[0].pop();return(!this.getPolygon()||this.getPolygon().intersectsCoordinate(s))&&(this.lastOKCoord=[s[0],s[1]]),e[0].push([this.lastOKCoord[0],this.lastOKCoord[1]]),t?t.setCoordinates([e[0].concat([e[0][0]])]):t=new X(e),t}},_e;(function(){var a=[255,255,255,1],e=[0,153,255,1],t=3,s=[new z({stroke:new O({color:a,width:t+2})}),new z({image:new le({radius:t*2,fill:new q({color:e}),stroke:new O({color:a,width:t/2})}),stroke:new O({color:e,width:t}),fill:new q({color:[255,255,255,.5]})})];_e=function(i){if(i===!0)return s;i=i||{};var r=new q({color:i.fillColor||"rgba(255,255,255,0.4)"}),n=new O({color:i.color||"#3399CC",width:1.25}),h=new z({image:new le({fill:r,stroke:n,radius:5}),fill:r,stroke:n});return[h]}})();var De=class extends fe{constructor(e){e=e||{},super({handleEvent:function(i){return t.handleEvent_(i)}});var t=this;this.squaredClickTolerance_=e.clickTolerance?e.clickTolerance*e.clickTolerance:36,this.maxCircleCoordinates_=e.maxCircleCoordinates||100,this.features_=e.features,this.source_=e.source,this.conditionFn_=e.condition,this.squareFn_=e.squareCondition,this.centeredFn_=e.centerCondition,this.canRotate_=e.canRotate!==!1,this.geometryName_=e.geometryName||"geometry",this.setSides(e.sides);var s=_e(!0);this.sketch_=new H,this.overlayLayer_=new ee({source:new G({features:this.sketch_,useSpatialIndex:!1}),name:"DrawRegular overlay",displayInLayerSwitcher:!1,style:e.style||s})}setMap(e){this.getMap()&&this.getMap().removeLayer(this.overlayLayer_),super.setMap(e),this.overlayLayer_.setMap(e)}setActive(e){this.reset(),super.setActive(e)}reset(){this.overlayLayer_&&this.overlayLayer_.getSource().clear(),this.started_=!1}setSides(e){e=parseInt(e),this.sides_=e>2?e:0}canRotate(e){return(e===!0||e===!1)&&(this.canRotate_=e),this.canRotate_}getSides(){return this.sides_}getGeom_(){if(this.overlayLayer_.getSource().clear(),!this.center_)return!1;var e;if(this.coord_){var t=this.center_,s=this.coord_,i,r,n,h,d;if(!this.sides_&&this.square_&&!this.centered_)return t=[(s[0]+t[0])/2,(s[1]+t[1])/2],i=[s[0]-t[0],s[1]-t[1]],n=Math.sqrt(i[0]*i[0]+i[1]*i[1]),h=new he(t,n,"XY"),d=this.getMap().getPixelFromCoordinate(t),r=Math.max(100,Math.abs(d[0]-this.coordPx_[0]),Math.abs(d[1]-this.coordPx_[1])),r=Math.min(this.maxCircleCoordinates_,Math.round(r/3)),$(h,r,0);var u=this.canRotate_&&this.centered_&&this.square_;if(i=[s[0]-t[0],s[1]-t[1]],this.square_&&!u){var p=Math.max(Math.abs(i[0]),Math.abs(i[1]));s=[t[0]+(i[0]>0?p:-p),t[1]+(i[1]>0?p:-p)]}if(n=Math.sqrt(i[0]*i[0]+i[1]*i[1]),n>0){h=new he(t,n,"XY");var l;if(u?l=Math.atan2(i[1],i[0]):l=this.startAngle[this.sides_]||this.startAngle.default,this.sides_?e=$(h,this.sides_,l):(d=this.getMap().getPixelFromCoordinate(this.center_),r=Math.max(100,Math.abs(d[0]-this.coordPx_[0]),Math.abs(d[1]-this.coordPx_[1])),r=Math.min(this.maxCircleCoordinates_,Math.round(r/(this.centered_?3:5))),e=$(h,r,0)),u)return e;var c=e.getExtent();this.centered_?t=[2*this.center_[0]-this.coord_[0],2*this.center_[1]-this.coord_[1]]:t=this.center_;var y=(t[0]-s[0])/(c[0]-c[2]),f=(t[1]-s[1])/(c[1]-c[3]);if(this.square_){var m=Math.min(Math.abs(y),Math.abs(f));y=Math.sign(y)*m,f=Math.sign(f)*m}var w=[t[0]-c[0]*y,t[1]-c[1]*f];return e.applyTransform(function(E,L,S){for(var M=0;M<E.length;M+=S)L[M]=E[M]*y+w[0],L[M+1]=E[M+1]*f+w[1];return L}),e}}return new x(this.center_)}drawSketch_(e){if(this.overlayLayer_.getSource().clear(),e){this.square_=this.squareFn_?this.squareFn_(e):e.originalEvent.shiftKey,this.centered_=this.centeredFn_?this.centeredFn_(e):e.originalEvent.metaKey||e.originalEvent.ctrlKey;var t=this.getGeom_();if(t){var s=this.feature_;return t.getType()==="Polygon"&&s.getGeometry().setCoordinates(t.getCoordinates()),this.overlayLayer_.getSource().addFeature(s),this.coord_&&this.square_&&(this.canRotate_&&this.centered_&&this.coord_||!this.sides_&&!this.centered_)&&this.overlayLayer_.getSource().addFeature(new P(new Ee([this.center_,this.coord_]))),s}}}drawPoint_(e,t){t||this.overlayLayer_.getSource().clear(),this.overlayLayer_.getSource().addFeature(new P(new x(e)))}handleEvent_(e){var t,s;switch(this._eventTime=new Date,e.type){case"pointerdown":{if(this.conditionFn_&&!this.conditionFn_(e))break;this.downPx_=e.pixel,this.start_(e);var i=500;this._longTouch=!1,setTimeout(function(){this._longTouch=new Date-this._eventTime>.9*i,this._longTouch&&this.handleMoveEvent_(e)}.bind(this),i),this.lastEvent=e.type;break}case"pointerup":{this.started_&&this.coord_&&(t=this.downPx_[0]-e.pixel[0],s=this.downPx_[1]-e.pixel[1],t*t+s*s<=this.squaredClickTolerance_&&(this.lastEvent=="pointerdown"||this.lastEvent=="pointermove"||this.lastEvent=="keydown"?this.end_(e):(t=this.upPx_[0]-e.pixel[0],s=this.upPx_[1]-e.pixel[1],t*t+s*s<=this.squaredClickTolerance_?this.end_(e):(this.handleMoveEvent_(e),this.drawPoint_(e.coordinate,!0))))),this.upPx_=e.pixel;break}case"pointerdrag":{if(this.started_){var r=this.getMap().getPixelFromCoordinate(this.center_);t=r[0]-e.pixel[0],s=r[1]-e.pixel[1],t*t+s*s<=this.squaredClickTolerance_&&this.reset()}return!this._longTouch}case"pointermove":{this.started_?(t=this.downPx_[0]-e.pixel[0],s=this.downPx_[1]-e.pixel[1],t*t+s*s>this.squaredClickTolerance_&&(this.handleMoveEvent_(e),this.lastEvent=e.type)):this.drawPoint_(e.coordinate);break}default:{if(this.started_&&(e.type==="click"||e.type==="singleclick"||e.type==="dblclick"))return!1;this.lastEvent=e.type;break}}return!0}finishDrawing(){this.started_&&this.coord_&&this.end_({pixel:this.upPx_,coordinate:this.coord_})}handleMoveEvent_(e){if(this.started_){this.coord_=e.coordinate,this.coordPx_=e.pixel;var t=this.drawSketch_(e);this.dispatchEvent({type:"drawing",feature:t,pixel:e.pixel,startCoordinate:this.center_,coordinate:e.coordinate,square:this.square_,centered:this.centered_})}else this.drawPoint_(e.coordinate)}start_(e){if(this.started_)this.coord_=e.coordinate;else{this.started_=!0,this.center_=e.coordinate,this.coord_=null;var t=this.feature_=new P({});t.setGeometryName(this.geometryName_||"geometry"),t.setGeometry(new X([[e.coordinate,e.coordinate,e.coordinate]])),this.drawSketch_(e),this.dispatchEvent({type:"drawstart",feature:t,pixel:e.pixel,coordinate:e.coordinate})}}end_(e){if(this.coord_=e.coordinate,this.started_=!1,this.coord_&&(this.center_[0]!==this.coord_[0]||this.center_[1]!==this.coord_[1])){var t=this.feature_;t.setGeometry(this.getGeom_()),this.source_?this.source_.addFeature(t):this.features_&&this.features_.push(t),this.dispatchEvent({type:"drawend",feature:t,pixel:e.pixel,coordinate:e.coordinate,square:this.square_,centered:this.centered_})}else this.dispatchEvent({type:"drawcancel",feature:null,pixel:e.pixel,coordinate:e.coordinate,square:this.square_,centered:this.centered_});this.center_=this.coord_=null,this.drawSketch_()}};De.prototype.startAngle={default:Math.PI/2,3:-Math.PI/2,4:Math.PI/4};var st=class extends te{constructor(e,t){if(e=e||{},e.condition||(e.condition=Me),super(e),this.setActive(e.active!==!1),this.set("name",e.name),this._attributes=t,this.on("select",function(r){this.getFeatures().clear(),this.fill(r.selected,this._attributes)}.bind(this)),e.cursor===void 0){var s=document.createElement("canvas");s.width=s.height=32;var i=s.getContext("2d");i.beginPath(),i.moveTo(9,3),i.lineTo(2,9),i.lineTo(10,17),i.lineTo(17,11),i.closePath(),i.fillStyle="#fff",i.fill(),i.stroke(),i.beginPath(),i.moveTo(6,4),i.lineTo(0,8),i.lineTo(0,13),i.lineTo(3,17),i.lineTo(3,8),i.closePath(),i.fillStyle="#000",i.fill(),i.stroke(),i.moveTo(8,8),i.lineTo(10,0),i.lineTo(11,0),i.lineTo(13,3),i.lineTo(13,7),i.stroke(),this._cursor="url("+s.toDataURL()+") 0 13, auto"}e.cursor&&(this._cursor=e.cursor)}setCursor(e){this._cursor=e}getCursor(){return this._cursor}setActive(e){e!==this.getActive()&&(super.setActive(e),this.getMap()&&this._cursor&&(e?(this._previousCursor=this.getMap().getTargetElement().style.cursor,o.setCursor(this.getMap(),this._cursor)):(o.setCursor(this.getMap(),this._previousCursor),this._previousCursor=void 0)))}setAttributes(e){this._attributes=e}setAttribute(e,t){this._attributes[e]=t}getAttributes(){return this._attributes}getAttribute(e){return this._attributes[e]}fill(e,t){if(e.length&&t){for(var s=!1,i=0,r;r=e[i];i++){for(var n in t)r.get(n)!==t[n]&&(s=!0);if(s)break}s&&(this.dispatchEvent({type:"setattributestart",features:e,properties:t}),e.forEach(function(h){for(var d in t)h.set(d,t[d])}),this.dispatchEvent({type:"setattributeend",features:e,properties:t}))}}},Re=class extends Te{constructor(e){e=e||{},super({handleDownEvent:function(s){return t.handleDownEvent_(s)},handleDragEvent:function(s){return this.handleDragEvent_(s)},handleMoveEvent:function(s){return this.handleMoveEvent_(s)},handleUpEvent:function(s){return this.handleUpEvent_(s)}});var t=this;this.selection_=new H,this.handles_=new H,this.overlayLayer_=new ee({source:new G({features:this.handles_,useSpatialIndex:!1,wrapX:!1}),name:"Transform overlay",displayInLayerSwitcher:!1,style:function(s){return t.style[(s.get("handle")||"default")+(s.get("constraint")||"")+(s.get("option")||"")]},updateWhileAnimating:!0,updateWhileInteracting:!0}),this.features_=e.features,typeof e.filter=="function"&&(this._filter=e.filter),this.layers_=e.layers?e.layers instanceof Array?e.layers:[e.layers]:null,this._handleEvent=e.condition||function(){return!0},this.addFn_=e.addCondition||function(){return!1},this.setPointRadius(e.pointRadius),this.set("translateFeature",e.translateFeature!==!1),this.set("translate",e.translate!==!1),this.set("translateBBox",e.translateBBox===!0),this.set("stretch",e.stretch!==!1),this.set("scale",e.scale!==!1),this.set("rotate",e.rotate!==!1),this.set("keepAspectRatio",e.keepAspectRatio||function(s){return s.originalEvent.shiftKey}),this.set("modifyCenter",e.modifyCenter||function(s){return s.originalEvent.metaKey||s.originalEvent.ctrlKey}),this.set("noFlip",e.noFlip||!1),this.set("selection",e.selection!==!1),this.set("hitTolerance",e.hitTolerance||0),this.set("enableRotatedTransform",e.enableRotatedTransform||!1),this.set("keepRectangle",e.keepRectangle||!1),this.set("buffer",e.buffer||0),this.on("propertychange",function(){this.drawSketch_()}),this.setDefaultStyle()}setMap(e){var t=this.getMap();t&&(t.removeLayer(this.overlayLayer_),this.previousCursor_&&o.setCursor(t,this.previousCursor_),this.previousCursor_=void 0),super.setMap(e),this.overlayLayer_.setMap(e),e===null&&this.select(null),e!==null&&(this.isTouch=/touch/.test(e.getViewport().className),this.setDefaultStyle())}setActive(e){this.select(null),this.overlayLayer_&&this.overlayLayer_.setVisible(e),super.setActive(e)}setDefaultStyle(e){e=e||{};var t=e.pointStroke||new O({color:[255,0,0,1],width:1}),s=e.stroke||new O({color:[255,0,0,1],width:1,lineDash:[4,4]}),i=e.fill||new q({color:[255,0,0,.01]}),r=e.pointFill||new q({color:[255,255,255,.8]}),n=new J({fill:r,stroke:t,radius:this.isTouch?12:6,displacement:this.isTouch?[24,-24]:[12,-12],points:15});n.setDisplacement||(n.getAnchor()[0]=this.isTouch?-10:-5);var h=new J({fill:r,stroke:t,radius:this.isTouch?16:8,points:4,angle:Math.PI/4}),d=new J({fill:r,stroke:t,radius:this.isTouch?12:6,points:4,angle:Math.PI/4});function u(p,l,c){return[new z({image:p,stroke:l,fill:c})]}this.style={default:u(h,s,i),translate:u(h,t,r),rotate:u(n,t,r),rotate0:u(h,t,r),scale:u(h,t,r),scale1:u(h,t,r),scale2:u(h,t,r),scale3:u(h,t,r),scalev:u(d,t,r),scaleh1:u(d,t,r),scalev2:u(d,t,r),scaleh3:u(d,t,r)},this.drawSketch_()}setStyle(e,t){if(t){t instanceof Array?this.style[e]=t:this.style[e]=[t];for(var s=0;s<this.style[e].length;s++){var i=this.style[e][s].getImage();i&&(e=="rotate"&&(i.getAnchor()[0]=-5),this.isTouch&&i.setScale(1.8));var r=this.style[e][s].getText();r&&(e=="rotate"&&r.setOffsetX(this.isTouch?14:7),this.isTouch&&r.setScale(1.8))}this.drawSketch_()}}getFeatureAtPixel_(e){var t=this;return this.getMap().forEachFeatureAtPixel(e,function(s,i){var r=!1;if(!i){if(s===t.bbox_)return t.get("translateBBox")?{feature:s,handle:"translate",constraint:"",option:""}:!1;if(t.handles_.forEach(function(h){h===s&&(r=!0)}),r)return{feature:s,handle:s.get("handle"),constraint:s.get("constraint"),option:s.get("option")}}if(!t.get("selection"))return t.selection_.getArray().some(function(h){return s===h})?{feature:s}:null;if(t._filter)return t._filter(s,i)?{feature:s}:null;if(t.layers_){for(var n=0;n<t.layers_.length;n++)if(t.layers_[n]===i)return{feature:s};return null}else return t.features_?(t.features_.forEach(function(h){h===s&&(r=!0)}),r?{feature:s}:null):{feature:s}},{hitTolerance:this.get("hitTolerance")})||{}}getGeometryRotateToZero_(e,t){var s=e.getGeometry(),i=this.getMap().getView().getRotation();if(i===0||!this.get("enableRotatedTransform"))return t?s.clone():s;var r=s.clone();return r.rotate(i*-1,this.getMap().getView().getCenter()),r}_isRectangle(e){if(this.get("keepRectangle")&&e.getType()==="Polygon"){var t=e.getCoordinates()[0];return t.length===5}return!1}drawSketch_(e){var t,s,i,r=this.selection_.item(0)&&this._isRectangle(this.selection_.item(0).getGeometry());if(this.overlayLayer_.getSource().clear(),!!this.selection_.getLength()){var n=this.getMap().getView().getRotation(),h=this.getGeometryRotateToZero_(this.selection_.item(0)).getExtent(),d;r&&(d=this.getGeometryRotateToZero_(this.selection_.item(0)).getCoordinates()[0].slice(0,4),d.unshift(d[3])),h=Ce(h,this.get("buffer")),this.selection_.forEach(function(m){var w=this.getGeometryRotateToZero_(m).getExtent();Q(h,w)}.bind(this));var u=this.selection_.getLength()===1?this._pointRadius(this.selection_.item(0)):0;if(u&&!(u instanceof Array)&&(u=[u,u]),e===!0)this.ispt_||(this.overlayLayer_.getSource().addFeature(new P({geometry:new x(this.center_),handle:"rotate0"})),i=U(h),this.get("enableRotatedTransform")&&n!==0&&i.rotate(n,this.getMap().getView().getCenter()),s=this.bbox_=new P(i),this.overlayLayer_.getSource().addFeature(s));else{if(this.ispt_){var p=this.getMap().getPixelFromCoordinate(j(h));if(p){var l=u&&u[0]||10,c=u&&u[1]||10;h=xe([this.getMap().getCoordinateFromPixel([p[0]-l,p[1]-c]),this.getMap().getCoordinateFromPixel([p[0]+l,p[1]+c])])}}i=r?new X([d]):U(h),this.get("enableRotatedTransform")&&n!==0&&i.rotate(n,this.getMap().getView().getCenter()),s=this.bbox_=new P(i);var y=[],f=i.getCoordinates()[0];if(!this.ispt_||u){if(y.push(s),!this.iscircle_&&!this.ispt_&&this.get("stretch")&&this.get("scale"))for(t=0;t<f.length-1;t++)s=new P({geometry:new x([(f[t][0]+f[t+1][0])/2,(f[t][1]+f[t+1][1])/2]),handle:"scale",constraint:t%2?"h":"v",option:t}),y.push(s);if(this.get("scale"))for(t=0;t<f.length-1;t++)s=new P({geometry:new x(f[t]),handle:"scale",option:t}),y.push(s);this.get("translate")&&!this.get("translateFeature")&&(s=new P({geometry:new x([(f[0][0]+f[2][0])/2,(f[0][1]+f[2][1])/2]),handle:"translate"}),y.push(s))}!this.iscircle_&&this.get("rotate")&&(s=new P({geometry:new x(f[3]),handle:"rotate"}),y.push(s)),this.overlayLayer_.getSource().addFeatures(y)}}}select(e,t){if(!e){this.selection_&&(this.selection_.clear(),this.drawSketch_());return}if(!(!e.getGeometry||!e.getGeometry())){if(t)this.selection_.push(e);else{var s=this.selection_.getArray().indexOf(e);this.selection_.removeAt(s)}this.ispt_=this.selection_.getLength()===1?this.selection_.item(0).getGeometry().getType()=="Point":!1,this.iscircle_=this.selection_.getLength()===1?this.selection_.item(0).getGeometry().getType()=="Circle":!1,this.drawSketch_(),this.watchFeatures_(),this.dispatchEvent({type:"select",feature:e,features:this.selection_})}}setSelection(e){this.selection_.clear(),e.forEach(function(t){this.selection_.push(t)}.bind(this)),this.ispt_=this.selection_.getLength()===1?this.selection_.item(0).getGeometry().getType()=="Point":!1,this.iscircle_=this.selection_.getLength()===1?this.selection_.item(0).getGeometry().getType()=="Circle":!1,this.drawSketch_(),this.watchFeatures_(),this.dispatchEvent({type:"select",features:this.selection_})}watchFeatures_(){this._featureListeners&&this._featureListeners.forEach(function(e){A(e)}),this._featureListeners=[],this.selection_.forEach(function(e){this._featureListeners.push(e.on("change",function(){this.isUpdating_||this.drawSketch_()}.bind(this)))}.bind(this))}handleDownEvent_(e){if(this._handleEvent(e,this.selection_)){var t=this.getFeatureAtPixel_(e.pixel),s=t.feature;if(this.selection_.getLength()&&this.selection_.getArray().indexOf(s)>=0&&(this.ispt_&&this.get("translate")||this.get("translateFeature"))&&(t.handle="translate"),t.handle){this.mode_=t.handle,this.opt_=t.option,this.constraint_=t.constraint;var i=this.getMap().getView().getRotation();this.coordinate_=s.get("handle")?s.getGeometry().getCoordinates():e.coordinate,this.pixel_=this.getMap().getCoordinateFromPixel(this.coordinate_),this.geoms_=[],this.rotatedGeoms_=[];for(var r=ce(),n=ce(),h=0,d;d=this.selection_.item(h);h++)if(this.geoms_.push(d.getGeometry().clone()),r=Q(r,d.getGeometry().getExtent()),this.get("enableRotatedTransform")&&i!==0){var u=this.getGeometryRotateToZero_(d,!0);this.rotatedGeoms_.push(u),n=Q(n,u.getExtent())}if(this.extent_=U(r).getCoordinates()[0],this.get("enableRotatedTransform")&&i!==0&&(this.rotatedExtent_=U(n).getCoordinates()[0]),this.mode_==="rotate"){this.center_=this.getCenter()||j(r);var p=e.map.getTargetElement();o.setCursor(p,this.Cursors.rotate0),this.previousCursor_=p.style.cursor}else this.center_=j(r);return this.angle_=Math.atan2(this.center_[1]-e.coordinate[1],this.center_[0]-e.coordinate[0]),this.dispatchEvent({type:this.mode_+"start",feature:this.selection_.item(0),features:this.selection_,pixel:e.pixel,coordinate:e.coordinate}),!0}else if(this.get("selection")){if(s){this.addFn_(e)||this.selection_.clear();var l=this.selection_.getArray().indexOf(s);l<0?this.selection_.push(s):this.selection_.removeAt(l)}else this.selection_.clear();return this.ispt_=this.selection_.getLength()===1?this.selection_.item(0).getGeometry().getType()=="Point":!1,this.iscircle_=this.selection_.getLength()===1?this.selection_.item(0).getGeometry().getType()=="Circle":!1,this.drawSketch_(),this.watchFeatures_(),this.dispatchEvent({type:"select",feature:s,features:this.selection_,pixel:e.pixel,coordinate:e.coordinate}),!1}}}getCenter(){return this.get("center")}setCenter(e){return this.set("center",e)}handleDragEvent_(e){if(this._handleEvent(e,this.features_)){var t=this.getMap().getView().getRotation(),s,i,r,n,h=[this.coordinate_[0],this.coordinate_[1]],d=[e.coordinate[0],e.coordinate[1]];switch(this.isUpdating_=!0,this.mode_){case"rotate":{var u=Math.atan2(this.center_[1]-d[1],this.center_[0]-d[0]);if(!this.ispt)for(s=0,r;r=this.selection_.item(s);s++)n=this.geoms_[s].clone(),n.rotate(u-this.angle_,this.center_),n.getType()=="Circle"&&n.setCenterAndRadius(n.getCenter(),n.getRadius()),r.setGeometry(n);this.drawSketch_(!0),this.dispatchEvent({type:"rotating",feature:this.selection_.item(0),features:this.selection_,angle:u-this.angle_,pixel:e.pixel,coordinate:e.coordinate});break}case"translate":{var p=d[0]-h[0],l=d[1]-h[1];for(s=0,r;r=this.selection_.item(s);s++)r.getGeometry().translate(p,l);this.handles_.forEach(function(b){b.getGeometry().translate(p,l)}),this.coordinate_=e.coordinate,this.dispatchEvent({type:"translating",feature:this.selection_.item(0),features:this.selection_,delta:[p,l],pixel:e.pixel,coordinate:e.coordinate});break}case"scale":{var c=this.center_;if(this.get("modifyCenter")(e)){var y=this.extent_;this.get("enableRotatedTransform")&&t!==0&&(y=this.rotatedExtent_),c=y[(Number(this.opt_)+2)%4]}var f=this.geoms_.length==1&&this._isRectangle(this.geoms_[0]),m=this.constraint_,w=this.opt_,E=this.coordinate_,L=e.coordinate;if(this.get("enableRotatedTransform")&&t!==0){var S=new x(this.coordinate_);S.rotate(t*-1,c),E=S.getCoordinates();var M=new x(e.coordinate);M.rotate(t*-1,c),L=M.getCoordinates()}var T=(L[0]-c[0])/(E[0]-c[0]),g=(L[1]-c[1])/(E[1]-c[1]),_=[L[0]-E[0],L[1]-E[1]];if(this.get("enableRotatedTransform")&&t!==0){var k=new x(c);k.rotate(t*-1,this.getMap().getView().getCenter()),c=k.getCoordinates()}for(this.get("noFlip")&&(T<0&&(T=-T),g<0&&(g=-g)),this.constraint_?this.constraint_=="h"?T=1:g=1:this.get("keepAspectRatio")(e)&&(T=g=Math.min(T,g)),s=0,r;r=this.selection_.item(s);s++)n=t===0||!this.get("enableRotatedTransform")?this.geoms_[s].clone():this.rotatedGeoms_[s].clone(),n.applyTransform(function(b,v,Y){if(Y<2)return v;if(f){var Z=[[6],[0,8],[2],[4]],C=[b[0],b[1]],F=[b[2],b[3]],R=[b[4],b[5]],N=[b[6],b[7]],W=[b[8],b[9]];if(m){var ge=w%2===0?this._countVector(C,F):this._countVector(N,C),ie=this._projectVectorOnVector(_,ge),pe=w+1<Z.length?w+1:0,re=[...Z[w],...Z[pe]];for(i=0;i<b.length;i+=Y)v[i]=re.includes(i)?b[i]+ie[0]:b[i],v[i+1]=re.includes(i)?b[i+1]+ie[1]:b[i+1]}else{var V,D;switch(w){case 0:_=this._countVector(N,L),V=this._projectVectorOnVector(_,this._countVector(R,N)),D=this._projectVectorOnVector(_,this._countVector(C,N)),[v[0],v[1]]=this._movePoint(C,V),[v[4],v[5]]=this._movePoint(R,D),[v[6],v[7]]=this._movePoint(N,_),[v[8],v[9]]=this._movePoint(W,V);break;case 1:_=this._countVector(C,L),V=this._projectVectorOnVector(_,this._countVector(N,C)),D=this._projectVectorOnVector(_,this._countVector(F,C)),[v[0],v[1]]=this._movePoint(C,_),[v[2],v[3]]=this._movePoint(F,V),[v[6],v[7]]=this._movePoint(N,D),[v[8],v[9]]=this._movePoint(W,_);break;case 2:_=this._countVector(F,L),V=this._projectVectorOnVector(_,this._countVector(C,F)),D=this._projectVectorOnVector(_,this._countVector(R,F)),[v[0],v[1]]=this._movePoint(C,D),[v[2],v[3]]=this._movePoint(F,_),[v[4],v[5]]=this._movePoint(R,V),[v[8],v[9]]=this._movePoint(W,D);break;case 3:_=this._countVector(R,L),V=this._projectVectorOnVector(_,this._countVector(F,R)),D=this._projectVectorOnVector(_,this._countVector(N,R)),[v[2],v[3]]=this._movePoint(F,D),[v[4],v[5]]=this._movePoint(R,_),[v[6],v[7]]=this._movePoint(N,V);break}}}else for(i=0;i<b.length;i+=Y)T!=1&&(v[i]=c[0]+(b[i]-c[0])*T),g!=1&&(v[i+1]=c[1]+(b[i+1]-c[1])*g);return n.getType()=="Circle"&&n.setCenterAndRadius(n.getCenter(),n.getRadius()),v}.bind(this)),this.get("enableRotatedTransform")&&t!==0&&n.rotate(t,this.getMap().getView().getCenter()),r.setGeometry(n);this.drawSketch_(),this.dispatchEvent({type:"scaling",feature:this.selection_.item(0),features:this.selection_,scale:[T,g],pixel:e.pixel,coordinate:e.coordinate});break}}this.isUpdating_=!1}}handleMoveEvent_(e){if(this._handleEvent(e,this.features_)&&!this.mode_){var t=this.getFeatureAtPixel_(e.pixel),s=e.map.getTargetElement();if(t.feature){var i=t.handle?this.Cursors[(t.handle||"default")+(t.constraint||"")+(t.option||"")]:this.Cursors.select;this.previousCursor_===void 0&&(this.previousCursor_=s.style.cursor),o.setCursor(s,i)}else this.previousCursor_!==void 0&&o.setCursor(s,this.previousCursor_),this.previousCursor_=void 0}}handleUpEvent_(e){if(this.mode_==="rotate"){var t=e.map.getTargetElement();o.setCursor(t,this.Cursors.default),this.previousCursor_=void 0}return this.dispatchEvent({type:this.mode_+"end",feature:this.selection_.item(0),features:this.selection_,oldgeom:this.geoms_[0],oldgeoms:this.geoms_}),this.drawSketch_(),this.mode_=null,!1}setPointRadius(e){typeof e=="function"?this._pointRadius=e:this._pointRadius=function(){return e}}getFeatures(){return this.selection_}_projectVectorOnVector(e,t){var s=(e[0]*t[0]+e[1]*t[1])/(t[0]*t[0]+t[1]*t[1]);return[t[0]*s,t[1]*s]}_countVector(e,t){return[t[0]-e[0],t[1]-e[1]]}_movePoint(e,t){return[e[0]+t[0],e[1]+t[1]]}};Re.prototype.Cursors={default:"auto",select:"pointer",translate:"move",rotate:"move",rotate0:"move",scale:"nesw-resize",scale1:"nwse-resize",scale2:"nesw-resize",scale3:"nwse-resize",scalev:"ew-resize",scaleh1:"ns-resize",scalev2:"ew-resize",scaleh3:"ns-resize"};(function(){var a=G.prototype.clear;G.prototype.clear=function(e){this.dispatchEvent({type:"clearstart"}),a.call(this,e),this.dispatchEvent({type:"clearend"})}})();var I=class extends fe{constructor(e){e=e||{},super({handleEvent:function(){return!0}}),this._layers=e.layers,this._undoStack=new H,this._redoStack=new H,this._undo=[],this._redo=[],this._undoStack.on("add",function(t){t.element.level===void 0?(t.element.level=this._level,t.element.level||(t.element.view={center:this.getMap().getView().getCenter(),zoom:this.getMap().getView().getZoom()},this._undo.push(t.element))):t.element.level||this._undo.push(this._redo.shift()),t.element.level||this.dispatchEvent({type:"stack:add",action:t.element}),this._reduce()}.bind(this)),this._undoStack.on("remove",function(t){t.element.level||(this._doShift?this._undo.shift():this._undo.length&&this._redo.push(this._undo.pop()),this._doClear||this.dispatchEvent({type:"stack:remove",action:t.element,shift:this._doShift}))}.bind(this)),this._block=0,this._level=0,this._doShift=!1,this._record=!0,this._defs={}}define(e,t,s){this._defs[e]={undo:t,redo:s}}length(e){return e==="redo"?this._redo.length:this._undo.length}setMaxLength(e){e=parseInt(e),e&&e<0&&(e=0),this.set("maxLength",e),this._reduce()}size(e){return e==="redo"?this._redoStack.getLength():this._undoStack.getLength()}setMaxSize(e){e=parseInt(e),e&&e<0&&(e=0),this.set("maxSize",e),this._reduce()}_reduce(){if(this.get("maxLength"))for(;this.length()>this.get("maxLength");)this.shift();if(this.get("maxSize"))for(;this.length()>1&&this.size()>this.get("maxSize");)this.shift()}getStack(e){return e==="redo"?this._redo:this._undo}push(e,t,s){return this._defs[e]?(this._undoStack.push({type:e,name:s,custom:!0,prop:t}),!0):!1}shift(){this._doShift=!0;var e=this._undoStack.removeAt(0);if(this._doShift=!1,e.type==="blockstart")for(e=this._undoStack.item(0);this._undoStack.getLength()&&e.level>0;)this._undoStack.removeAt(0),e=this._undoStack.item(0)}setActive(e){super.setActive(e),this._record=e}setMap(e){this._mapListener&&this._mapListener.forEach(function(t){A(t)}),this._mapListener=[],super.setMap(e),e&&(this._mapListener.push(e.on("undoblockstart",this.blockStart.bind(this))),this._mapListener.push(e.on("undoblockend",this.blockEnd.bind(this)))),this._watchSources(),this._watchInteractions()}_watchSources(){var e=this.getMap();this._sourceListener&&this._sourceListener.forEach(function(r){A(r)}),this._sourceListener=[];var t=this;function s(r,n){return n||(n=[]),r.forEach(function(h){h.getSource&&h.getSource()instanceof G?(!t._layers||t._layers.indexOf(h)>=0)&&n.push(h):h.getLayers&&s(h.getLayers(),n)}),n}if(e){var i=s(e.getLayers());i.forEach(function(r){var n=r.getSource();this._sourceListener.push(n.on(["addfeature","removefeature"],this._onAddRemove.bind(this))),this._sourceListener.push(n.on("clearstart",function(){this.blockStart("clear")}.bind(this))),this._sourceListener.push(n.on("clearend",this.blockEnd.bind(this)))}.bind(this)),this._sourceListener.push(e.getLayers().on(["add","remove"],this._watchSources.bind(this)))}}_watchInteractions(){var e=this.getMap();this._interactionListener&&this._interactionListener.forEach(function(t){A(t)}),this._interactionListener=[],e&&(e.getInteractions().forEach(function(t){this._interactionListener.push(t.on(["setattributestart","modifystart","rotatestart","translatestart","scalestart","deletestart","deleteend","beforesplit","aftersplit"],this._onInteraction.bind(this)))}.bind(this)),this._interactionListener.push(e.getInteractions().on(["add","remove"],this._watchInteractions.bind(this))))}_onAddRemove(e){this._record&&(this._redoStack.clear(),this._redo.length=0,this._undoStack.push({type:e.type,source:e.target,feature:e.feature}))}_onInteraction(e){var t=this._onInteraction[e.type];t&&t.call(this,e)}blockStart(e){this._redoStack.clear(),this._redo.length=0,this._undoStack.push({type:"blockstart",name:e}),this._level++}blockEnd(){this._undoStack.push({type:"blockend"}),this._level--}_handleDo(e,t){if(this.getActive()){if(this._record=!1,e.custom)this._defs[e.type]&&(t?this._defs[e.type].undo(e.prop):this._defs[e.type].redo(e.prop));else switch(e.type){case"addfeature":{t?e.source.removeFeature(e.feature):e.source.addFeature(e.feature);break}case"removefeature":{t?e.source.addFeature(e.feature):e.source.removeFeature(e.feature);break}case"changegeometry":{var s=e.feature.getGeometry();e.feature.setGeometry(e.oldGeom),e.oldGeom=s;break}case"changeattribute":{var i=e.newProperties,r=e.oldProperties;for(var n in r)r===void 0?e.feature.unset(n):e.feature.set(n,r[n]);e.oldProperties=i,e.newProperties=r;break}case"blockstart":{this._block+=t?-1:1;break}case"blockend":{this._block+=t?1:-1;break}default:}this._block<0&&(this._block=0),this._block&&(t?this.undo():this.redo()),this._record=!0,this.dispatchEvent({type:t?"undo":"redo",action:e})}}undo(){var e=this._undoStack.item(this._undoStack.getLength()-1);e&&(this._redoStack.push(e),this._undoStack.pop(),this._handleDo(e,!0))}redo(){var e=this._redoStack.item(this._redoStack.getLength()-1);e&&(this._undoStack.push(e),this._redoStack.pop(),this._handleDo(e,!1))}clear(){this._doClear=!0,this._undo.length=this._redo.length=0,this._undoStack.clear(),this._redoStack.clear(),this._doClear=!1,this.dispatchEvent({type:"stack:clear"})}hasUndo(){return this._undoStack.getLength()}hasRedo(){return this._redoStack.getLength()}};I.prototype._onInteraction.setattributestart=function(a){this.blockStart(a.target.get("name")||"setattribute");var e=Object.assign({},a.properties);a.features.forEach(function(t){var s={};for(var i in e)s[i]=t.get(i);this._undoStack.push({type:"changeattribute",feature:t,newProperties:e,oldProperties:s})}.bind(this)),this.blockEnd()};I.prototype._onInteraction.rotatestart=I.prototype._onInteraction.translatestart=I.prototype._onInteraction.scalestart=I.prototype._onInteraction.modifystart=function(a){this.blockStart(a.type.replace(/start$/,"")),a.features.forEach(function(e){this._undoStack.push({type:"changegeometry",feature:e,oldGeom:e.getGeometry().clone()})}.bind(this)),this.blockEnd()};I.prototype._onInteraction.beforesplit=function(){var a=this._undoStack.getLength();a>2&&this._undoStack.item(a-1).type==="blockend"&&this._undoStack.item(a-2).type==="changegeometry"?this._undoStack.pop():this.blockStart("split")};I.prototype._onInteraction.deletestart=function(){this.blockStart("delete")};I.prototype._onInteraction.aftersplit=I.prototype._onInteraction.deleteend=I.prototype.blockEnd;export{Ye as a,We as b,ze as c,I as d,je as e,st as f,Re as g,De as h,Je as i,Xe as o};
